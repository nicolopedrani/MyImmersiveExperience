import{p as y,g as fe,u as Ee,a as h,b as De,c as He,W as Je,M as _e,d as Be,s as Ve,e as Le,i as Xe,f as Ze,h as Ke}from"./game-CudpEz85.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();const et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAB1JREFUOI1jtOv0+M9AAWCiRPOoAaMGjBowmAwAAJhEAi4/QQzBAAAAAElFTkSuQmCC",tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAB1JREFUOI1jfLKs6D8DBYCJEs2jBowaMGrAYDIAAFnyAxuTOlahAAAAAElFTkSuQmCC",ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABQCAYAAACpv3NFAAAAAXNSR0IArs4c6QAABZFJREFUeJztW09PG0cU/zk1ogZFvbBFCjgXDgYipAYJRzKHXCLlGkeIT9EvkAMnH/oJ+iUsFM6VcokESBipiYRi44MPjUGVte6BVmDRWNCDmeXteHa9M/Nm6WF/Esrszuzse7/3Z97MOkCGDBkyZMiQIUOGdFFY8G4LC97tQ8uRczEpVWxw7ufE9eDcz4n+1Z0yAKBZa4COdSFPHPKckwlFhXIA0Kw1qLJj/fS6WWvcqghzCbYXCKs2aw1U6xUAQPtkCGBkZVnp0lo+NKa0lkf7ZBga26w1nJPwiGMS6vKrO2XsbR8CuFeyWq8EbXpfvlYR5TpXWLNbWPBuq/VKyHqyggLtk2Fkn2rM3vZh4E1724dOvIGNANcQXgXw5garEEh7GVvdKWN1p8z6XmMCRNITMd8+GQYJzQXk0OLKDSxJUE5y3FDlDi5vsCJAFDF0KXMBOq9YZrneZUQAdX9ayQFwGgrtkyG4E65RNqWlrAouw4GCY2UwXk4oCbSqS0t5OexM6wSrEKACuFwBVOB6rzYBctaVY56biLj5qPVNoeUy8jaWrs3U/blCIek8dNOlGwbGyyBdimRBOfNAlAdweZp20lDFPxcEkSrl6LtU/aZbZy0PUMV/EiQdR5WXyRW5hs5Ft9Gmy6B2CFTrlaD40fGApAVSaS0fzKs6N4g6SzAtibUJ2K/nxg4t4hQzLZPjCJPnqtYrqNYrRiRoETA493P+7kHonhBSJaysvA4JqqQqv4MjERolQWD8YDPuFCiuPykm1QOmlaCWVIUF79bb2oS38m3i2ElhoZs/gGhPsDkuM6oD/NZUaBeoUiaqLogKlUkx76rkNsoB/u4BvK1N5ZgkCVFuJ80RUeu/DbQ9QLiaKgxoQpSVpW48yZqTiBJo1hrwtjbhbW0aL4MspZxOoSOPj2tP2ltEeaEOjFYBkQj91tRIkJik6LemEiXNpJDn81tT8HcPjJOgsQeolJfvcSlP5xHEeyvfgvi3+U5glAPkYkgIKQRU3ZfbUfBbU8pn5Gc5lAcszgRFW45Dan0ZsrdEeYrKk1S47Axx9enIigSjEBCfsGeevwgJM7uUT2xlCurWceMuO/zHbtYfRi47Q/i7B5hdyo/dlxHl3lH9l53h2DxXn46Cf22tD1h+HBWhMPP8RUCAcEv5nkxQFOSxKiI5FBew8gAqhLBWnPJUmaj27FI+0uouwMIiTYoiLyQlQu6nJFJQEjg/j7P/4ICGhUCUQnFjhMKUUBc/kGD5OkwhCxmlfPlxMZTQ6DWdiyvZRcHZD5CiwgIAyo+LAIDGP93QNb2X1k/mnH3IIwosA0ct4F7Rjfnpu65i6JnR/SI+nv6+MnoOAHDqSkbAQQjcYZn8YXDurwzO/RUAePusEBq4MT8dEFKcU4oTmosb3ARMFLS06AWKbsxPRyltPL8uOEMgsWClRQ+Aj27/JmgD0+j2b3TexRIaXB6gZZX2ma9U1sAbrMFBgJYgHz73gvarn+ZTfbcKrpJgLIT122d+6PohYEuAtgWEmx/3rgHce4Sm+1vJQJGaB7xcXm+9e/0UwL2ywvLHveug/e71U7xcXm+lJZcNAUbMj7L+CMW5R4EnHPeuQ31pyAIA35k+CGAu6UBh/faZj7/+vsL7LwNszE/jh5kc3qw/wX7nAgCw37nAj9//izfrT9C9mPn5j/6fv2rI09dVAEg5CXb7N3j/ZRBcU4vflb/o9m/QPvNTCwWbQugUCVxPWP/D5x6Oe9eBosB6q3jmj5Hw0ay8MS6KbHdcxrEnrPv2WQGlRQ+//PaVkKONByMAcLRJ0YBVSfwghdD/CVyHDg/lBdYbIs5Tl7RJYNkNch87pUUC2ymRq3M3V0SwH4+lcfBoS4bTM8HU/7MyJhPiVOEMGTJkyJAhQwaB/wCcF1ybPAOXlAAAAABJRU5ErkJggg==",nt="/MyImmersiveExperience/assets/Player-LaRVoEvR.png",it="/MyImmersiveExperience/assets/MainGuySpriteSheet-A_pLERVz.png",at="/MyImmersiveExperience/assets/assets-k1rCfwam.png",st="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABgCAYAAADVenpJAAAHZElEQVR4nO2dXUwUVxTH/zM7u8sCIoqCoKAJEo2FKFpM1VbLR6tNXxqrJSS1SQ1ttDURTW1KYh8aSbYpjaGJaY0hmugDoTW+NW0igta2ttLYWqlVwUSoroVKJVtYYb+mD7DTnWXW7c7eubPsvb9kkrkDnHPunT+79+PcGUGWZRkcZpEA4OClF8yOwxSa1n0FgO36SwBwf/S22bGYCsv1lwDAYZ1ldhymwnL9JQCQ5aDZcZgKy/UXzQ6AYy5cAIzDBcA4XACMwwXAOFwAjMMFwDhcAIzDBcA4XACMwwXAOFwAjCMBgCTaqDjzB71U/Mw0aLW/pm8AePDoLgKy31BHFkFCtj3XUB8zFRrtH4lFkABMCaCm6DVk2XIMdej2DuOnwa8N9TFTodH+kbi9wwCmBPD6CieGHg0Y6jDXUcQFEAUa7R9JrqMIwJQA/EEv9p5fa6jDU5vpVnAmQaP9Izm1eQCSaPuvEzjfUWioQzM7OskOjfbX8glMfQIAoN4J4agxq/35PADjcAEwDhcA43ABMA4XAONwATCOMgwMzQ3rgQ8h6ZHIfdJCsTY87tJlwCJYMIvyPDbLjEwMIiAHiNlTBFC5qE6XgTG/G7cedhMLiPN41uRtQYaURcyeIoC6ZQd1GciwZuPtrnJiAXEez95VxzDmGyFmTxHA7s6VugyceJ7dvfVmEJD9uu9VOCc39wMIE0CWfZ4uQ/F0SiK3YQsC3UFItG3gZscVDxZB0n2vtFDuHo098n7ZpyrbRAe1vfmCIMIXnND8mRlxJSIykrGRHVPE4NPKX1TlnWdLkG3PpZKONjIxhOPP9SZFXKF4kgGqAmj5uV5V/qzqKuo7liM3fbFhCaOSaMOQpx+tNTem+X9nzUnqcYXHkwxQFcC14W9U5babTfjk2cvYd+EpZNvziPuzija4xm7jSOUVtN1smuY/Vlx7ulajIKMYPkIiiIwnRH3px0Ts64GqALJs6s5L1902zElbgH3lx3HieiNRX1bRhnujvfjw6U5cvPc5uu62YW5aflxxOTd04L1vq7Aws4SICAY9A3Bu6FDiCWGmAKh2d4NyQHXkpBXgi95mPJm3hbivIc8AGiva0e/uwRe9zchJK5jmP1Zc/e4eNFa0Y8hDJp+xvvQjVTyhw0xMHe8EZD/y0pcY8v2/reQAAODotQbkpS+Jq0MXiuvotQaVrUSpLtyhiid0mInpA15/0GtIwujWpfvh7K5FQUaxLoH5g14UZBTD2V2LrUv3E4nJN2UzmXZImS4Ao/AFvY/97g4fh0cbk8eyES9W0UbMFilSVgCxGnvcP6p5Hokv6IU1hVPaU1YAsQjPw6edk59MMCsA54YOzXPWYFYAnEm4ABiHWQE0Xd6mec4aKSuAWL33vpErmueRJOPQjSQpK4DQWkA0EcyyzdU8j8dGKpCyAjjTdxiNFe1wjd3WnGmMXAuIRJpauWusaMeZvsOGxmomKSuA073NAIBdZS0Y9NyJK3XNIkgY9NzBrrIWla1ECch+4nn9iWK6AETBovkfmCi56UVwdtdicVYptpccwPC4C6JgUR3hMYQfw+MubC85gMVZpXB21yI3vYhITBZBUuJIFkyVoyCIcHsfGNIgoXn8xu9qcKTyCh6O/4mLrtOav+v2PlCVKxfV4ZmFr2BP12qiawG3HnajclEdLrpOJ81mGqoCECCoyo98/6AsZyPujxmTWu4LepGfUYy959eiteZG1Dy8spyNqnLdsoOo71iOfILZQABw6PLLOFr1K0YmhvD73z8Qs5sIVAXgjcjKLchciobyVrxxbgXSJWNe3eYPejHfUYjdnSujJoU2lLeqyjvPlmC+o5D4su0ce54Sxwc/vkTUtl6oCiA9YkvToXVf4s1zTyDDOtvQNOyA7EeWfR7e6lqlun6s+joATLueZZ9nSKJGeBzHqn8jbl8PdLOCN32vKjdcWA9JsFLZGyDLQUiCVfNnkdeNjCcUR8OF9cq1lk2XDPMXC6oCeP/Si6qyx++mOskSLfGD9k4gQRDh8bup+oyGIgAaz/Fzjfapyg4pEzLYfHm5TbTr/luS90oRgN6eeDy95Mh39LL8yla9wvcFvURHTYoA9CZFxPMRzvINJ4VVtBFNYFEE0O/u0WXg6l+dxILhxOZM32Eij90vnr0KQJgAQjnw8SIJVsxJW5BwQJz/x+ne5mm7mfVQVfgqgDABFGQU6zaWyuvlyQapdYkQigD4TZwZkL5Ppq8GcsyFC4BxuAAYhwuAcbgAGIcLgHGUYWAqpz7PBMxqfwmYHFveG9XOliEFn2eIDo321/JpDb02zira0FjRbqhD/gkTHRrtr+UTmOoDnPvjlOEOafiYqZjRNiGfEgC09rwLf5THqJJCEu2YyxeNNKHR/pFIoh3VhTsmBZBHeIEhGrwfoA2t9tdC6QRyzMPM9ufzAIzDBcA4XACMwwXAOFwAjMMFwDhcAIzDBcA4XACMwwXAOBKQ3C9KpAHL9ZeAyWf1sAzL9ZcAID9T/7awVIDl+guyLLP5hAYOAOBfSQHMHZJk+TkAAAAASUVORK5CYII=",lt="/MyImmersiveExperience/assets/library-BPiDb9BV.png",rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAUCAYAAABGUvnzAAAC4ElEQVR4nO2av27bMBDGT4UeoIBSIJUrdGszeWqmCMgSDVliBMiUrRmSN/BDCOgDdMmYyUDgLB3UpYA6pROndiwSux3KoXtQZbBPpihS/CPaTm3/FkukSCn++N2d6Hj3ewdFJ88g6KVAaAbdIAFCM8A2WwjNGvs7eXN/E6M4sR7bhtMjv9b2pf+p1iZ6vm5Qb6PDvtbYdz9+6j5iDb8bJEDiBGiewSjOpOLSYV8oOLbzn20E3OAOH53GrpxRnACB6qqTuVkkLj+fCNkCYMfNc5GI3Cjj6uZhbs8xb/xukAAd9ssvtpNnMIoTYUgBqDvZpYP5RTGKE+N5wkEE45M743sDTMLtfnpoNXaefHv72nqsj+Ji7g16KdA8AzJt4wXlnYzn/Kepg2XX64ocDqLasYnQT1XctvhBLwWYuhVdy7aJ3Mqey2nqc8/45K4isq2LV41KIpIVUgjf16aa5V2JqUF1nQzWteEgMg7V++nhSrq4FBjdqBKZxXURxItsMj8rpq17n6q4bGQypRSYr4J5RH0uHaxqd83/XBmbUAnRJuEZYHFibLDHu987KGwHo8CiTRGsfvk+1Q7XqvLq62dvGffVf9sXgCGaSoRmQWFxUSxru3Hd8Nsk8K2LHQAAIJzQLLywuAiI9V3lsCljs4AmVByM1aeu6LP3YPk7L5+ndcaomJd4p0d+Y/HVVHMU17vgHd/KJ/eWEqFnAnvblwAw2zUqfp8pB6u+6KZ+lwWaaC6TVID70lc3D5VjHYrr3dpxo9AL5hl7Eg6itQxtKKapuMj4w3Pwjm8hPP/r/Nna4v379b4AmORTQjMIBxFsXezAn4/f1YO3L6V9Nj8U6CJbhLY5WNfBsr+HdbHMvZ63nBhdhuiJoBFzrAYLJsyr7C9SPNgn+5XKBNcFGitmk3tfvnijnuxc45oF4rfZlKf5xMG8eJS5plwEU9GJQ6F51jG9qHDyHqwjFi80tPh3oA36PAJWG3h2QapYCQAAAABJRU5ErkJggg==",f={};let F=0;const ne=9;let N=null;const ye={objects:[{name:"Bookshelf_A",code:"bsA",x:120,y:360,width:96,height:120},{name:"Bookshelf_B",code:"bsB",x:240,y:360,width:96,height:120},{name:"Bookshelf_C",code:"bsC",x:360,y:360,width:96,height:120},{name:"table",code:"t",x:336,y:192,width:168,height:96},{name:"world_map",code:"wm",x:120,y:192,width:96,height:120},{name:"chair",code:"c",x:648,y:72,width:48,height:72},{name:"rug",code:"r",x:432,y:0,width:168,height:72}],paths:[{name:"path_walk",code:"pw",x:72,y:192,width:24,height:24}]},ct={tilesheet:{columns:4,rows:3,tileWidth:32,tileHeight:32}},be={flags:[{name:"Australia",code:"au",x:0,y:0,width:15,height:10},{name:"United States",code:"us",x:15,y:0,width:15,height:10},{name:"Japan",code:"jp",x:30,y:0,width:15,height:10},{name:"Vietnam",code:"vn",x:45,y:0,width:15,height:10},{name:"Italy",code:"it",x:75,y:0,width:15,height:10},{name:"France",code:"fr",x:90,y:0,width:15,height:10},{name:"Germany",code:"de",x:105,y:0,width:15,height:10},{name:"Spain",code:"es",x:0,y:10,width:15,height:10},{name:"United Kingdom",code:"gb",x:15,y:10,width:15,height:10}]},dt={trees:[{name:"tree_1",code:"t1",x:0,y:0,width:160,height:208},{name:"tree_2",code:"t2",x:176,y:32,width:160,height:176},{name:"tree_3",code:"t3",x:368,y:32,width:128,height:176}]};function he(t){N=t,console.log("🚀 Starting asset loading..."),A("grass",et),A("path",tt),A("oak_tree_original",ot),A("player_sprite_sheet",nt),A("main_guy_sprite_sheet",it),A("assets_tilesheet",at),A("football_tilesheet",st),A("library_tilesheet",lt),A("travel_flags_tilesheet",rt)}function A(t,e){const o=new Image;o.onload=()=>{f[t]=o,F++,console.log(`✅ Loaded: ${t} (${F}/${ne})`),F===ne&&(console.log("🎯 All images loaded, starting tile extraction..."),ft(),mt(),N&&N())},o.onerror=()=>{console.error(`❌ Failed to load: ${t} from ${e}`),F++,F===ne&&N&&N()},o.src=e}function ft(){console.log("🔧 Extracting tiles..."),ht(),gt(),ut(),pt(),yt(),bt()}function ht(){const t=f.library_tilesheet;if(!t){console.error("❌ Library tilesheet not found");return}console.log("📚 Extracting library tiles..."),console.log("Library tilesheet size:",t.width,"x",t.height),ye.objects.forEach(o=>{console.log(`Extracting ${o.name} at (${o.x}, ${o.y}) size ${o.width}x${o.height}`);const i=q(t,o.x,o.y,o.width,o.height);o.name==="world_map"?(f.world_map=i,console.log("✅ World map extracted")):o.name==="chair"?(f.library_chair=i,console.log("✅ Chair extracted")):o.name.includes("Bookshelf")?(f[`library_${o.code}`]=i,console.log(`✅ Bookshelf ${o.code} extracted`)):o.name==="table"?(f.library_table=i,console.log("✅ Table extracted")):o.name==="rug"&&(f.library_rug=i,console.log("✅ Rug extracted"))});const e=ye.paths[0];f.library_floor=q(t,e.x,e.y,e.width,e.height),console.log("✅ Library floor extracted")}function gt(){const t=f.football_tilesheet;if(!t)return;console.log("⚽ Extracting football tiles...");const{tileWidth:e,tileHeight:o,columns:i,rows:n}=ct.tilesheet;for(let a=0;a<n;a++)for(let s=0;s<i;s++){const c=a*i+s;f[`football_${c}`]=q(t,s*e,a*o,e,o)}console.log(`✅ Extracted ${n*i} football tiles`)}function ut(){const t=f.travel_flags_tilesheet;t&&(console.log("🏁 Extracting flags..."),be.flags.forEach(e=>{f[`flag_${e.code}`]=q(t,e.x,e.y,e.width,e.height)}),console.log(`✅ Extracted ${be.flags.length} flags`))}function pt(){const t=f.assets_tilesheet;t&&(console.log("🌳 Extracting trees..."),dt.trees.forEach(e=>{f[`tree_${e.code}`]=q(t,e.x,e.y,e.width,e.height),console.log(`✅ Extracted tree ${e.code}`)}))}function q(t,e,o,i,n,a=64,s=64){const c=document.createElement("canvas");c.width=a,c.height=s;const l=c.getContext("2d");if(!l)return console.error("❌ Could not get canvas context"),new Image;l.clearRect(0,0,a,s),l.imageSmoothingEnabled=!1,l.drawImage(t,e,o,i,n,0,0,a,s);const r=new Image;return r.src=c.toDataURL(),r}function mt(){console.log("🎨 Creating backgrounds for trees only...");const t=f.grass;if(!t){console.error("❌ Grass tile not available for backgrounds");return}V("oak_tree_original","oak_tree",t),V("tree_t1","tree_t1",t),V("tree_t2","tree_t2",t),V("tree_t3","tree_t3",t),console.log("✅ Tree backgrounds created, library items left as-is")}function V(t,e,o){const i=f[t];if(!i){console.warn(`⚠️ Source tile ${t} not found, skipping background`);return}const n=document.createElement("canvas");n.width=64,n.height=64;const a=n.getContext("2d");if(!a){console.error(`❌ Could not get canvas context for ${e}`);return}a.drawImage(o,0,0,64,64),a.drawImage(i,0,0,64,64);const s=new Image;s.src=n.toDataURL(),f[e]=s,console.log(`✅ Created background for ${e}`)}function yt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.strokeStyle="#444",e.lineWidth=3,e.strokeRect(4,4,56,56),e.strokeStyle="#666",e.lineWidth=1,e.strokeRect(8,8,24,24),e.strokeRect(32,8,24,24),e.strokeRect(8,32,24,24),e.strokeRect(32,32,24,24),e.fillStyle="#FFD700",e.beginPath(),e.arc(48,32,3,0,Math.PI*2),e.fill());const o=new Image;o.src=t.toDataURL(),f.door=o,console.log("✅ Door tile created")}function bt(){console.log("📊 Creating diverse Data Science visualization tiles..."),wt(),xt(),vt(),At(),kt(),St(),Tt(),It(),Mt(),Rt(),Pt(),Ct(),Et(),Dt(),_t(),Bt(),Lt(),console.log("✅ Diverse Data Science and R&D visualization tiles created")}function wt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("NPS Analysis",5,12),e.strokeStyle="#00d084",e.lineWidth=2,e.beginPath();const i=[45,42,47,38,50,32,55];for(let n=0;n<i.length;n++){const a=8+n*8,s=i[n];n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke(),e.fillStyle="#00d084";for(let n=0;n<i.length;n++)e.beginPath(),e.arc(8+n*8,i[n],2,0,Math.PI*2),e.fill();e.fillStyle="#ffd700",e.font="bold 10px Arial",e.fillText("73",45,58)}const o=new Image;o.src=t.toDataURL(),f.nps_chart=o}function xt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Energy Cost",5,12),e.fillStyle="rgba(255, 165, 0, 0.3)",e.beginPath(),e.moveTo(8,55);const i=[45,38,42,35,40,30,35];for(let n=0;n<i.length;n++)e.lineTo(8+n*8,i[n]);e.lineTo(56,55),e.closePath(),e.fill(),e.strokeStyle="#ffa500",e.lineWidth=2,e.beginPath();for(let n=0;n<i.length;n++){const a=8+n*8,s=i[n];n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke(),e.fillStyle="#00ff88",e.font="bold 8px Arial",e.fillText("-23%",45,58)}const o=new Image;o.src=t.toDataURL(),f.energy_cost_chart=o}function vt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Fashion Sales",5,12),e.strokeStyle="#e91e63",e.lineWidth=2,e.beginPath();const i=[35,45,40,25,20,18,22,38,42,50,55,48];for(let n=0;n<i.length;n++){const a=8+n*4.5,s=i[n];n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke(),e.fillStyle="#ffc107",e.beginPath(),e.arc(8+10*4.5,55,3,0,Math.PI*2),e.fill(),e.fillStyle="#ffc107",e.font="bold 7px Arial",e.fillText("Peak",38,58)}const o=new Image;o.src=t.toDataURL(),f.fashion_retail_timeseries=o}function At(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Supply Chain",5,12);const i=[{x:15,y:25,color:"#00d084"},{x:35,y:20,color:"#ffc107"},{x:50,y:30,color:"#e91e63"},{x:25,y:45,color:"#9c27b0"},{x:45,y:50,color:"#2196f3"}];e.strokeStyle="#4a5568",e.lineWidth=1,e.beginPath(),e.moveTo(15,25),e.lineTo(35,20),e.moveTo(35,20),e.lineTo(50,30),e.moveTo(35,20),e.lineTo(25,45),e.moveTo(50,30),e.lineTo(45,50),e.moveTo(25,45),e.lineTo(45,50),e.stroke(),i.forEach(n=>{e.fillStyle=n.color,e.beginPath(),e.arc(n.x,n.y,4,0,Math.PI*2),e.fill()})}const o=new Image;o.src=t.toDataURL(),f.distribution_network_map=o}function kt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Forecast Dist",5,12),e.fillStyle="#3b82f6";const i=[15,25,35,40,35,25,20,15];for(let n=0;n<i.length;n++){const a=8+n*6,s=i[n];e.fillRect(a,55-s,5,s)}e.strokeStyle="#ef4444",e.lineWidth=2,e.beginPath();for(let n=0;n<50;n++){const a=8+n,s=55-(20+15*Math.exp(-Math.pow((n-25)/8,2)));n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke()}const o=new Image;o.src=t.toDataURL(),f.forecast_histogram=o}function St(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Box Plot",5,12),e.strokeStyle="#06b6d4",e.fillStyle="rgba(6, 182, 212, 0.3)",e.lineWidth=2,e.fillRect(20,25,24,15),e.strokeRect(20,25,24,15),e.beginPath(),e.moveTo(30,25),e.lineTo(30,40),e.stroke(),e.beginPath(),e.moveTo(15,32.5),e.lineTo(20,32.5),e.moveTo(44,32.5),e.lineTo(50,32.5),e.moveTo(15,30),e.lineTo(15,35),e.moveTo(50,30),e.lineTo(50,35),e.stroke(),e.fillStyle="#ef4444",e.beginPath(),e.arc(12,20,2,0,Math.PI*2),e.arc(55,45,2,0,Math.PI*2),e.fill());const o=new Image;o.src=t.toDataURL(),f.box_plot=o}function Tt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#f2c811",e.fillRect(0,0,64,64),e.fillStyle="#323130",e.font="bold 10px Arial",e.fillText("Dashboard",8,15);const i=32,n=35,a=15;[{angle:0,size:Math.PI*.6,color:"#0078d4"},{angle:Math.PI*.6,size:Math.PI*.8,color:"#00bcf2"},{angle:Math.PI*1.4,size:Math.PI*.6,color:"#40e0d0"}].forEach(c=>{e.fillStyle=c.color,e.beginPath(),e.moveTo(i,n),e.arc(i,n,a,c.angle,c.angle+c.size),e.closePath(),e.fill()}),e.fillStyle="#fff",e.fillRect(8,52,20,8),e.fillStyle="#323130",e.font="bold 8px Arial",e.fillText("87%",12,58)}const o=new Image;o.src=t.toDataURL(),f.powerbi_dashboard_left=o}function It(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#f2c811",e.fillRect(0,0,64,64),e.strokeStyle="#323130",e.lineWidth=2,e.beginPath();const i=[40,35,38,32,28,25,22];for(let n=0;n<i.length;n++){const a=8+n*8,s=i[n];n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke(),e.fillStyle="#0078d4";for(let n=0;n<i.length;n++)e.beginPath(),e.arc(8+n*8,i[n],2,0,Math.PI*2),e.fill();e.fillStyle="#323130",e.font="bold 8px Arial",e.fillText("↑23%",8,55),e.fillText("$2.1M",38,55)}const o=new Image;o.src=t.toDataURL(),f.powerbi_dashboard_right=o}function Mt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#3776ab",e.fillRect(0,0,64,32),e.fillStyle="#ffd343",e.fillRect(0,32,64,32),e.fillStyle="#fff",e.font="bold 10px Arial",e.fillText("Python",12,20),e.fillStyle="#000",e.font="bold 8px Arial",e.fillText("scikit",8,45),e.fillText("learn",8,55),e.fillStyle="#666",e.beginPath(),e.arc(50,45,8,0,Math.PI*2),e.fill(),e.fillStyle="#fff",e.fillText("ML",46,49));const o=new Image;o.src=t.toDataURL(),f.python_sklearn=o}function Rt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#ee4c2c",e.fillRect(0,0,64,32),e.fillStyle="#1a1a1a",e.fillRect(0,32,64,32),e.fillStyle="#fff",e.font="bold 10px Arial",e.fillText("PyTorch",10,20),e.fillStyle="#00d084",e.font="bold 8px Arial",e.fillText("Lang",8,45),e.fillText("Chain",8,55),e.strokeStyle="#00d084",e.lineWidth=2,e.beginPath(),e.arc(45,45,4,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(52,45,4,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(49,45),e.lineTo(48,45),e.stroke());const o=new Image;o.src=t.toDataURL(),f.pytorch_langchain=o}function Pt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Rec Tree",5,12),e.strokeStyle="#4a5568",e.lineWidth=1,e.fillStyle="#e53e3e",e.fillRect(28,18,8,6),e.fillStyle="#3182ce",e.fillRect(18,30,8,6),e.fillRect(38,30,8,6),e.fillStyle="#38a169",e.fillRect(10,42,6,5),e.fillRect(20,42,6,5),e.fillRect(38,42,6,5),e.fillRect(48,42,6,5),e.beginPath(),e.moveTo(32,24),e.lineTo(22,30),e.moveTo(32,24),e.lineTo(42,30),e.moveTo(22,36),e.lineTo(13,42),e.moveTo(22,36),e.lineTo(23,42),e.moveTo(42,36),e.lineTo(41,42),e.moveTo(42,36),e.lineTo(51,42),e.stroke(),e.fillStyle="#ffd700",e.font="6px Arial",e.fillText("0.89",10,58),e.fillText("0.76",20,58),e.fillText("0.91",38,58),e.fillText("0.82",48,58));const o=new Image;o.src=t.toDataURL(),f.recommendation_tree=o}function Ct(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#0078d4",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Azure",18,15),e.font="bold 7px Arial",e.fillText("Machine",12,28),e.fillText("Learning",12,38),e.strokeStyle="#fff",e.lineWidth=2,e.beginPath(),e.moveTo(10,50),e.lineTo(25,50),e.lineTo(40,50),e.lineTo(55,50),e.stroke(),e.fillStyle="#fff",e.beginPath(),e.arc(10,50,3,0,Math.PI*2),e.arc(25,50,3,0,Math.PI*2),e.arc(40,50,3,0,Math.PI*2),e.arc(55,50,3,0,Math.PI*2),e.fill());const o=new Image;o.src=t.toDataURL(),f.azure_ml=o}function Et(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#0078d4",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Azure",18,15),e.font="bold 7px Arial",e.fillText("Data",20,28),e.fillText("Factory",16,38),e.strokeStyle="#fff",e.lineWidth=2,e.fillStyle="#fff",e.fillRect(8,45,8,6),e.beginPath(),e.moveTo(20,48),e.lineTo(35,48),e.stroke(),e.fillStyle="#ffd700",e.beginPath(),e.arc(35,48,4,0,Math.PI*2),e.fill(),e.strokeStyle="#fff",e.beginPath(),e.moveTo(39,48),e.lineTo(50,48),e.stroke(),e.fillStyle="#fff",e.fillRect(50,45,8,6));const o=new Image;o.src=t.toDataURL(),f.azure_data_factory=o}function Dt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){const i=e.createLinearGradient(0,0,0,64);i.addColorStop(0,"#1a202c"),i.addColorStop(1,"#2d3748"),e.fillStyle=i,e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Chatbot AI",5,12),e.fillStyle="#3182ce",e.fillRect(35,20,24,8),e.fillStyle="#fff",e.font="6px Arial",e.fillText("Hello!",38,26),e.fillStyle="#00d084",e.fillRect(5,32,30,8),e.fillStyle="#fff",e.fillText("How can I help?",7,38),e.fillStyle="#3182ce",e.fillRect(28,44,31,8),e.fillStyle="#fff",e.fillText("Recommend...",30,50),e.fillStyle="#ffd700",e.beginPath(),e.arc(12,58,6,0,Math.PI*2),e.fill(),e.fillStyle="#1a202c",e.beginPath(),e.arc(10,56,1,0,Math.PI*2),e.arc(14,56,1,0,Math.PI*2),e.fill(),e.strokeStyle="#1a202c",e.lineWidth=1,e.beginPath(),e.arc(12,58,3,0,Math.PI),e.stroke(),e.fillStyle="#9ca3af",e.font="6px Arial",e.fillText("●●●",45,58)}const o=new Image;o.src=t.toDataURL(),f.chatbot_ai=o}function _t(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#000000",e.fillRect(0,0,64,64),e.fillStyle="#86bc25",e.font="bold 9px Arial",e.fillText("Deloitte",12,20),e.font="bold 8px Arial",e.fillText("Consulting",8,32),e.fillStyle="#86bc25",e.beginPath(),e.arc(56,16,2,0,Math.PI*2),e.fill(),e.font="6px Arial",e.fillText("2022-2023",15,55));const o=new Image;o.src=t.toDataURL(),f.deloitte_consulting=o}function Bt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Gantt Chart",5,12),e.fillStyle="#4a5568",e.fillRect(0,16,64,8),e.fillStyle="#fff",e.font="6px Arial",e.fillText("Q1",8,22),e.fillText("Q2",24,22),e.fillText("Q3",40,22),e.fillText("Q4",56,22),e.fillStyle="#3182ce",e.fillRect(6,28,18,4),e.fillStyle="#10b981",e.fillRect(14,36,24,4),e.fillStyle="#f59e0b",e.fillRect(32,44,20,4),e.fillStyle="#ef4444",e.fillRect(48,52,12,4),e.fillStyle="#86bc25",e.fillRect(6,28,12,4),e.fillRect(14,36,16,4),e.fillRect(32,44,8,4),e.strokeStyle="#dc2626",e.lineWidth=1,e.setLineDash([2,2]),e.beginPath(),e.moveTo(28,25),e.lineTo(28,58),e.stroke(),e.setLineDash([]));const o=new Image;o.src=t.toDataURL(),f.gantt_chart=o}function Lt(){console.log("🔴 Creating R&D System Engineer visualization tiles..."),Ut(),Ft(),$t(),zt(),Wt(),Nt(),jt(),Gt(),Ot(),qt(),Yt(),Qt(),Ht(),Jt(),Vt(),Xt(),Zt(),console.log("✅ R&D System Engineer visualization tiles created")}function Ut(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("IR Spectrum",5,12),e.fillStyle="#ff4444",e.font="6px Arial",e.fillText("Hot",5,22),e.fillStyle="#4444ff",e.fillText("Cold",45,22);const i=e.createLinearGradient(0,25,64,25);i.addColorStop(0,"#000080"),i.addColorStop(.3,"#0080ff"),i.addColorStop(.5,"#00ff00"),i.addColorStop(.7,"#ffff00"),i.addColorStop(.9,"#ff8000"),i.addColorStop(1,"#ff0000"),e.fillStyle=i,e.fillRect(5,25,54,20),e.fillStyle="#fff",e.font="5px Arial",e.fillText("3-5μm",8,52),e.fillText("8-12μm",35,52),e.strokeStyle="#fff",e.lineWidth=1,e.strokeRect(5,25,20,20),e.strokeRect(35,25,24,20)}const o=new Image;o.src=t.toDataURL(),f.ir_spectrum=o}function Ft(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 7px Arial",e.fillText("Atmos Trans",5,12),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.moveTo(10,55),e.lineTo(58,55),e.moveTo(10,55),e.lineTo(10,20),e.stroke(),e.fillStyle="#aaa",e.font="5px Arial",e.fillText("λ(μm)",45,60),e.fillText("T%",2,25),e.strokeStyle="#00ff88",e.lineWidth=2,e.beginPath();const i=[{x:12,y:45},{x:16,y:35},{x:20,y:25},{x:24,y:25},{x:28,y:25},{x:32,y:45},{x:36,y:45},{x:40,y:25},{x:44,y:25},{x:48,y:25},{x:52,y:45},{x:56,y:50}];for(let n=0;n<i.length;n++)n===0?e.moveTo(i[n].x,i[n].y):e.lineTo(i[n].x,i[n].y);e.stroke(),e.fillStyle="rgba(0, 255, 136, 0.2)",e.fillRect(20,20,8,35),e.fillRect(40,20,8,35)}const o=new Image;o.src=t.toDataURL(),f.atmospheric_transmission=o}function $t(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Multi-Cam",12,12),e.fillStyle="#444",e.beginPath(),e.arc(32,32,12,0,Math.PI*2),e.fill(),[{angle:0,color:"#ff4444"},{angle:Math.PI/2,color:"#44ff44"},{angle:Math.PI,color:"#4444ff"},{angle:3*Math.PI/2,color:"#ffff44"},{angle:Math.PI/4,color:"#ff44ff"},{angle:3*Math.PI/4,color:"#44ffff"}].forEach(n=>{const a=32+Math.cos(n.angle)*18,s=32+Math.sin(n.angle)*18;e.fillStyle=n.color,e.fillRect(a-3,s-3,6,6),e.strokeStyle=n.color,e.lineWidth=1,e.globalAlpha=.3,e.beginPath(),e.moveTo(a,s),e.arc(a,s,12,n.angle-Math.PI/6,n.angle+Math.PI/6),e.closePath(),e.stroke(),e.globalAlpha=1}),e.fillStyle="#fff",e.font="6px Arial",e.fillText("360°",26,58));const o=new Image;o.src=t.toDataURL(),f.multi_camera_array=o}function zt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#C8102E",e.fillRect(0,0,64,64),e.fillStyle="#ffffff",e.font="bold 12px Arial",e.textAlign="center",e.fillText("Leonardo",32,26),e.font="bold 10px Arial",e.fillText("SpA",32,42),e.font="8px Arial",e.fillText("2024 - present",32,56));const o=new Image;o.src=t.toDataURL(),f.leonardo_spa=o}function Wt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Detection",8,12),e.fillStyle="#333",e.fillRect(5,18,54,40),[{x:15,y:25,w:12,h:8,conf:"0.92",color:"#00ff88"},{x:35,y:30,w:10,h:10,conf:"0.87",color:"#ffaa00"},{x:45,y:40,w:8,h:6,conf:"0.76",color:"#ff4444"}].forEach(n=>{e.fillStyle=n.color,e.globalAlpha=.6,e.fillRect(n.x+2,n.y+2,n.w-4,n.h-4),e.globalAlpha=1,e.strokeStyle=n.color,e.lineWidth=1,e.strokeRect(n.x,n.y,n.w,n.h),e.fillStyle=n.color,e.font="5px Arial",e.fillText(n.conf,n.x,n.y-1)}));const o=new Image;o.src=t.toDataURL(),f.object_detection=o}function Nt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Kalman",15,12),e.strokeStyle="#4444ff",e.lineWidth=2,e.setLineDash([3,3]),e.beginPath(),e.moveTo(10,50),e.quadraticCurveTo(25,30,50,25),e.stroke(),e.setLineDash([]),e.fillStyle="#ff4444";const i=[{x:12,y:48},{x:20,y:38},{x:30,y:32},{x:42,y:28},{x:48,y:26}];i.forEach(n=>{e.beginPath(),e.arc(n.x,n.y,2,0,Math.PI*2),e.fill()}),e.strokeStyle="#00ff88",e.lineWidth=1,i.forEach((n,a)=>{const s=4+a*1.5;e.beginPath(),e.ellipse(n.x,n.y,s,s*.6,0,0,Math.PI*2),e.stroke()}),e.font="5px Arial",e.fillStyle="#4444ff",e.fillText("Pred",5,20),e.fillStyle="#ff4444",e.fillText("Meas",5,28),e.fillStyle="#00ff88",e.fillText("Uncert",5,36)}const o=new Image;o.src=t.toDataURL(),f.kalman_filter=o}function jt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Opt Flow",12,12),e.strokeStyle="#00ffaa",e.lineWidth=1;for(let i=15;i<55;i+=12)for(let n=20;n<55;n+=12){const a=(i-32)*.1+Math.sin(i*.1)*3,s=(n-35)*.1+Math.cos(n*.1)*2;e.beginPath(),e.moveTo(i,n),e.lineTo(i+a,n+s),e.stroke();const c=Math.atan2(s,a);e.beginPath(),e.moveTo(i+a,n+s),e.lineTo(i+a-3*Math.cos(c-Math.PI/6),n+s-3*Math.sin(c-Math.PI/6)),e.moveTo(i+a,n+s),e.lineTo(i+a-3*Math.cos(c+Math.PI/6),n+s-3*Math.sin(c+Math.PI/6)),e.stroke()}}const o=new Image;o.src=t.toDataURL(),f.optical_flow=o}function Gt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("360° Warn",8,12),e.fillStyle="#444",e.beginPath(),e.arc(32,32,8,0,Math.PI*2),e.fill(),[{start:0,end:Math.PI/2,color:"#00ff88"},{start:Math.PI/2,end:Math.PI,color:"#ffaa00"},{start:Math.PI,end:3*Math.PI/2,color:"#ff4444"},{start:3*Math.PI/2,end:2*Math.PI,color:"#4488ff"}].forEach(n=>{e.fillStyle=n.color,e.globalAlpha=.3,e.beginPath(),e.moveTo(32,32),e.arc(32,32,25,n.start,n.end),e.closePath(),e.fill(),e.globalAlpha=1,e.strokeStyle=n.color,e.lineWidth=2,e.beginPath(),e.moveTo(32,32),e.lineTo(32+Math.cos(n.start)*25,32+Math.sin(n.start)*25),e.stroke()}),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.arc(32,32,15,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(32,32,25,0,Math.PI*2),e.stroke(),e.fillStyle="#aaa",e.font="5px Arial",e.fillText("20km",5,58),e.fillText("40km",45,58));const o=new Image;o.src=t.toDataURL(),f.coverage_360=o}function Ot(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Threats",15,12),e.strokeStyle="#00ff88",e.lineWidth=1,e.strokeRect(5,16,54,42),[{x:15,y:25,level:"HIGH",color:"#ff4444"},{x:35,y:30,level:"MED",color:"#ffaa00"},{x:45,y:40,level:"LOW",color:"#44ff44"}].forEach((n,a)=>{e.fillStyle=n.color,e.beginPath(),e.moveTo(n.x,n.y-3),e.lineTo(n.x-3,n.y+3),e.lineTo(n.x+3,n.y+3),e.closePath(),e.fill(),e.font="5px Arial",e.fillText(n.level,n.x-6,n.y+8),e.fillStyle="#aaa",e.font="4px Arial",e.fillText(`${15+a*5}km`,n.x-8,n.y+12),e.fillText(`${45+a*30}°`,n.x-6,n.y+16)}),e.fillStyle="#00ff88",e.fillRect(8,52,6,4),e.fillStyle="#fff",e.font="5px Arial",e.fillText("ACTIVE",16,55));const o=new Image;o.src=t.toDataURL(),f.threat_interface=o}function qt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("MTT",25,12),[{x:15,y:25,id:"T1",color:"#ff4444",history:[{x:10,y:30},{x:12,y:28},{x:15,y:25}]},{x:40,y:35,id:"T2",color:"#44ff44",history:[{x:35,y:30},{x:38,y:32},{x:40,y:35}]},{x:25,y:45,id:"T3",color:"#4444ff",history:[{x:20,y:50},{x:22,y:48},{x:25,y:45}]}].forEach(n=>{e.strokeStyle=n.color,e.lineWidth=1,e.globalAlpha=.5,e.beginPath(),n.history.forEach((a,s)=>{s===0?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)}),e.stroke(),e.globalAlpha=1,e.fillStyle=n.color,e.beginPath(),e.arc(n.x,n.y,3,0,Math.PI*2),e.fill(),e.font="6px Arial",e.fillText(n.id,n.x+5,n.y-2),e.strokeStyle=n.color,e.lineWidth=2,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x+8,n.y-3),e.stroke()}),e.fillStyle="#fff",e.font="5px Arial",e.fillText("3 TRACKS",5,58));const o=new Image;o.src=t.toDataURL(),f.multi_target_tracking=o}function Yt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#e97627",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 10px Arial",e.fillText("MATLAB",8,18),e.font="bold 8px Arial",e.fillText("Simulink",10,30),e.strokeStyle="#fff",e.fillStyle="rgba(255, 255, 255, 0.2)",e.lineWidth=1,e.fillRect(8,38,12,8),e.strokeRect(8,38,12,8),e.fillStyle="#fff",e.font="5px Arial",e.fillText("In",12,44),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(25,36,14,12),e.strokeRect(25,36,14,12),e.fillStyle="#fff",e.fillText("Filter",27,43),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(44,38,12,8),e.strokeRect(44,38,12,8),e.fillStyle="#fff",e.fillText("Out",47,44),e.strokeStyle="#fff",e.beginPath(),e.moveTo(20,42),e.lineTo(25,42),e.moveTo(39,42),e.lineTo(44,42),e.stroke(),e.font="6px Arial",e.fillText("R2023b",18,58));const o=new Image;o.src=t.toDataURL(),f.matlab_simulink=o}function Qt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("IR System",8,12),[{x:8,y:18,w:16,h:8,label:"IR Sensor",color:"#ff4444"},{x:40,y:18,w:16,h:8,label:"ADC",color:"#44ff44"},{x:8,y:32,w:16,h:8,label:"DSP",color:"#4444ff"},{x:40,y:32,w:16,h:8,label:"CPU",color:"#ffaa00"},{x:24,y:46,w:16,h:8,label:"Display",color:"#aa44ff"}].forEach(n=>{e.fillStyle=n.color,e.globalAlpha=.3,e.fillRect(n.x,n.y,n.w,n.h),e.globalAlpha=1,e.strokeStyle=n.color,e.lineWidth=1,e.strokeRect(n.x,n.y,n.w,n.h),e.fillStyle="#fff",e.font="5px Arial",e.fillText(n.label,n.x+2,n.y+6)}),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.moveTo(24,22),e.lineTo(40,22),e.moveTo(16,26),e.lineTo(16,32),e.moveTo(48,26),e.lineTo(48,32),e.moveTo(24,36),e.lineTo(32,46),e.moveTo(40,36),e.lineTo(32,46),e.stroke());const o=new Image;o.src=t.toDataURL(),f.system_architecture=o}function Ht(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Specs",18,12),e.strokeStyle="#666",e.lineWidth=1;const i=5,n=3,a=16,s=7,c=6,l=18;for(let d=0;d<=i;d++)e.beginPath(),e.moveTo(c,l+d*s),e.lineTo(c+n*a,l+d*s),e.stroke();for(let d=0;d<=n;d++)e.beginPath(),e.moveTo(c+d*a,l),e.lineTo(c+d*a,l+i*s),e.stroke();e.fillStyle="#4a5568",e.fillRect(c+1,l+1,n*a-2,s-2),[{r:1,c:0,color:"#00ff88"},{r:1,c:1,color:"#ffaa00"},{r:2,c:0,color:"#00ff88"},{r:2,c:2,color:"#ff4444"},{r:3,c:1,color:"#00ff88"}].forEach(d=>{e.fillStyle=d.color,e.globalAlpha=.6,e.fillRect(c+d.c*a+1,l+d.r*s+1,a-2,s-2),e.globalAlpha=1}),e.font="4px Arial",e.fillStyle="#00ff88",e.fillText("✓ PASS",6,58),e.fillStyle="#ff4444",e.fillText("✗ FAIL",30,58)}const o=new Image;o.src=t.toDataURL(),f.requirements_specs=o}function Jt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("IR Detector",8,12),e.fillStyle="#444",e.fillRect(18,20,28,20),e.strokeStyle="#666",e.lineWidth=1,e.strokeRect(18,20,28,20),e.fillStyle="#2a2a2a",e.beginPath(),e.arc(32,30,8,0,Math.PI*2),e.fill(),e.strokeStyle="#888",e.stroke(),e.strokeStyle="#666",e.lineWidth=.5,e.beginPath(),e.arc(32,30,6,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(32,30,4,0,Math.PI*2),e.stroke(),e.strokeStyle="#666",e.lineWidth=1;for(let i=0;i<5;i++){const n=20+i*5;e.beginPath(),e.moveTo(n,42),e.lineTo(n,48),e.stroke()}e.fillStyle="#aaa",e.font="5px Arial",e.fillText("MWIR/LWIR",15,52),e.fillText("InSb/MCT",18,58),e.fillStyle="#d4af37";for(let i=0;i<3;i++)e.fillRect(46+i*2,35,1,4)}const o=new Image;o.src=t.toDataURL(),f.ir_detector=o}function Vt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#6e6e6e",e.fillRect(0,0,64,64);const i=16,n=8,a=1;e.fillStyle="#5a5a5a";for(let s=0;s<64;s+=n+a)e.fillRect(0,s,64,a);for(let s=0;s<Math.ceil(64/(n+a));s++){const c=s*(n+a),l=s%2*(i/2);for(let r=l;r<64+i;r+=i+a)e.fillRect(r,c,a,n+a)}e.globalAlpha=.1;for(let s=0;s<Math.ceil(64/(n+a));s++)for(let c=0;c<Math.ceil(64/(i+a));c++){const l=c*(i+a)+s%2*(i/2),r=s*(n+a),d=Math.random()*.3-.15;e.fillStyle=d>0?"#ffffff":"#000000",e.fillRect(l+a,r+a,i-a,n-a)}e.globalAlpha=1,e.fillStyle="rgba(0, 0, 0, 0.1)",e.fillRect(62,0,2,64),e.fillRect(0,62,64,2)}const o=new Image;o.src=t.toDataURL(),f.brick_wall=o}function Xt(){[{name:"flag_au",code:"AU",colors:["#012169","#ffffff","#ff0000"]},{name:"flag_us",code:"US",colors:["#b22234","#ffffff","#3c3b6e"]},{name:"flag_jp",code:"JP",colors:["#ffffff","#bc002d"]},{name:"flag_vn",code:"VN",colors:["#da251d","#ffff00"]},{name:"flag_mv",code:"MV",colors:["#d21034","#007e3a","#ffffff"]},{name:"flag_it",code:"IT",colors:["#009246","#ffffff","#ce2b37"]},{name:"flag_fr",code:"FR",colors:["#0055a4","#ffffff","#ef4135"]},{name:"flag_de",code:"DE",colors:["#000000","#dd0000","#ffce00"]},{name:"flag_es",code:"ES",colors:["#aa151b","#f1bf00","#aa151b"]},{name:"flag_gb",code:"GB",colors:["#012169","#ffffff","#c8102e"]},{name:"flag_nl",code:"NL",colors:["#21468b","#ffffff","#ae1c28"]},{name:"flag_ch",code:"CH",colors:["#ff0000","#ffffff"]},{name:"flag_ma",code:"MA",colors:["#c1272d","#006233"]},{name:"flag_eg",code:"EG",colors:["#ce1126","#ffffff","#000000"]}].forEach(e=>{const o=document.createElement("canvas");o.width=64,o.height=64;const i=o.getContext("2d");if(i){if(i.fillStyle=e.colors[0],i.fillRect(0,0,64,64),e.colors.length>=2)if(e.code==="IT"||e.code==="FR"||e.code==="NL")i.fillStyle=e.colors[1],i.fillRect(21,0,22,64),e.colors[2]&&(i.fillStyle=e.colors[2],i.fillRect(43,0,21,64));else if(e.code==="DE"||e.code==="EG")i.fillStyle=e.colors[1],i.fillRect(0,21,64,22),e.colors[2]&&(i.fillStyle=e.colors[2],i.fillRect(0,43,64,21));else if(e.code==="US"){i.fillStyle=e.colors[1],i.fillRect(0,0,64,64),i.fillStyle=e.colors[0];for(let a=0;a<7;a++)i.fillRect(0,a*10+2,64,5);i.fillStyle=e.colors[2],i.fillRect(0,0,28,36),i.fillStyle=e.colors[1],i.font="4px Arial";for(let a=0;a<5;a++)for(let s=0;s<6;s++)(a+s)%2===0&&i.fillText("★",3+s*4,6+a*6)}else if(e.code==="AU"){i.fillStyle=e.colors[0],i.fillRect(0,0,64,64);const a=32,s=32;i.fillStyle=e.colors[1],i.fillRect(0,0,a,s),i.fillStyle=e.colors[0],i.fillRect(0,0,a,s),i.fillStyle=e.colors[1],i.lineWidth=4,i.beginPath(),i.moveTo(0,0),i.lineTo(a,s),i.moveTo(0,s),i.lineTo(a,0),i.stroke(),i.fillStyle=e.colors[1],i.fillRect(0,s/2-2,a,4),i.fillRect(a/2-2,0,4,s),i.fillStyle=e.colors[2],i.fillRect(0,s/2-1,a,2),i.fillRect(a/2-1,0,2,s),i.strokeStyle=e.colors[2],i.lineWidth=2,i.beginPath(),i.moveTo(2,0),i.lineTo(a,s-2),i.moveTo(0,2),i.lineTo(a-2,s),i.moveTo(a-2,0),i.lineTo(0,s-2),i.moveTo(a,2),i.lineTo(2,s),i.stroke(),i.fillStyle=e.colors[1],i.font="6px Arial",i.fillText("★",40,20),i.fillText("★",50,30),i.fillText("★",45,40),i.fillText("★",55,50),i.fillText("★",35,55)}else e.code==="GB"?(i.fillStyle=e.colors[0],i.fillRect(0,0,64,64),i.fillStyle=e.colors[1],i.fillRect(0,28,64,8),i.fillRect(28,0,8,64),i.fillStyle=e.colors[2],i.fillRect(0,30,64,4),i.fillRect(30,0,4,64)):e.code==="JP"?(i.fillStyle=e.colors[0],i.fillRect(0,0,64,64),i.fillStyle=e.colors[1],i.beginPath(),i.arc(32,32,16,0,Math.PI*2),i.fill()):e.code==="ES"?(i.fillStyle=e.colors[0],i.fillRect(0,0,64,16),i.fillStyle=e.colors[1],i.fillRect(0,16,64,32),i.fillStyle=e.colors[2],i.fillRect(0,48,64,16)):e.code==="CH"?(i.fillStyle=e.colors[0],i.fillRect(0,0,64,64),i.fillStyle=e.colors[1],i.fillRect(0,24,64,16),i.fillRect(24,0,16,64)):(i.fillStyle=e.colors[1],i.fillRect(0,32,64,32));i.fillStyle="#000000",i.font="bold 8px Arial",i.textAlign="center",i.strokeStyle="#ffffff",i.lineWidth=2,i.strokeText(e.code,32,58),i.fillText(e.code,32,58)}const n=new Image;n.src=o.toDataURL(),f[e.name]=n})}function Zt(){console.log("🎯 Creating Boss Room tiles..."),Kt(),eo(),console.log("✅ Boss Room tiles created")}function Kt(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(e){e.fillStyle="#228B22",e.fillRect(0,0,64,64);const i=f.main_guy_sprite_sheet;i?e.drawImage(i,0,0,36,36,5,5,54,54):(e.fillStyle="#fff",e.font="12px Arial",e.textAlign="center",e.fillText("BOSS",32,35))}const o=new Image;o.src=t.toDataURL(),f.main_guy=o}function eo(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#228B22",e.fillRect(0,0,64,64),[{x:15,y:20,color:"#ff69b4",size:4},{x:35,y:15,color:"#ffd700",size:3},{x:45,y:35,color:"#ff6347",size:4},{x:20,y:45,color:"#9370db",size:3},{x:50,y:50,color:"#00ced1",size:3}].forEach(n=>{e.fillStyle=n.color;for(let a=0;a<5;a++){const s=a*Math.PI*2/5,c=n.x+Math.cos(s)*n.size,l=n.y+Math.sin(s)*n.size;e.beginPath(),e.arc(c,l,n.size/2,0,Math.PI*2),e.fill()}e.fillStyle="#ffff00",e.beginPath(),e.arc(n.x,n.y,n.size/3,0,Math.PI*2),e.fill(),e.strokeStyle="#228b22",e.lineWidth=1,e.beginPath(),e.moveTo(n.x,n.y+n.size/3),e.lineTo(n.x,n.y+n.size+2),e.stroke()}));const o=new Image;o.src=t.toDataURL(),f.flower=o}function Ue(){return f}he.getAssets=Ue;const we=32,xe=32,X=64;function to(){const t=he.getAssets().player_sprite_sheet;function e(o,i){const n=document.createElement("canvas");n.width=X,n.height=X;const a=n.getContext("2d");if(!a)throw new Error("Failed to get 2D context");return a.drawImage(t,i*we,o*xe,we,xe,0,0,X,X),n}y.down_walk.push(e(0,0)),y.right_walk.push(e(1,1)),y.up_walk.push(e(2,1)),y.down_idle.push(y.down_walk[0]),y.right_idle.push(y.right_walk[0]),y.up_idle.push(y.up_walk[0])}let D=!1,$=null;const ve={x:5,y:1},oo=1;function no(){io(),console.log("Boss interaction system initialized")}function io(){$=document.createElement("div"),$.id="boss-interaction-prompt",$.style.cssText=`
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 15px 25px;
    border-radius: 12px;
    font-family: Arial, sans-serif;
    font-size: 18px;
    font-weight: bold;
    display: none;
    z-index: 1500;
    border: 3px solid #FFD700;
    text-align: center;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.7);
    animation: pulse 2s infinite;
  `;const t=document.createElement("style");t.textContent=`
    @keyframes pulse {
      0% { border-color: #FFD700; }
      50% { border-color: #FFA500; }
      100% { border-color: #FFD700; }
    }
  `,document.head.appendChild(t),$.innerHTML=`
    <div>💬 Press SPACE to talk to Nicolo</div>
    <div style="font-size: 14px; margin-top: 5px; opacity: 0.8;">Ask questions about my CV and experience!</div>
  `,document.body.appendChild($)}function ao(){if(fe().id!=="room2")return D&&Ae(),!1;const o=Math.abs(h.x-ve.x)+Math.abs(h.y-ve.y)<=oo;return o&&!D?(so(),D=!0,console.log("Player is near boss - showing interaction prompt")):!o&&D&&(Ae(),D=!1,console.log("Player left boss proximity - hiding prompt")),o}function so(){Ee("💬 Press SPACE to talk to Nicolo - Ask about my CV!",4e3)}function Ae(){const t=document.getElementById("status-text");t&&t.textContent?.includes("talk to Nicolo")&&(t.textContent="")}function lo(){return D}const ro="modulepreload",co=function(t){return"/MyImmersiveExperience/"+t},ke={},fo=function(e,o,i){let n=Promise.resolve();if(o&&o.length>0){let l=function(r){return Promise.all(r.map(d=>Promise.resolve(d).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),c=s?.nonce||s?.getAttribute("nonce");n=l(o.map(r=>{if(r=co(r),r in ke)return;ke[r]=!0;const d=r.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${g}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":ro,d||(u.as="script"),u.crossOrigin="",u.href=r,c&&u.setAttribute("nonce",c),document.head.appendChild(u),d)return new Promise((T,M)=>{u.addEventListener("load",T),u.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${r}`)))})}))}function a(s){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=s,window.dispatchEvent(c),!c.defaultPrevented)throw s}return n.then(s=>{for(const c of s||[])c.status==="rejected"&&a(c.reason);return e().catch(a)})},ho="https://huggingface.co/datasets/huggingface/sample-test-data/resolve/main/sample.jsonl";async function go(){console.log("🔍 Detecting network speed...");const t=uo();if(t.speed>0)return console.log(`📡 Network API detected: ${t.speed} Mbps`),{speed:t.speed,confidence:"medium",method:"connection_api",warning:t.speed<1.5?`Very slow connection detected (${t.speed} Mbps). 1.8GB download may take 3+ hours.`:void 0};try{const e=await po();return console.log(`⚡ Speed test result: ${e.speed} Mbps`),{speed:e.speed,confidence:e.confidence,method:"speed_test",warning:e.speed<1.5?`Slow connection detected (${e.speed.toFixed(1)} Mbps). Large model download not recommended.`:e.speed<5?`Moderate connection speed (${e.speed.toFixed(1)} Mbps). Download may take 10+ minutes.`:void 0}}catch(e){return console.warn("❌ Speed test failed:",e),{speed:2.5,confidence:"low",method:"estimate",warning:"Could not detect connection speed. Download time may vary significantly."}}}function uo(){const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return t&&t.downlink?{speed:t.downlink}:{speed:0}}async function po(){const t=Date.now();try{const e=await fetch(ho,{cache:"no-store",method:"GET"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.blob(),n=(Date.now()-t)/1e3,a=o.size/1024,c=a*8/n/1e3;let l="medium";return n<.5?l="low":n>2&&a>30&&(l="high"),console.log(`📊 Speed test details: ${a.toFixed(0)}KB in ${n.toFixed(2)}s = ${c.toFixed(1)} Mbps`),{speed:Math.max(c,.1),confidence:l}}catch(e){throw console.error("Speed test failed:",e),e}}function mo(t,e){const o=t*1024,i=e/8,n=o/i,a=n/60;let s;if(a<1)s=`${Math.round(n)}s`;else if(a<60)s=`${Math.round(a)}m`;else{const l=Math.floor(a/60),r=Math.round(a%60);s=`${l}h ${r}m`}let c;return a<=5?c="good":a<=15?c="acceptable":a<=60?c="slow":c="very_slow",{timeMinutes:a,timeFormatted:s,recommendation:c}}async function yo(t=1.8){const e=await go(),o=mo(t,e.speed);return{shouldWarn:o.recommendation==="very_slow"||o.recommendation==="slow"||e.speed<2,networkInfo:e,estimate:o}}const Fe="phi3_model_consent",ge="phi3_download_state";function $e(t){try{return localStorage.getItem(`${Fe}_${t}`)==="approved"}catch{return console.warn("Cannot access localStorage for consent check"),!1}}function bo(t,e){try{localStorage.setItem(`${Fe}_${t}`,e?"approved":"denied"),e&&localStorage.setItem(`${ge}_${t}`,"user_approved")}catch{console.warn("Cannot store user consent in localStorage")}}function wo(t){try{const e=localStorage.getItem(`${ge}_${t}`),o=e==="user_approved";return console.log(`🔍 Download approval check for ${t}: ${o} (stored: ${e})`),o}catch{return console.warn("Cannot access localStorage for download state"),!1}}function xo(t){try{localStorage.setItem(`${ge}_${t}`,"user_approved"),console.log(`✅ Marked ${t} as user approved`)}catch{console.warn("Cannot store download approval state")}}async function vo(t,e,o){if(console.log(`🤔 Checking consent for ${t}...`),$e(t))return console.log(`✅ ${t} has permanent consent, skipping dialog`),{approved:!0};if(window.aiModels&&window.aiModels[t])return console.log(`✅ ${t} already loaded, skipping consent`),{approved:!0};console.log(`🔍 First time requesting ${t} - showing consent dialog with network analysis`);const i=parseFloat(e.size.replace("~","").replace("GB",""));console.log("🔍 Checking network capabilities...");const n=await yo(i),a=n.estimate.timeFormatted,s={modelName:e.name,size:e.size,description:e.description,requirements:[`${e.minMemoryGB}GB RAM`,"Desktop browser recommended",...e.recommendedWebGPU?["WebGPU support (Chrome/Edge)"]:[]],benefits:["Advanced conversational AI","Professional-quality responses","Better understanding of context","More detailed explanations"],estimatedTime:a};return new Promise(c=>{Ao(s,n,l=>{l.approved&&(xo(t),l.remember&&bo(t,!0)),c(l)})})}function Ao(t,e,o){const i=document.createElement("div");i.id="model-consent-overlay",i.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    backdrop-filter: blur(5px);
  `;const n=document.createElement("div");n.style.cssText=`
    background: white;
    border-radius: 12px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    font-family: 'Courier New', monospace;
  `,n.innerHTML=`
    <div style="text-align: center; margin-bottom: 20px;">
      <h2 style="margin: 0; color: #333; font-size: 24px;">🧠 Phi-3 Advanced AI</h2>
      <p style="margin: 10px 0; color: #666; font-size: 14px;">Enhanced conversational intelligence for your CV</p>
    </div>

    <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
      <h3 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">📊 Download Information</h3>
      <ul style="margin: 0; padding-left: 20px; color: #555; line-height: 1.6;">
        <li><strong>Size:</strong> ${t.size}</li>
        <li><strong>Connection Speed:</strong> ${e.networkInfo.speed.toFixed(1)} Mbps</li>
        <li><strong>Estimated Time:</strong> ${t.estimatedTime}</li>
        <li><strong>One-time download</strong> (cached for future use)</li>
      </ul>
    </div>

    ${e.shouldWarn?`
    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
      <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 16px;">⚠️ Connection Warning</h3>
      <p style="margin: 0; color: #856404; line-height: 1.6; font-size: 14px;">
        ${e.networkInfo.warning||`Slow connection detected. Download may take ${t.estimatedTime}.`}
      </p>
      <p style="margin: 10px 0 0 0; color: #856404; line-height: 1.6; font-size: 13px;">
        💡 <strong>Recommendations:</strong> Switch to WiFi, use a faster connection, or try the lighter Qwen model instead.
      </p>
    </div>
    `:""}

    <div style="background: #e7f3ff; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
      <h3 style="margin: 0 0 10px 0; color: #0066cc; font-size: 16px;">⚡ What You'll Get</h3>
      <ul style="margin: 0; padding-left: 20px; color: #0066cc; line-height: 1.6;">
        ${t.benefits.map(g=>`<li>${g}</li>`).join("")}
      </ul>
    </div>

    <div style="background: #fff3cd; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
      <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 16px;">🔧 Requirements</h3>
      <ul style="margin: 0; padding-left: 20px; color: #856404; line-height: 1.6;">
        ${t.requirements.map(g=>`<li>${g}</li>`).join("")}
      </ul>
    </div>

    <div style="background: #d1ecf1; border-radius: 8px; padding: 15px; margin-bottom: 25px;">
      <p style="margin: 0; color: #0c5460; font-size: 13px; text-align: center;">
        💡 <strong>Tip:</strong> You can always switch back to lighter models (DistilBERT/Qwen) anytime
      </p>
    </div>

    <div style="margin-bottom: 20px;">
      <label style="display: flex; align-items: center; cursor: pointer; color: #333;">
        <input type="checkbox" id="remember-choice" style="margin-right: 10px; transform: scale(1.2);">
        <span>Remember my choice (don't ask again)</span>
      </label>
    </div>

    <div style="display: flex; gap: 15px; justify-content: center;">
      <button id="consent-cancel" style="
        padding: 12px 24px;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        transition: background-color 0.2s;
      ">Maybe Later</button>
      
      <button id="consent-approve" style="
        padding: 12px 24px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        transition: background-color 0.2s;
      ">Download Phi-3 🚀</button>
    </div>
  `,i.appendChild(n),document.body.appendChild(i);const a=document.createElement("style");a.textContent=`
    #consent-cancel:hover { background: #5a6268 !important; }
    #consent-approve:hover { background: #0056b3 !important; }
  `,document.head.appendChild(a);const s=g=>{g.key==="Escape"&&(c(),o({approved:!1}))};document.addEventListener("keydown",s);const c=()=>{document.removeEventListener("keydown",s),document.head.removeChild(a),document.body.removeChild(i)},l=n.querySelector("#remember-choice"),r=n.querySelector("#consent-cancel"),d=n.querySelector("#consent-approve");r.addEventListener("click",()=>{c(),o({approved:!1})}),d.addEventListener("click",()=>{ko(n,o,{approved:!0,remember:l.checked})}),i.addEventListener("click",g=>{g.target===i&&(c(),o({approved:!1}))}),setTimeout(()=>d.focus(),100)}function ko(t,e,o){const i=t.parentElement,n=document.head.querySelector("style:last-child");t.innerHTML=`
    <div style="text-align: center; margin-bottom: 30px;">
      <h2 style="margin: 0; color: #333; font-size: 24px;">🧠 Downloading Phi-3</h2>
      <p style="margin: 10px 0; color: #666; font-size: 14px;">Advanced AI model is downloading...</p>
    </div>

    <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
      <div style="margin-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span style="font-weight: bold;">Progress:</span>
          <span id="progress-percentage">0%</span>
        </div>
        <div style="background: #e0e0e0; border-radius: 10px; height: 20px; overflow: hidden;">
          <div id="progress-bar" style="background: linear-gradient(90deg, #007bff, #0056b3); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
        </div>
      </div>
      
      <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
        <span id="download-speed">Estimating speed...</span>
        <span id="time-remaining">Calculating time...</span>
      </div>
    </div>

    <div style="background: #e7f3ff; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
      <p style="margin: 0; color: #0066cc; font-size: 13px; text-align: center;">
        💡 <strong>Tip:</strong> You can continue using the app while the model downloads in the background
      </p>
    </div>

    <div style="text-align: center;">
      <button id="continue-background" style="
        padding: 12px 24px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Courier New', monospace;
        font-weight: bold;
      ">Continue in Background</button>
    </div>
  `;const a=()=>{n&&n.parentNode&&document.head.removeChild(n),i&&i.parentNode&&document.body.removeChild(i)},s=t.querySelector("#continue-background");s.addEventListener("click",()=>{a(),e(o)});const c=t.querySelector("#progress-bar"),l=t.querySelector("#progress-percentage"),r=t.querySelector("#download-speed"),d=t.querySelector("#time-remaining");let u=Date.now(),T=0,M=!1;window.updateModelProgress=p=>{if(M)return;const R=Date.now(),Q=R-u,H=p.bytesDownloaded-T,ee=Q>0?H*1e3/Q:0,te=ee/(1024*1024),Qe=p.totalBytes-p.bytesDownloaded,J=ee>0?Qe/ee:0,oe=Math.round(p.progress*100);c.style.width=`${oe}%`,l.textContent=`${oe}%`,te>0?r.textContent=`${te.toFixed(1)} MB/s`:r.textContent="Calculating speed...",J>60?d.textContent=`${Math.round(J/60)}m remaining`:J>0?d.textContent=`${Math.round(J)}s remaining`:d.textContent="Calculating time...",(p.progress>=.99||oe>=99)&&(M=!0,c.style.width="100%",l.textContent="100%",d.textContent="Complete!",r.textContent=`${te.toFixed(1)} MB/s (finished)`,setTimeout(()=>{e(o)},1500)),u=R,T=p.bytesDownloaded},r.textContent="Starting download...",d.textContent="Calculating...",s.cleanup=()=>{window.updateModelProgress=null,M=!0}}let v=null,P=!1,w="",k="",x=null;function ze(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function ue(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function So(){return"deviceMemory"in navigator?navigator.deviceMemory:ze()?2:4}function We(){return"gpu"in navigator}function pe(t){const e=U[t];if(!e)return{canRun:!1,reason:"Model not found"};if(ue())return{canRun:!1,reason:"iOS Safari compatibility",suggestion:"Using smart fallback responses instead"};const o=So();return o<e.minMemoryGB?{canRun:!1,reason:`Requires ${e.minMemoryGB}GB RAM, detected ${o}GB`,suggestion:`Try ${e.minMemoryGB<=2?"DistilBERT":"Qwen"} for better performance`}:e.recommendedWebGPU&&!We()&&t==="phi3"?{canRun:!0,reason:"Will use CPU processing (slower performance)",suggestion:"Use Chrome/Edge for faster WebGPU acceleration"}:{canRun:!0}}function To(){const t=["phi3","qwen","distilbert"];for(const e of t)if(pe(e).canRun)return e;return"distilbert"}function Io(t){const e=t.toLowerCase();return e.includes("hi")||e.includes("hello")||e.includes("ciao")?"Hi there! I'm Nicolo Pedrani. Welcome to my interactive CV! I'm a Data Scientist at Deloitte Consulting and former R&D System Engineer. What would you like to know about my experience?":e.includes("experience")||e.includes("work")||e.includes("job")?"I currently work as a Data Scientist at Deloitte Consulting, focusing on business analytics, machine learning, and client solutions. Previously, I was an R&D System Engineer at Leonardo SpA, working on defense systems and infrared technologies.":e.includes("skill")||e.includes("technology")||e.includes("programming")?"My key skills include Python, R, machine learning, PyTorch, scikit-learn, Power BI, Azure ML, and statistical analysis. I also have experience with MATLAB, Simulink, and system engineering from my defense industry background.":e.includes("education")||e.includes("study")||e.includes("university")?"I have a strong educational background in engineering and data science, which has equipped me with both theoretical knowledge and practical problem-solving skills across multiple domains.":e.includes("project")||e.includes("achievement")?"I've worked on diverse projects including NPS analysis, energy cost optimization, fashion retail forecasting, recommendation systems, infrared detection systems, and missile warning technologies. Each project combined technical innovation with real business impact.":"Thanks for your question! Due to iOS Safari compatibility limitations, I'm using simplified responses. I'm Nicolo Pedrani - a Data Scientist at Deloitte with R&D experience at Leonardo SpA. I specialize in machine learning, business analytics, and defense systems. What specific aspect would you like to know more about?"}let Mo=null,S={},C={distilbert:"pending",qwen:"pending",phi3:"pending"},L={},Ne=new Set,b=null;const U={distilbert:{name:"Xenova/distilbert-base-cased-distilled-squad",description:"DistilBERT model optimized for question-answering",size:"~65MB",type:"qa",minMemoryGB:1,recommendedWebGPU:!1},qwen:{name:"onnx-community/Qwen2.5-0.5B-Instruct",description:"Qwen 2.5 0.5B Instruct - Small conversational language model",size:"~500MB",type:"chat",minMemoryGB:2,recommendedWebGPU:!1},phi3:{name:"Xenova/Phi-3-mini-4k-instruct",description:"Phi-3 Mini - Advanced 3.8B parameter instruction model",size:"~1.8GB",type:"chat",minMemoryGB:4,recommendedWebGPU:!0,workingExamples:["https://huggingface.co/spaces/webml-community/phi-3.5-webgpu","https://github.com/huggingface/transformers.js-examples/tree/main/phi-3.5-webgpu"]}},ae={preferredModel:"distilbert",fallbackModels:["distilbert"],enableModelFallback:!0,useOnlyFallback:!1},m={personalInfo:`
    Nicolo Pedrani is a professional with experience in Data Science and R&D System Engineering.
    He has worked in consulting, analytics, and infrared defense systems.
    
    Personal interests and hobbies:
    - Football: Passionate about playing and watching football, enjoys both recreational games and following professional leagues
    - Extensive Travel: Has visited 14 countries across 4 continents including Italy, France, Germany, United States, Japan, Australia, Vietnam, Maldives, Spain, United Kingdom, Netherlands, Switzerland, Morocco, and Egypt
    - Reading: Enjoys reading technical literature, business books, and staying updated with industry trends
    - Cultural exploration: Through travel experiences has gained appreciation for different cultures, cuisines, and perspectives
    - Sports and fitness: Maintains active lifestyle through football and other physical activities
    - International perspective: Travel experiences have provided global mindset and cultural adaptability valuable in professional settings
  `,workExperience:`
    Deloitte Consulting - Data Science Experience:
    - NPS (Net Promoter Score) analysis and customer satisfaction analytics
    - Energy cost optimization projects
    - Fashion retail time series analysis and forecasting
    - Supply chain and distribution network mapping
    - Statistical analysis including forecast histograms and box plot analysis
    - Power BI dashboard development for business intelligence
    - Advanced analytics using Python and scikit-learn
    - Machine learning projects with PyTorch and LangChain
    - Recommendation system development
    - Azure Machine Learning and Azure Data Factory implementation
    - AI chatbot development
    - Project management with Gantt charts and timeline planning

    Leonardo SpA - R&D System Engineer Experience:
    - Infrared (IR) spectrum visualization and analysis
    - Atmospheric transmission modeling and analysis
    - Multi-camera array positioning systems
    - Object detection with bounding boxes using computer vision
    - Kalman filter implementation for state estimation
    - Optical flow motion vector analysis
    - 360-degree missile warning coverage systems
    - Threat detection interface development
    - Multiple target tracking systems
    - MATLAB and Simulink development
    - IR system architecture design
    - Requirements specification and documentation
    - IR detector hardware integration
  `,education:`
    Technical background in Data Science, Machine Learning, and System Engineering.
    Expertise in statistical analysis, computer vision, and defense systems.
  `,skills:`
    Programming: Python, MATLAB, TypeScript, JavaScript
    Data Science: scikit-learn, PyTorch, statistical analysis, time series forecasting
    Machine Learning: LangChain, recommendation systems, predictive modeling
    Cloud Platforms: Azure Machine Learning, Azure Data Factory
    Business Intelligence: Power BI, dashboard development
    Computer Vision: Object detection, optical flow, Kalman filtering
    Defense Systems: Infrared systems, missile warning systems, threat detection
    Project Management: Agile methodologies, Gantt charts
    Tools: MATLAB/Simulink, Git, various analytics platforms
  `,projects:`
    - Customer satisfaction analytics using NPS methodology
    - Energy cost optimization for large enterprises
    - Fashion retail demand forecasting using time series analysis
    - Supply chain optimization and network analysis
    - Interactive portfolio game (current project) using TypeScript and HTML5 Canvas
    - AI-powered chatbot development
    - Infrared detection and tracking systems
    - Multi-camera surveillance systems
    - Real-time threat detection and tracking
  `};async function z(t){const e=U[t];if(!e||!x)return console.error(`❌ Model key invalid or transformers not loaded: ${t}`),C[t]="error",!1;try{console.log(`🔄 Background loading ${t} model: ${e.name}`),C[t]="loading",b&&b(t,"loading",0);const o=e.type==="chat"?"text-generation":"question-answering",i={device:We()&&e.recommendedWebGPU?"webgpu":"wasm",...t==="phi3"&&{dtype:"q4",use_external_data_format:!0},progress_callback:a=>{if(a.status==="downloading"){const s=Math.min(a.loaded?Math.floor(a.loaded/1048576):0,90);if(console.log(`📥 Background downloading ${t}: ~${s}MB loaded...`),je(t)&&Ge(t,a),window.updateModelProgress){const c=a.loaded||0,l=a.total||1.8*1024*1024*1024;window.updateModelProgress({progress:a.progress||c/l,bytesDownloaded:c,totalBytes:l})}b&&b(t,"downloading",s)}else a.status==="loading"&&(console.log(`🧠 Loading ${t} model into memory...`),b&&b(t,"finalizing",95))}};i.dtype="q4";const n=await x.pipeline(o,e.name,i);return S[t]={pipeline:n,modelInfo:e,loadTime:Date.now()},typeof window<"u"&&(window.aiModels=window.aiModels||{},window.aiModels[t]=!0),C[t]="completed",console.log(`✅ Background loading of ${t} completed!`),b&&b(t,"completed",100),!0}catch(o){return console.error(`❌ Failed to background load ${t} model:`,o),C[t]="error",b&&b(t,"error",0),!1}}async function Ro(t){const e=U[t];if(!e||!x)return console.error(`❌ Model key invalid or transformers not loaded: ${t}`),!1;try{console.log(`🤖 Loading ${t} model: ${e.name}`),console.log(`📦 Model info: ${e.description} (${e.size})`),Uo(t,!0),Bo(t);const o=e.type==="chat"?"text-generation":"question-answering",i={device:"webgpu",progress_callback:a=>{if(a.status==="downloading"){const s=Math.round(a.progress||0),c=a.loaded||0,l=a.total||0,r=l-c;je(t)&&Ge(t,a),window.updateModelProgress&&window.updateModelProgress({progress:a.progress||0,bytesDownloaded:c,totalBytes:l});let d="";if(a.rate&&a.rate>0){const p=(a.rate/1048576).toFixed(1),R=r>0?Math.round(r/a.rate):0;d=` | ${p} MB/s | ${R}s remaining`}const g=p=>{if(p===0)return"0 B";const R=1024,Q=["B","KB","MB","GB"],H=Math.floor(Math.log(p)/Math.log(R));return parseFloat((p/Math.pow(R,H)).toFixed(1))+" "+Q[H]},u=g(c),T=g(l),M=g(r);console.log(`📥 Downloading ${t} model: ${s}% (${u}/${T}, ${M} left)${d}`)}else a.status==="loading"&&console.log(`🧠 Loading ${t} model into memory...`)}};i.dtype="q4",v=await x.pipeline(o,e.name,i),console.log(`🧪 Testing ${t} model...`);let n;if(e.type==="chat"){let a;try{const s=[{role:"system",content:"You are a helpful assistant."},{role:"user",content:"What is your name?"}];a=v.tokenizer.apply_chat_template(s,{tokenize:!1,add_generation_prompt:!0})}catch{t==="qwen"?a=`<|im_start|>system
You are a helpful assistant.<|im_end|>
<|im_start|>user
What is your name?<|im_end|>
<|im_start|>assistant
`:a=`System: You are a helpful assistant.
User: What is your name?
Assistant:`}if(n=await v(a,{max_new_tokens:20,do_sample:!1,return_full_text:!1}),console.log(`🔍 ${t} chat test result:`,n),!n||!n[0]?.generated_text||n[0].generated_text.length<3)return console.warn(`⚠️ ${t} model test failed`),!1}else if(n=await v("What is the name?","The name is Nicolo Pedrani. He is a professional."),console.log(`🔍 ${t} Q&A test result:`,n),!n.answer||n.score<.01)return console.warn(`⚠️ ${t} model test failed`),!1;return console.log(`✅ ${t} model test successful!`),w=`${t} (${e.name})`,k=e.type,console.log(`🔄 Model switched to: ${w}`),console.log(`📝 Model type: ${k}`),!0}catch(o){return console.error(`❌ Failed to load ${t} model:`,o),!1}}async function Po(){try{if(console.log("🔧 Checking AI system initialization..."),ue())return console.log("🍎 iOS device detected - disabling AI models due to Safari ONNX Runtime issues"),P=!1,w="iOS Fallback System",k="fallback",console.log("✅ iOS fallback system initialized successfully!"),!0;ae.useOnlyFallback;const t=ae.preferredModel;return S[t]&&C[t]==="completed"?(console.log(`⚡ Using preloaded ${t} model for initialization!`),v=S[t].pipeline,w=`${t} (${S[t].modelInfo.name})`,k=S[t].modelInfo.type,P=!0,console.log(`✅ AI system ready with preloaded ${t}!`),console.log(`📋 Active model: ${w}`),!0):(console.log("🔄 No preloaded models available, using fallback responses for now"),P=!1,w="Loading in background...",k="fallback",!0)}catch(t){return console.error("💥 AI initialization error:",t),console.log("🔄 Falling back to scripted responses"),P=!1,w="Fallback System",k="fallback",!0}}function se(){const t=w.match(/^(\w+)\s*\(/);return t?t[1]:ae.preferredModel}async function Se(t){if(!U[t])return console.error(`❌ Invalid model key: ${t}. Available: ${Object.keys(U).join(", ")}`),!1;const e=pe(t);if(!e.canRun)return console.warn(`⚠️ Cannot run ${t}: ${e.reason}`),!1;if(t==="phi3"&&!$e(t)){console.log(`🤔 Requesting user consent for ${t} model...`);try{if(!(await vo(t,U[t])).approved)return console.log(`❌ User declined ${t} model download`),!1;console.log(`✅ User approved ${t} model download`)}catch(o){return console.error(`❌ Error requesting consent for ${t}:`,o),!1}}if(console.log(`🔄 Switching to ${t} model...`),S[t]&&C[t]==="completed")return console.log(`⚡ Using preloaded ${t} model - instant switch!`),v=S[t].pipeline,w=`${t} (${S[t].modelInfo.name})`,k=S[t].modelInfo.type,P=!0,console.log(`✅ Instantly switched to preloaded ${t} model!`),console.log(`🔄 Model switched to: ${w}`),console.log(`📝 Model type: ${k}`),!0;{console.log(`🔄 Model not preloaded, loading ${t} now...`);const o=await Ro(t);return o?(P=!0,console.log(`✅ Successfully switched to ${t} model!`)):console.error(`❌ Failed to switch to ${t} model`),o}}async function Co(t){try{if(ue())return console.log("🍎 iOS device detected - using fallback responses due to known Safari compatibility issues"),Io(t);if((!v||!P)&&(console.log("🔄 AI pipeline not ready, attempting to initialize..."),!await Po().catch(s=>(console.error("❌ Failed to initialize AI:",s),!1))))return ze()?"I'm sorry, AI processing isn't fully supported on mobile devices yet. Here are some key highlights from my experience: I'm a Data Scientist at Deloitte with expertise in Python, machine learning, and business analytics. I also have R&D experience in defense systems at Leonardo SpA. Feel free to ask specific questions!":"I'm sorry, the AI system is currently unavailable on this device. Please try again or switch to desktop.";const e=Eo(t);if(console.log("🔍 Context Selection:",{question:t,contextPreview:e.substring(0,200)+"...",contextLength:e.length}),!e)return"I'd be happy to answer questions about my professional experience, skills, projects, or background. Could you please ask something more specific about my CV or career?";let o;if(k==="chat"){const a=[{role:"system",content:`You ARE Nicolo Pedrani. You are NOT an AI assistant. You are a real person with real experiences. Never say "As an AI" or mention being an AI language model.

You are Nicolo Pedrani, a professional Data Scientist and R&D System Engineer with actual work experience at Deloitte and Leonardo SpA. When asked about YOUR experiences, talk about them in first person as if they are YOUR real professional background.

Your background: ${e}

IMPORTANT: Always respond as Nicolo Pedrani in first person (I, my, me). Keep responses to 2-3 clear sentences. Be direct and professional. Never break character or mention being an AI.`},{role:"user",content:t}];let s;try{s=v.tokenizer.apply_chat_template(a,{tokenize:!1,add_generation_prompt:!0})}catch{console.log("Chat template not available, using Qwen-specific format"),se()==="qwen"?s=`<|im_start|>system
You ARE Nicolo Pedrani. You are NOT an AI assistant. You are a real person with real experiences. Never say "As an AI" or mention being an AI language model.

You are Nicolo Pedrani, a professional Data Scientist and R&D System Engineer with actual work experience at Deloitte and Leonardo SpA. When asked about YOUR experiences, talk about them in first person as if they are YOUR real professional background.

Your background: ${e}

IMPORTANT: Always respond as Nicolo Pedrani in first person (I, my, me). Keep responses to 2-3 clear sentences. Be direct and professional. Never break character or mention being an AI.<|im_end|>
<|im_start|>user
${t}<|im_end|>
<|im_start|>assistant
`:s=`System: You ARE Nicolo Pedrani. You are NOT an AI assistant. You are a real person with real experiences. Never say "As an AI" or mention being an AI language model.

You are Nicolo Pedrani, a professional Data Scientist and R&D System Engineer with actual work experience at Deloitte and Leonardo SpA. When asked about YOUR experiences, talk about them in first person as if they are YOUR real professional background.

Your background: ${e}

IMPORTANT: Always respond as Nicolo Pedrani in first person (I, my, me). Keep responses to 2-3 clear sentences. Be direct and professional. Never break character or mention being an AI.

User: ${t}
Assistant: `}o={answer:(await v(s,{max_new_tokens:80,do_sample:!1,return_full_text:!1,temperature:.1}))[0]?.generated_text?.trim()||"",score:1}}else try{o=await v(t,e)}catch(a){return console.error("❌ Pipeline execution failed:",a),"I encountered an error processing your question. This might be due to device limitations. Please try a simpler question or use desktop."}console.log("🤖 AI Model Result:",{model:w,question:t,answer:o.answer,score:o.score,contextLength:e.length});const i=o.answer?.trim();let n="";if(i&&i.length>5&&o.score>.1)n=Te(i,t);else{console.log("⚠️ AI model returned poor answer, using fallback");const a=Do(t);n=Te(a,t)}return n||"I don't have specific information about that topic in my experience. Could you ask about my work at Deloitte, Leonardo SpA, or my technical skills?"}catch(e){return console.error("Error processing question:",e),"I apologize, but I'm having trouble processing your question right now. Please try rephrasing it or ask about my work experience, skills, or projects."}}function Eo(t){const e=t.toLowerCase();let o=[];const i=["work","job","experience","career","deloitte","leonardo","consulting","engineer","project","company","professional","employment"],n=["skill","technology","programming","python","matlab","machine learning","ai","data science","technical","expertise","tools","software"],a=["education","study","learn","degree","qualification","university","school","training"],s=["hobby","hobbies","travel","football","personal","interest","country","countries","visit","visited","fun","free time","leisure","sports","reading","books"],c=["project","projects","build","built","create","created","develop","developed","system","application","portfolio"],l=["travel","traveling","travelled","country","countries","visit","visited","culture","cultural","international","abroad","trip","vacation"],r=["football","soccer","sport","sports","play","playing","game","games","team","athletic"];i.some(d=>e.includes(d))&&o.push(m.workExperience),n.some(d=>e.includes(d))&&o.push(m.skills),a.some(d=>e.includes(d))&&o.push(m.education),(s.some(d=>e.includes(d))||l.some(d=>e.includes(d))||r.some(d=>e.includes(d)))&&o.push(m.personalInfo),c.some(d=>e.includes(d))&&o.push(m.projects),l.some(d=>e.includes(d))&&(o=[m.personalInfo,...o.filter(d=>d!==m.personalInfo)]),r.some(d=>e.includes(d))&&(o=[m.personalInfo,...o.filter(d=>d!==m.personalInfo)]),o.length===0&&(o=[m.workExperience,m.personalInfo,m.skills]);{const d=o.slice(0,2).join(" ").replace(/\n+/g," ").trim();return console.log("🔍 Using TARGETED context:",d.length,"characters"),d.length>800?d.substring(0,800)+"...":d}}function Te(t,e){let o=t.trim();if(o.length>100)return o;const i=e.toLowerCase();if(i.includes("deloitte")&&!o.includes("Deloitte"))o+=o?" ":"",o+="At Deloitte, I focused on data science consulting, working with various analytics tools and helping clients optimize their business processes through data-driven insights.";else if(i.includes("leonardo")&&!o.includes("Leonardo"))o+=" At Leonardo SpA, I specialized in R&D for infrared and defense systems, working on cutting-edge technology for threat detection and tracking in mission-critical applications.";else if(i.includes("skill")||i.includes("technology"))o+=" I'm passionate about staying current with emerging technologies and applying them to solve complex problems across business and technical domains.";else if(i.includes("project"))o+=" I enjoy tackling diverse projects that challenge me to combine technical expertise with creative problem-solving approaches.";else if(i.includes("football")||i.includes("soccer")){const n=[" Football has been a lifelong passion - I love both playing recreationally and following professional leagues. It's taught me valuable lessons about teamwork and strategy."," Playing football keeps me active and helps me unwind from technical work. There's something special about the team dynamics and strategic thinking involved."," I've always been drawn to football for its combination of physical skill and tactical intelligence. It's a great way to stay fit and connect with people."];o+=n[Math.floor(Math.random()*n.length)]}else if(i.includes("travel")||i.includes("country")||i.includes("visit")){const n=[" Traveling has been incredibly enriching - each of the 14 countries I've visited has taught me something new about different cultures and perspectives."," My travel experiences across 4 continents have given me a global mindset that's valuable in today's interconnected world. From the technology hubs of Japan to the ancient cultures of Morocco."," I believe travel is one of the best forms of education. Each destination - whether it's the innovation in Australia or the efficiency in Germany - offers unique insights."," Exploring different countries has shaped my worldview and made me more adaptable. It's fascinating to see how different cultures approach similar challenges."];o+=n[Math.floor(Math.random()*n.length)]}else if(i.includes("reading")||i.includes("book")){const n=[" Reading helps me stay current with industry trends and broaden my perspective beyond just technical topics."," I enjoy reading both technical literature and books on business strategy - it helps me see the bigger picture in my work."," Books have always been a great way for me to learn new concepts and stay intellectually curious."];o+=n[Math.floor(Math.random()*n.length)]}else if(i.includes("hobby")||i.includes("personal")||i.includes("interest")){const n=[" My hobbies - football, travel, and reading - all contribute to who I am professionally. They've taught me teamwork, cultural awareness, and continuous learning."," I believe having diverse interests outside of work makes me a more well-rounded person and professional. Each hobby brings something unique to the table."," Balancing technical work with active hobbies like football and enriching experiences like travel helps me maintain creativity and fresh perspectives."];o+=n[Math.floor(Math.random()*n.length)]}return o}const W={deloitte:["At Deloitte Consulting, I worked on fascinating data science projects including NPS analysis, energy cost optimization, and fashion retail forecasting. I also developed AI chatbots and recommendation systems.","My time at Deloitte was focused on data science consulting, where I helped clients optimize their business processes through analytics. I worked with tools like Power BI and developed various ML solutions.","At Deloitte, I specialized in business analytics and data science. Some highlights include working on customer satisfaction analytics, supply chain optimization, and developing advanced forecasting models."],leonardo:["At Leonardo SpA, I was an R&D System Engineer working on cutting-edge infrared and defense systems. My work involved missile warning coverage, object detection, and multi-target tracking using advanced computer vision.","Leonardo SpA was where I dove deep into defense technology - specifically infrared systems for threat detection. I worked with MATLAB/Simulink on everything from atmospheric transmission modeling to Kalman filtering.","My R&D role at Leonardo involved developing sophisticated defense systems. I worked on 360-degree missile warning coverage, optical flow analysis, and multi-camera positioning systems for threat detection."],skills:["My technical skills span both data science and systems engineering: Python, MATLAB, machine learning, computer vision, and cloud platforms like Azure. I also have experience with Power BI and various analytics tools.","I work with a diverse tech stack including Python for data science, MATLAB for system modeling, and cloud platforms like Azure ML. My experience covers everything from statistical analysis to computer vision.","My expertise includes programming in Python and MATLAB, machine learning with PyTorch and scikit-learn, cloud computing with Azure, and business intelligence with Power BI. I enjoy working across the full technology stack."],football:["Football is one of my biggest passions! I love both playing recreationally with friends and following professional leagues. It's taught me valuable lessons about teamwork, strategy, and maintaining physical fitness.","I've been passionate about football since I was young. Whether I'm playing a casual game or watching the professionals, I love the combination of physical skill, tactical thinking, and team dynamics.","Football keeps me active and helps me unwind from technical work. There's something special about the sport's blend of individual skill and team strategy that I find really engaging."],travel:["I've been fortunate to travel to 14 countries across 4 continents - from the tech innovation in Japan and Australia to the rich cultures of Morocco and Vietnam. Each destination has broadened my perspective.","My travel experiences have taken me everywhere from the ancient cultures of Egypt to the modern efficiency of Germany. Visiting places like Japan, Maldives, and various European countries has given me a global mindset.","Traveling has been incredibly enriching - whether exploring the technological landscapes of Australia and Japan or the cultural heritage of Morocco and Egypt. Each country teaches you something new about approaching challenges."]};function Do(t){const e=t.toLowerCase();if(e.includes("deloitte")){const o=W.deloitte;return o[Math.floor(Math.random()*o.length)]}else if(e.includes("leonardo")){const o=W.leonardo;return o[Math.floor(Math.random()*o.length)]}else if(e.includes("skill")||e.includes("technology")){const o=W.skills;return o[Math.floor(Math.random()*o.length)]}else if(e.includes("football")||e.includes("soccer")){const o=W.football;return o[Math.floor(Math.random()*o.length)]}else if(e.includes("travel")||e.includes("country")||e.includes("visit")){const o=W.travel;return o[Math.floor(Math.random()*o.length)]}else return e.includes("experience")||e.includes("work")?"I have experience in both Data Science consulting at Deloitte and R&D System Engineering at Leonardo SpA. I've worked on projects ranging from business analytics and machine learning to infrared defense systems and computer vision.":e.includes("reading")||e.includes("book")?"I'm an avid reader who enjoys both technical literature and business books. Reading helps me stay current with industry trends and broaden my perspective beyond just technical topics.":e.includes("hobby")||e.includes("personal")||e.includes("interest")?"My main hobbies are football, traveling, and reading. These interests have shaped me both personally and professionally - football taught me teamwork, travel gave me cultural awareness, and reading keeps me intellectually curious.":e.includes("culture")||e.includes("international")?"My international travel experiences have given me a global perspective that's valuable in today's interconnected world. I've experienced everything from the tech innovation in Japan to the rich history of Morocco.":"I'm a professional with diverse experience in data science consulting and R&D engineering. Feel free to ask about my work at Deloitte, Leonardo SpA, my technical skills, my hobbies, or my travel experiences!"}function _o(t){b=t}function Ie(t){return L[t]||{status:"not_started",progress:0,speed:0,bytesDownloaded:0,totalBytes:0,timeRemaining:0,userRequested:!1}}function je(t){return Ne.has(t)}function Bo(t){console.log(`👤 User explicitly requested ${t}`),Ne.add(t)}function Lo(t){return L[t]?.userRequested===!0}function Ge(t,e){const o=e.loaded||0,i=e.total||1.8*1024*1024*1024,n=e.progress||o/i,a=Date.now(),s=L[t];let c=0,l=0;if(s&&s.bytesDownloaded>0){const g=a-s.lastUpdate,u=o-s.bytesDownloaded;if(g>0){c=u*1e3/g;const T=i-o;l=c>0?T/c:0}}const r=n>=.99,d=L[t]?.userRequested||!1;L[t]={status:r?"completed":"downloading",progress:n,speed:c/(1024*1024),bytesDownloaded:o,totalBytes:i,timeRemaining:l,userRequested:d,lastUpdate:a},r&&(console.log(`✅ ${t} download completed!`),typeof window<"u"&&(window.aiModels=window.aiModels||{},window.aiModels[t]=!0),C[t]="completed")}function Uo(t,e=!1){console.log(`🚀 Initializing download state for ${t} (user requested: ${e})`),L[t]={status:"downloading",progress:0,speed:0,bytesDownloaded:0,totalBytes:1.8*1024*1024*1024,timeRemaining:0,userRequested:e,lastUpdate:Date.now()}}async function Fo(){if(!x){console.log("🔧 Loading Transformers.js before starting background loading...");try{x=await fo(()=>import("https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.7.1"),[]),console.log("✅ Transformers.js loaded for background loading"),x.env&&(x.env.allowRemoteModels=!0,x.env.allowLocalModels=!1,x.env.useBrowserCache=!0)}catch(o){console.error("❌ Failed to load transformers for background loading:",o);return}}console.log("🚀 Starting intelligent background model preloading...");const t=To();console.log(`🎯 Device analysis: Best model is ${t}`);const e=[];t==="phi3"?(console.log("🧠 High-end device detected: Loading Phi-3 first"),e.push(z("phi3").then(o=>(console.log(o?"✅ Phi-3 preloaded!":"❌ Phi-3 failed, will fallback"),o))),setTimeout(()=>{e.push(z("qwen").then(o=>(console.log(o?"✅ Qwen backup preloaded!":"⚠️ Qwen backup failed"),o)))},5e3)):t==="qwen"?(console.log("💬 Mid-range device detected: Loading Qwen first"),e.push(z("qwen").then(o=>(console.log(o?"✅ Qwen preloaded!":"❌ Qwen failed, will fallback"),o))),setTimeout(()=>{e.push(z("distilbert").then(o=>(console.log(o?"✅ DistilBERT backup preloaded!":"⚠️ DistilBERT backup failed"),o)))},3e3)):(console.log("❓ Low-end/mobile device detected: Loading DistilBERT only"),e.push(z("distilbert").then(o=>(console.log(o?"✅ DistilBERT preloaded!":"❌ DistilBERT failed"),o)))),console.log(`💡 Background loading started. User can manually switch to ${t} when ready.`)}class $o{state={isActive:!1,currentState:"input",currentResponse:""};messageArea=null;statusBar=null;modelSelector=null;inputArea=null;responseArea=null;textInput=null;closeButton=null;constructor(){this.initialize()}initialize(){if(this.statusBar=document.getElementById("status-bar"),!this.statusBar){console.error("Status bar not found");return}this.createMessageArea()}createMessageArea(){this.messageArea=document.createElement("div"),this.messageArea.id="gameboy-message-area",this.messageArea.style.cssText=`
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      color: #000;
      border: 2px solid #0a0a0a;
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 14px;
      height: 0;
      overflow: hidden;
      transition: height 0.3s ease-in-out;
      z-index: 10;
      display: none;
    `,this.modelSelector=document.createElement("select"),this.modelSelector.id="conversation-model-selector",this.modelSelector.style.cssText=`
      position: absolute;
      top: 8px;
      left: 8px;
      background: #f0f0f0;
      color: #000;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 2px 4px;
      font-size: 10px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s ease;
    `,this.updateModelSelector(),this.closeButton=document.createElement("button"),this.closeButton.id="conversation-close-button",this.closeButton.textContent="✕",this.closeButton.style.cssText=`
      position: absolute;
      top: 8px;
      right: 8px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 20;
    `,this.inputArea=document.createElement("div"),this.inputArea.id="conversation-input-area",this.inputArea.style.cssText=`
      position: absolute;
      bottom: 8px;
      left: 8px;
      right: 8px;
      height: 40px;
      display: flex;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    `,this.textInput=document.createElement("input"),this.textInput.type="text",this.textInput.placeholder="Ask about my CV and experience...",this.textInput.style.cssText=`
      flex: 1;
      padding: 8px 12px;
      border: 2px solid #333;
      border-radius: 4px;
      background: white;
      color: #000;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      font-weight: bold;
      outline: none;
    `;const e=document.createElement("button");e.textContent="📤",e.style.cssText=`
      margin-left: 8px;
      padding: 8px 12px;
      border: 2px solid #333;
      border-radius: 4px;
      background: #f0f0f0;
      color: #000;
      font-size: 14px;
      cursor: pointer;
      font-weight: bold;
    `,this.responseArea=document.createElement("div"),this.responseArea.id="conversation-response-area",this.responseArea.style.cssText=`
      position: absolute;
      top: 35px;
      left: 8px;
      right: 8px;
      bottom: 60px;
      padding: 8px;
      overflow-y: auto;
      line-height: 1.4;
      opacity: 0;
      transition: opacity 0.3s ease;
      border-bottom: 1px solid #ccc;
    `,this.inputArea.appendChild(this.textInput),this.inputArea.appendChild(e),this.messageArea.appendChild(this.modelSelector),this.messageArea.appendChild(this.closeButton),this.messageArea.appendChild(this.inputArea),this.messageArea.appendChild(this.responseArea),this.statusBar?.parentNode&&this.messageArea&&this.statusBar.parentNode.insertBefore(this.messageArea,this.statusBar),e.addEventListener("click",()=>this.handleSendMessage()),this.textInput.addEventListener("keydown",o=>{o.stopPropagation(),o.key==="Enter"&&(o.preventDefault(),this.handleSendMessage())}),this.modelSelector.addEventListener("change",()=>this.handleModelChange()),this.closeButton.addEventListener("click",()=>this.hideConversation()),document.addEventListener("keydown",o=>{o.key==="Escape"&&this.state.isActive&&this.hideConversation()})}showConversation(){if(!this.messageArea)return;this.state.isActive=!0,this.state.currentState="input",this.messageArea.style.display="block",this.messageArea.style.height="150px",this.modelSelector&&(this.modelSelector.value=se()),this.modelSelector&&(this.modelSelector.style.opacity="1"),this.closeButton&&(this.closeButton.style.opacity="1"),this.inputArea&&(this.inputArea.style.opacity="1"),this.textInput&&this.textInput.focus();const e=document.getElementById("status-text");e&&(e.style.opacity="0")}hideConversation(){if(!this.messageArea)return;this.state.isActive=!1,this.modelSelector&&(this.modelSelector.style.opacity="0"),this.closeButton&&(this.closeButton.style.opacity="0"),this.inputArea&&(this.inputArea.style.opacity="0"),this.responseArea&&(this.responseArea.style.opacity="0"),this.textInput&&(this.textInput.value=""),this.responseArea&&(this.responseArea.textContent=""),this.messageArea.style.height="0",setTimeout(()=>{this.messageArea&&(this.messageArea.style.display="none")},300);const e=document.getElementById("status-text");e&&(e.style.opacity="1")}isConversationActive(){return this.state.isActive}async handleSendMessage(){if(!this.textInput||!this.textInput.value.trim())return;const e=this.textInput.value.trim();this.textInput.value="",this.state.currentState="loading",this.showLoadingState();try{const o=await Co(e);this.showResponse(o)}catch(o){console.error("Error getting AI response:",o),this.showResponse("Sorry, I had trouble processing your question. Please try again.")}}showLoadingState(){!this.inputArea||!this.responseArea||(this.textInput&&(this.textInput.disabled=!0,this.textInput.placeholder="Thinking..."),this.responseArea.style.opacity="1",this.responseArea.textContent="Thinking...",this.state.currentState="loading")}showResponse(e){this.responseArea&&(this.state.currentResponse=e,this.responseArea.textContent=e,this.state.currentState="response",this.textInput&&(this.textInput.disabled=!1,this.textInput.placeholder="Ask about my CV and experience...",this.textInput.focus()),this.responseArea&&(this.responseArea.style.opacity="1"),this.inputArea&&(this.inputArea.style.opacity="1"))}handleSpaceInConversation(){}updateModelSelector(){if(!this.modelSelector)return;const e=[{key:"distilbert",icon:"❓",name:"DistilBERT Q&A",size:"65MB"},{key:"qwen",icon:"💬",name:"Qwen Chat",size:"500MB"},{key:"phi3",icon:"🧠",name:"Phi-3 Advanced",size:"1.8GB",badge:"NEW!"}];this.modelSelector.innerHTML=e.map(o=>{const i=pe(o.key),n=!i.canRun,a=o.badge?` ⭐${o.badge}`:"",s=n&&i.reason?` (${i.reason})`:"";return`<option value="${o.key}" ${n?"disabled":""}>
        ${o.icon} ${o.name} (${o.size})${a}${s}
      </option>`}).join("")}async handleModelChange(){if(!this.modelSelector)return;const e=this.modelSelector.value;console.log(`🔄 Switching to ${e} model...`);const o={distilbert:"DistilBERT Q&A",qwen:"Qwen Chat",phi3:"Phi-3 Advanced"};if(e==="phi3"){const i=Ie("phi3"),n=wo("phi3"),a=Lo("phi3");if(console.log("🔍 Phi-3 switch check:",{userApproved:n,userRequestedDownload:a,downloadStatus:i.status,progress:i.progress}),n&&a&&i.status==="downloading"){console.log("📊 User requested and approved - showing progress for active download"),this.showDownloadProgress(e,o[e]);return}console.log("🚀 First time or background only - will show consent dialog")}this.responseArea&&(this.responseArea.style.opacity="1",this.responseArea.textContent=`Switching to ${o[e]||e}...`);try{await Se(e)?(this.responseArea&&(this.responseArea.textContent=`✅ Switched to ${o[e]||e}!`),setTimeout(()=>{this.responseArea&&(this.responseArea.style.opacity="0"),this.inputArea&&(this.inputArea.style.opacity="1")},1e3)):(this.responseArea&&(this.responseArea.textContent=`❌ Failed to switch to ${e}. Try again later.`),this.modelSelector.value=se())}catch(i){console.error("Error switching model:",i),this.responseArea&&(this.responseArea.textContent="❌ Error switching models. Try again later.")}}showDownloadProgress(e,o){if(!this.responseArea)return;console.log(`📊 Showing download progress UI for ${e}`),this.responseArea.style.opacity="1",this.responseArea.innerHTML=`
      <div style="text-align: center; padding: 15px;">
        <div style="margin-bottom: 10px;">
          <strong>🧠 ${o} is downloading...</strong>
        </div>
        
        <div style="background: #f0f0f0; border-radius: 10px; height: 8px; margin: 10px 0; overflow: hidden;">
          <div id="conv-progress-bar" style="background: linear-gradient(90deg, #007bff, #0056b3); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
        </div>
        
        <div style="display: flex; justify-content: space-between; font-size: 11px; color: #666; margin-bottom: 10px;">
          <span id="conv-progress-percent">0%</span>
          <span id="conv-download-speed">Calculating...</span>
          <span id="conv-time-remaining">Estimating...</span>
        </div>
        
        <div style="font-size: 10px; color: #888;">
          💡 You can continue chatting with other models while this downloads
        </div>
      </div>
    `;const i=setInterval(()=>{const n=Ie(e),a=this.responseArea?.querySelector("#conv-progress-bar"),s=this.responseArea?.querySelector("#conv-progress-percent"),c=this.responseArea?.querySelector("#conv-download-speed"),l=this.responseArea?.querySelector("#conv-time-remaining");if(!a||!this.responseArea){console.log(`❌ Progress elements not found, clearing interval for ${e}`),clearInterval(i);return}console.log("📊 Updating progress UI:",{modelKey:e,status:n.status,progress:n.progress,speed:n.speed});const r=Math.round(n.progress*100);a.style.width=`${r}%`,s.textContent=`${r}%`,n.speed>0?c.textContent=`${n.speed.toFixed(1)} MB/s`:c.textContent="Calculating...",n.timeRemaining>60?l.textContent=`${Math.round(n.timeRemaining/60)}m left`:n.timeRemaining>0?l.textContent=`${Math.round(n.timeRemaining)}s left`:l.textContent="Estimating...",n.status==="completed"&&(clearInterval(i),this.responseArea&&(this.responseArea.innerHTML=`
            <div style="text-align: center; padding: 15px; color: #28a745;">
              ✅ <strong>${o} ready!</strong><br>
              <span style="font-size: 11px;">Switching to advanced AI model...</span>
            </div>
          `),setTimeout(async()=>{try{await Se(e),this.responseArea&&(this.responseArea.style.opacity="0"),this.inputArea&&(this.inputArea.style.opacity="1")}catch(d){console.error("Failed to switch to completed model:",d)}},2e3))},1e3)}}const _=new $o;let E={},le=null,Z=null,K=null;const zo=200;function Wo(){document.addEventListener("keydown",Go),document.addEventListener("keyup",Oo),No()}function No(){Z=document.createElement("div"),Z.id="door-message",Z.style.cssText=`
    position: fixed;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    font-family: Arial, sans-serif;
    font-size: 16px;
    display: none;
    z-index: 1000;
    border: 2px solid #fff;
    text-align: center;
    max-width: 300px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
  `,document.body.appendChild(Z)}function jo(t){Ee(t,5e3),le=t}function Oe(){const t=document.getElementById("status-text");t&&t.textContent===le&&(t.textContent=""),le=null}function Go(t){if(t.key==="Escape"&&_.isConversationActive()){_.hideConversation(),t.preventDefault();return}const e=document.activeElement;if(e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA"))return;let o=null;switch(t.key){case"ArrowUp":case"w":case"W":o="up";break;case"ArrowDown":case"s":case"S":o="down";break;case"ArrowLeft":case"a":case"A":o="left";break;case"ArrowRight":case"d":case"D":o="right";break;case" ":if(!E[" "]){if(console.log("Action button pressed!"),lo()&&!_.isConversationActive())console.log("Starting GameBoy-style boss conversation!"),_.showConversation();else if(!_.isConversationActive()){const i=De(h.x,h.y);i?(console.log(`Attempting to enter door to ${i.targetRoom}`),He()&&(console.log("Successfully entered new room!"),Oe())):console.log("No door here to interact with.")}E[t.key]=!0}t.preventDefault();return}o&&!E[t.key]&&(E[t.key]=!0,qo(o)),t.preventDefault()}function Oo(t){const e=document.activeElement;if(!(e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA"))&&(E[t.key]=!1,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d","W","A","S","D"].includes(t.key)&&!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d","W","A","S","D"].some(n=>E[n]))){re(),h.animationState="idle";const n=h.direction==="left"?"right":h.direction;h.currentAnimation=y[`${n}_idle`],h.frameIndex=0,h.animationTimer=0,qe()}}function qo(t){re(),Me(t),K=window.setInterval(()=>{({up:["ArrowUp","w","W"],down:["ArrowDown","s","S"],left:["ArrowLeft","a","A"],right:["ArrowRight","d","D"]})[t].some(n=>E[n])?Me(t):re()},zo)}function re(){K&&(clearInterval(K),K=null)}function Me(t){const e=fe(),o=e.map[0].length,i=e.map.length;if(t!==h.direction){h.direction=t,h.animationState="idle";const a=h.direction==="left"?"right":h.direction;h.currentAnimation=y[`${a}_idle`],h.frameIndex=0,h.animationTimer=0}else{let a=h.x,s=h.y;if(t==="up"?s--:t==="down"?s++:t==="left"?a--:t==="right"&&a++,a>=0&&a<o&&s>=0&&s<i){const c=e.map[s][a];Je.includes(c)?(h.x=a,h.y=s,h.animationState="walk",setTimeout(()=>qe(),100)):(h.animationState="idle",console.log(`Cannot walk on tile type ${c} at (${a}, ${s})`))}else h.animationState="idle",console.log("Cannot move outside map boundaries")}const n=h.direction==="left"?"right":h.direction;h.currentAnimation=y[`${n}_${h.animationState}`],h.frameIndex=0,h.animationTimer=0}function qe(){const t=De(h.x,h.y);t&&t.description?jo(t.description):Oe()}function Yo(){const t={"btn-up":"ArrowUp","btn-down":"ArrowDown","btn-left":"ArrowLeft","btn-right":"ArrowRight","btn-action":" "};for(const[e,o]of Object.entries(t)){const i=document.getElementById(e);i&&(i.addEventListener("touchstart",n=>{n.preventDefault(),Re(o)},{passive:!1}),i.addEventListener("touchend",n=>{n.preventDefault(),ie(o)},{passive:!1}),i.addEventListener("mousedown",n=>{n.preventDefault(),Re(o)}),i.addEventListener("mouseup",n=>{n.preventDefault(),ie(o)}),i.addEventListener("mouseleave",n=>{n.preventDefault(),ie(o)}),i.addEventListener("contextmenu",n=>{n.preventDefault()}))}}function Re(t){const e=new KeyboardEvent("keydown",{key:t,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}function ie(t){const e=new KeyboardEvent("keyup",{key:t,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}let B=!1,I=!1;function me(){return window.innerWidth>768&&window.matchMedia("(pointer: fine)").matches}function Qo(){if(!me()){console.log("🖥️ Mobile device detected - skipping desktop controls initialization");return}console.log("🖥️ Desktop device detected - initializing enhanced controls"),Ho(),Jo(),setTimeout(()=>{Vo()},1500)}function Ho(){const t=document.getElementById("controls-toggle"),e=document.getElementById("controls-area"),o=document.querySelector("#gameboy-container");if(!t||!e){console.warn("Controls toggle elements not found");return}Pe(t),t.addEventListener("click",()=>{B=!B,B?(e.classList.add("controls-visible"),o?.classList.add("controls-visible")):(e.classList.remove("controls-visible"),o?.classList.remove("controls-visible")),Pe(t),console.log(`🎮 Controls ${B?"shown":"hidden"}`)})}function Pe(t){B?(t.textContent="🎮 Hide Controls",t.setAttribute("title","Hide touch controls to maximize screen space")):(t.textContent="📱 Show Controls",t.setAttribute("title","Show touch controls for testing or convenience"))}function Jo(){const t=document.getElementById("initial-instructions");if(!t){console.warn("Initial instructions element not found");return}t.addEventListener("click",e=>{e.stopPropagation(),j()}),document.addEventListener("click",()=>{I&&j()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&I&&j()}),document.addEventListener("keydown",e=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d","W","A","S","D"].includes(e.key)&&I&&setTimeout(()=>j(),500)})}function Vo(){if(!me()||I)return;const t=document.getElementById("initial-instructions");t&&(I=!0,t.classList.add("show"),console.log("📖 Showing initial keyboard instructions"),setTimeout(()=>{I&&j()},8e3))}function j(){const t=document.getElementById("initial-instructions");!t||!I||(t.classList.remove("show"),I=!1,console.log("📖 Hidden initial instructions"))}window.addEventListener("resize",()=>{!me()&&B&&document.getElementById("controls-area")?.classList.add("controls-visible")});const Xo=Array(_e).fill(null).map(()=>Array(Be).fill(0)),{canvas:Y,ctx:ce,TILE_SIZE:Zo,GAME_WIDTH:G,GAME_HEIGHT:O}=Ve(Xo);if(!Y)throw console.error("Canvas element not found! Make sure there's a canvas with id='gameCanvas'"),new Error("Canvas not found");if(!ce)throw console.error("Could not get 2D context from canvas"),new Error("Canvas context not available");Y.width=G;Y.height=O;console.log(`Canvas initialized: ${G}x${O} (${Be}x${_e} tiles)`);Le(Y);window.addEventListener("resize",()=>Le(Y));_o((t,e,o)=>{console.log(`🔄 Background loading ${t}: ${e} ${o?`(${o}MB)`:""}`),e==="completed"&&console.log(`⚡ ${t} model ready for instant switching!`)});let Ce=0,de=!1;function Ko(){de||(de=!0,console.log("Game started!"),requestAnimationFrame(Ye))}function Ye(t){if(!de)return;const e=(t-Ce)/1e3;Ce=t,Ze(e),_.isConversationActive()||ao(),ce&&en(ce,Zo),requestAnimationFrame(Ye)}function en(t,e){t.clearRect(0,0,G,O);const o=Ue(),i=fe(),n=i.map;if(!o.grass){t.fillStyle="#333",t.fillRect(0,0,G,O),t.fillStyle="#fff",t.font="20px Arial",t.textAlign="center",t.fillText("Loading assets...",G/2,O/2);return}for(let a=0;a<n.length;a++)for(let s=0;s<n[0].length;s++){const c=n[a][s];let l=null;switch(c){case 0:l=o.grass;break;case 1:l=o.oak_tree;break;case 2:case 3:case 4:case 5:l=o.path;break;case 6:l=o.door;break;case 7:l=o.library_floor;break;case 8:l=o.library_bsA||o.library_bsB||o.library_bsC;break;case 9:l=o.football_center||o.football_0;break;case 10:l=o.flag_it||o.flag_fr||o.flag_de||o.flag_us;break;case 11:l=o.library_table;break;case 12:l=o.library_chair;break;case 13:l=o.library_rug;break;case 14:l=o.tree_t1||o.tree_t2||o.tree_t3;break;case 15:break;case 16:l=o.football_0;break;case 17:l=o.football_1;break;case 18:l=o.football_2;break;case 19:l=o.football_3;break;case 20:l=o.football_4;break;case 21:l=o.football_5;break;case 22:l=o.football_6;break;case 23:l=o.football_7;break;case 24:l=o.football_8;break;case 25:l=o.football_9;break;case 26:l=o.football_10;break;case 27:l=o.football_11;break;case 28:l=o.world_map;break;case 29:l=o.nps_chart;break;case 30:l=o.energy_cost_chart;break;case 31:l=o.fashion_retail_timeseries;break;case 32:l=o.distribution_network_map;break;case 33:l=o.forecast_histogram;break;case 34:l=o.box_plot;break;case 35:l=o.deloitte_consulting;break;case 36:l=o.powerbi_dashboard_left;break;case 37:l=o.powerbi_dashboard_right;break;case 38:l=o.python_sklearn;break;case 39:l=o.pytorch_langchain;break;case 40:l=o.recommendation_tree;break;case 41:l=o.azure_ml;break;case 42:l=o.azure_data_factory;break;case 43:l=o.chatbot_ai;break;case 44:l=o.gantt_chart;break;case 45:l=o.ir_spectrum;break;case 46:l=o.atmospheric_transmission;break;case 47:l=o.multi_camera_array;break;case 48:l=o.leonardo_spa;break;case 49:l=o.object_detection;break;case 50:l=o.kalman_filter;break;case 51:l=o.optical_flow;break;case 52:l=o.coverage_360;break;case 53:l=o.threat_interface;break;case 54:l=o.multi_target_tracking;break;case 55:l=o.matlab_simulink;break;case 56:l=o.system_architecture;break;case 57:l=o.requirements_specs;break;case 58:l=o.ir_detector;break;case 59:l=o.brick_wall;break;case 60:l=o.flag_au;break;case 61:l=o.flag_us;break;case 62:l=o.flag_jp;break;case 63:l=o.flag_vn;break;case 64:l=o.flag_mv;break;case 65:l=o.flag_it;break;case 66:l=o.flag_fr;break;case 67:l=o.flag_de;break;case 68:l=o.flag_es;break;case 69:l=o.flag_gb;break;case 70:l=o.flag_nl;break;case 71:l=o.flag_ch;break;case 72:l=o.flag_ma;break;case 73:l=o.flag_eg;break;case 74:l=o.main_guy;break;case 75:l=o.flower;break}if(l)t.drawImage(l,s*e,a*e,e,e);else{let r="#90EE90";switch(c){case 0:r="#228B22";break;case 1:r="#8B4513";break;case 6:r="#2C2C2C";break;case 7:r="#D2B48C";break;case 8:r="#8B4513";break;case 9:r="#32CD32";break;case 10:r="#FF6347";break;case 11:r="#A0522D";break;case 12:r="#CD853F";break;case 13:r="#DC143C";break;case 14:r="#654321";break;case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:r="#32CD32";break;case 28:r="#87CEEB";break;case 29:r="#1a202c";break;case 30:r="#ffa500";break;case 31:r="#e91e63";break;case 32:r="#1a202c";break;case 33:r="#3b82f6";break;case 34:r="#06b6d4";break;case 35:r="#86bc25";break;case 36:case 37:r="#f2c811";break;case 38:r="#3776ab";break;case 39:r="#ee4c2c";break;case 40:r="#1a202c";break;case 41:case 42:r="#0078d4";break;case 43:r="#2d3748";break;case 44:r="#1a202c";break;case 45:r="#1a1a1a";break;case 46:r="#1a1a1a";break;case 47:r="#1a1a1a";break;case 48:r="#C8102E";break;case 49:r="#1a1a1a";break;case 50:r="#1a1a1a";break;case 51:r="#1a1a1a";break;case 52:r="#1a1a1a";break;case 53:r="#1a1a1a";break;case 54:r="#1a1a1a";break;case 55:r="#e97627";break;case 56:r="#1a1a1a";break;case 57:r="#1a1a1a";break;case 58:r="#1a1a1a";break;case 59:r="#6e6e6e";break;case 60:r="#012169";break;case 61:r="#b22234";break;case 62:r="#bc002d";break;case 63:r="#da251d";break;case 64:r="#d21034";break;case 65:r="#009246";break;case 66:r="#0055a4";break;case 67:r="#000000";break;case 68:r="#aa151b";break;case 69:r="#012169";break;case 70:r="#21468b";break;case 71:r="#ff0000";break;case 72:r="#c1272d";break;case 73:r="#ce1126";break;case 74:r="#4169e1";break;case 75:r="#ff69b4";break}t.fillStyle=r,t.fillRect(s*e,a*e,e,e)}if((c===1||c===14)&&l){const r=l.naturalHeight||l.height;r>e&&t.drawImage(l,s*e,a*e-(r-e),e,r)}if((c===8||c===28)&&l){const r=l.naturalHeight||l.height;r>e&&t.drawImage(l,s*e,a*e-(r-e),e,r)}if(c===6&&(t.save(),t.globalAlpha=.3,t.fillStyle="#FFD700",t.fillRect(s*e+2,a*e+2,e-4,e-4),t.restore()),c===10&&i.id==="room4"){const r=[o.flag_it,o.flag_fr,o.flag_de,o.flag_us,o.flag_jp,o.flag_au,o.flag_es,o.flag_gb].filter(Boolean);if(r.length>0){const d=(s+a)%r.length,g=r[d];g&&t.drawImage(g,s*e,a*e,e,e)}}}Ke(t,e)}console.log("Loading assets...");he(()=>{console.log("Assets loaded, initializing sprites..."),to(),console.log("Initializing room system..."),Xe(),console.log("Initializing boss interaction system..."),no(),console.log("Setting up input listeners..."),Wo(),Yo(),console.log("Initializing desktop controls..."),Qo(),console.log("🚀 Starting background AI model preloading..."),console.log("🎮 Game will start immediately while models load in background!"),Fo(),console.log("Starting game..."),Ko()});
