import{p as y,g as ae,u as ye,a as u,b as Fe,c as nt,W as it,M as We,d as Oe,s as at,e as Ne,i as st,f as lt,h as rt}from"./game-CudpEz85.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();const ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAB1JREFUOI1jtOv0+M9AAWCiRPOoAaMGjBowmAwAAJhEAi4/QQzBAAAAAElFTkSuQmCC",dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAB1JREFUOI1jfLKs6D8DBYCJEs2jBowaMGrAYDIAAFnyAxuTOlahAAAAAElFTkSuQmCC",ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABQCAYAAACpv3NFAAAAAXNSR0IArs4c6QAABZFJREFUeJztW09PG0cU/zk1ogZFvbBFCjgXDgYipAYJRzKHXCLlGkeIT9EvkAMnH/oJ+iUsFM6VcokESBipiYRi44MPjUGVte6BVmDRWNCDmeXteHa9M/Nm6WF/Esrszuzse7/3Z97MOkCGDBkyZMiQIUOGdFFY8G4LC97tQ8uRczEpVWxw7ufE9eDcz4n+1Z0yAKBZa4COdSFPHPKckwlFhXIA0Kw1qLJj/fS6WWvcqghzCbYXCKs2aw1U6xUAQPtkCGBkZVnp0lo+NKa0lkf7ZBga26w1nJPwiGMS6vKrO2XsbR8CuFeyWq8EbXpfvlYR5TpXWLNbWPBuq/VKyHqyggLtk2Fkn2rM3vZh4E1724dOvIGNANcQXgXw5garEEh7GVvdKWN1p8z6XmMCRNITMd8+GQYJzQXk0OLKDSxJUE5y3FDlDi5vsCJAFDF0KXMBOq9YZrneZUQAdX9ayQFwGgrtkyG4E65RNqWlrAouw4GCY2UwXk4oCbSqS0t5OexM6wSrEKACuFwBVOB6rzYBctaVY56biLj5qPVNoeUy8jaWrs3U/blCIek8dNOlGwbGyyBdimRBOfNAlAdweZp20lDFPxcEkSrl6LtU/aZbZy0PUMV/EiQdR5WXyRW5hs5Ft9Gmy6B2CFTrlaD40fGApAVSaS0fzKs6N4g6SzAtibUJ2K/nxg4t4hQzLZPjCJPnqtYrqNYrRiRoETA493P+7kHonhBSJaysvA4JqqQqv4MjERolQWD8YDPuFCiuPykm1QOmlaCWVIUF79bb2oS38m3i2ElhoZs/gGhPsDkuM6oD/NZUaBeoUiaqLogKlUkx76rkNsoB/u4BvK1N5ZgkCVFuJ80RUeu/DbQ9QLiaKgxoQpSVpW48yZqTiBJo1hrwtjbhbW0aL4MspZxOoSOPj2tP2ltEeaEOjFYBkQj91tRIkJik6LemEiXNpJDn81tT8HcPjJOgsQeolJfvcSlP5xHEeyvfgvi3+U5glAPkYkgIKQRU3ZfbUfBbU8pn5Gc5lAcszgRFW45Dan0ZsrdEeYrKk1S47Axx9enIigSjEBCfsGeevwgJM7uUT2xlCurWceMuO/zHbtYfRi47Q/i7B5hdyo/dlxHl3lH9l53h2DxXn46Cf22tD1h+HBWhMPP8RUCAcEv5nkxQFOSxKiI5FBew8gAqhLBWnPJUmaj27FI+0uouwMIiTYoiLyQlQu6nJFJQEjg/j7P/4ICGhUCUQnFjhMKUUBc/kGD5OkwhCxmlfPlxMZTQ6DWdiyvZRcHZD5CiwgIAyo+LAIDGP93QNb2X1k/mnH3IIwosA0ct4F7Rjfnpu65i6JnR/SI+nv6+MnoOAHDqSkbAQQjcYZn8YXDurwzO/RUAePusEBq4MT8dEFKcU4oTmosb3ARMFLS06AWKbsxPRyltPL8uOEMgsWClRQ+Aj27/JmgD0+j2b3TexRIaXB6gZZX2ma9U1sAbrMFBgJYgHz73gvarn+ZTfbcKrpJgLIT122d+6PohYEuAtgWEmx/3rgHce4Sm+1vJQJGaB7xcXm+9e/0UwL2ywvLHveug/e71U7xcXm+lJZcNAUbMj7L+CMW5R4EnHPeuQ31pyAIA35k+CGAu6UBh/faZj7/+vsL7LwNszE/jh5kc3qw/wX7nAgCw37nAj9//izfrT9C9mPn5j/6fv2rI09dVAEg5CXb7N3j/ZRBcU4vflb/o9m/QPvNTCwWbQugUCVxPWP/D5x6Oe9eBosB6q3jmj5Hw0ay8MS6KbHdcxrEnrPv2WQGlRQ+//PaVkKONByMAcLRJ0YBVSfwghdD/CVyHDg/lBdYbIs5Tl7RJYNkNch87pUUC2ymRq3M3V0SwH4+lcfBoS4bTM8HU/7MyJhPiVOEMGTJkyJAhQwaB/wCcF1ybPAOXlAAAAABJRU5ErkJggg==",ut="/MyImmersiveExperience/assets/Player-LaRVoEvR.png",ht="/MyImmersiveExperience/assets/MainGuySpriteSheet-A_pLERVz.png",pt="/MyImmersiveExperience/assets/assets-k1rCfwam.png",gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABgCAYAAADVenpJAAAHZElEQVR4nO2dXUwUVxTH/zM7u8sCIoqCoKAJEo2FKFpM1VbLR6tNXxqrJSS1SQ1ttDURTW1KYh8aSbYpjaGJaY0hmugDoTW+NW0igta2ttLYWqlVwUSoroVKJVtYYb+mD7DTnWXW7c7eubPsvb9kkrkDnHPunT+79+PcGUGWZRkcZpEA4OClF8yOwxSa1n0FgO36SwBwf/S22bGYCsv1lwDAYZ1ldhymwnL9JQCQ5aDZcZgKy/UXzQ6AYy5cAIzDBcA4XACMwwXAOFwAjMMFwDhcAIzDBcA4XACMwwXAOFwAjCMBgCTaqDjzB71U/Mw0aLW/pm8AePDoLgKy31BHFkFCtj3XUB8zFRrtH4lFkABMCaCm6DVk2XIMdej2DuOnwa8N9TFTodH+kbi9wwCmBPD6CieGHg0Y6jDXUcQFEAUa7R9JrqMIwJQA/EEv9p5fa6jDU5vpVnAmQaP9Izm1eQCSaPuvEzjfUWioQzM7OskOjfbX8glMfQIAoN4J4agxq/35PADjcAEwDhcA43ABMA4XAONwATCOMgwMzQ3rgQ8h6ZHIfdJCsTY87tJlwCJYMIvyPDbLjEwMIiAHiNlTBFC5qE6XgTG/G7cedhMLiPN41uRtQYaURcyeIoC6ZQd1GciwZuPtrnJiAXEez95VxzDmGyFmTxHA7s6VugyceJ7dvfVmEJD9uu9VOCc39wMIE0CWfZ4uQ/F0SiK3YQsC3UFItG3gZscVDxZB0n2vtFDuHo098n7ZpyrbRAe1vfmCIMIXnND8mRlxJSIykrGRHVPE4NPKX1TlnWdLkG3PpZKONjIxhOPP9SZFXKF4kgGqAmj5uV5V/qzqKuo7liM3fbFhCaOSaMOQpx+tNTem+X9nzUnqcYXHkwxQFcC14W9U5babTfjk2cvYd+EpZNvziPuzija4xm7jSOUVtN1smuY/Vlx7ulajIKMYPkIiiIwnRH3px0Ts64GqALJs6s5L1902zElbgH3lx3HieiNRX1bRhnujvfjw6U5cvPc5uu62YW5aflxxOTd04L1vq7Aws4SICAY9A3Bu6FDiCWGmAKh2d4NyQHXkpBXgi95mPJm3hbivIc8AGiva0e/uwRe9zchJK5jmP1Zc/e4eNFa0Y8hDJp+xvvQjVTyhw0xMHe8EZD/y0pcY8v2/reQAAODotQbkpS+Jq0MXiuvotQaVrUSpLtyhiid0mInpA15/0GtIwujWpfvh7K5FQUaxLoH5g14UZBTD2V2LrUv3E4nJN2UzmXZImS4Ao/AFvY/97g4fh0cbk8eyES9W0UbMFilSVgCxGnvcP6p5Hokv6IU1hVPaU1YAsQjPw6edk59MMCsA54YOzXPWYFYAnEm4ABiHWQE0Xd6mec4aKSuAWL33vpErmueRJOPQjSQpK4DQWkA0EcyyzdU8j8dGKpCyAjjTdxiNFe1wjd3WnGmMXAuIRJpauWusaMeZvsOGxmomKSuA073NAIBdZS0Y9NyJK3XNIkgY9NzBrrIWla1ECch+4nn9iWK6AETBovkfmCi56UVwdtdicVYptpccwPC4C6JgUR3hMYQfw+MubC85gMVZpXB21yI3vYhITBZBUuJIFkyVoyCIcHsfGNIgoXn8xu9qcKTyCh6O/4mLrtOav+v2PlCVKxfV4ZmFr2BP12qiawG3HnajclEdLrpOJ81mGqoCECCoyo98/6AsZyPujxmTWu4LepGfUYy959eiteZG1Dy8spyNqnLdsoOo71iOfILZQABw6PLLOFr1K0YmhvD73z8Qs5sIVAXgjcjKLchciobyVrxxbgXSJWNe3eYPejHfUYjdnSujJoU2lLeqyjvPlmC+o5D4su0ce54Sxwc/vkTUtl6oCiA9YkvToXVf4s1zTyDDOtvQNOyA7EeWfR7e6lqlun6s+joATLueZZ9nSKJGeBzHqn8jbl8PdLOCN32vKjdcWA9JsFLZGyDLQUiCVfNnkdeNjCcUR8OF9cq1lk2XDPMXC6oCeP/Si6qyx++mOskSLfGD9k4gQRDh8bup+oyGIgAaz/Fzjfapyg4pEzLYfHm5TbTr/luS90oRgN6eeDy95Mh39LL8yla9wvcFvURHTYoA9CZFxPMRzvINJ4VVtBFNYFEE0O/u0WXg6l+dxILhxOZM32Eij90vnr0KQJgAQjnw8SIJVsxJW5BwQJz/x+ne5mm7mfVQVfgqgDABFGQU6zaWyuvlyQapdYkQigD4TZwZkL5Ppq8GcsyFC4BxuAAYhwuAcbgAGIcLgHGUYWAqpz7PBMxqfwmYHFveG9XOliEFn2eIDo321/JpDb02zira0FjRbqhD/gkTHRrtr+UTmOoDnPvjlOEOafiYqZjRNiGfEgC09rwLf5THqJJCEu2YyxeNNKHR/pFIoh3VhTsmBZBHeIEhGrwfoA2t9tdC6QRyzMPM9ufzAIzDBcA4XACMwwXAOFwAjMMFwDhcAIzDBcA4XACMwwXAOBKQ3C9KpAHL9ZeAyWf1sAzL9ZcAID9T/7awVIDl+guyLLP5hAYOAOBfSQHMHZJk+TkAAAAASUVORK5CYII=",mt="/MyImmersiveExperience/assets/library-BPiDb9BV.png",yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAUCAYAAABGUvnzAAAC4ElEQVR4nO2av27bMBDGT4UeoIBSIJUrdGszeWqmCMgSDVliBMiUrRmSN/BDCOgDdMmYyUDgLB3UpYA6pROndiwSux3KoXtQZbBPpihS/CPaTm3/FkukSCn++N2d6Hj3ewdFJ88g6KVAaAbdIAFCM8A2WwjNGvs7eXN/E6M4sR7bhtMjv9b2pf+p1iZ6vm5Qb6PDvtbYdz9+6j5iDb8bJEDiBGiewSjOpOLSYV8oOLbzn20E3OAOH53GrpxRnACB6qqTuVkkLj+fCNkCYMfNc5GI3Cjj6uZhbs8xb/xukAAd9ssvtpNnMIoTYUgBqDvZpYP5RTGKE+N5wkEE45M743sDTMLtfnpoNXaefHv72nqsj+Ji7g16KdA8AzJt4wXlnYzn/Kepg2XX64ocDqLasYnQT1XctvhBLwWYuhVdy7aJ3Mqey2nqc8/45K4isq2LV41KIpIVUgjf16aa5V2JqUF1nQzWteEgMg7V++nhSrq4FBjdqBKZxXURxItsMj8rpq17n6q4bGQypRSYr4J5RH0uHaxqd83/XBmbUAnRJuEZYHFibLDHu987KGwHo8CiTRGsfvk+1Q7XqvLq62dvGffVf9sXgCGaSoRmQWFxUSxru3Hd8Nsk8K2LHQAAIJzQLLywuAiI9V3lsCljs4AmVByM1aeu6LP3YPk7L5+ndcaomJd4p0d+Y/HVVHMU17vgHd/KJ/eWEqFnAnvblwAw2zUqfp8pB6u+6KZ+lwWaaC6TVID70lc3D5VjHYrr3dpxo9AL5hl7Eg6itQxtKKapuMj4w3Pwjm8hPP/r/Nna4v379b4AmORTQjMIBxFsXezAn4/f1YO3L6V9Nj8U6CJbhLY5WNfBsr+HdbHMvZ63nBhdhuiJoBFzrAYLJsyr7C9SPNgn+5XKBNcFGitmk3tfvnijnuxc45oF4rfZlKf5xMG8eJS5plwEU9GJQ6F51jG9qHDyHqwjFi80tPh3oA36PAJWG3h2QapYCQAAAABJRU5ErkJggg==",f={};let N=0;const ce=9;let G=null;const Se={objects:[{name:"Bookshelf_A",code:"bsA",x:120,y:360,width:96,height:120},{name:"Bookshelf_B",code:"bsB",x:240,y:360,width:96,height:120},{name:"Bookshelf_C",code:"bsC",x:360,y:360,width:96,height:120},{name:"table",code:"t",x:336,y:192,width:168,height:96},{name:"world_map",code:"wm",x:120,y:192,width:96,height:120},{name:"chair",code:"c",x:648,y:72,width:48,height:72},{name:"rug",code:"r",x:432,y:0,width:168,height:72}],paths:[{name:"path_walk",code:"pw",x:72,y:192,width:24,height:24}]},bt={tilesheet:{columns:4,rows:3,tileWidth:32,tileHeight:32}},Ie={flags:[{name:"Australia",code:"au",x:0,y:0,width:15,height:10},{name:"United States",code:"us",x:15,y:0,width:15,height:10},{name:"Japan",code:"jp",x:30,y:0,width:15,height:10},{name:"Vietnam",code:"vn",x:45,y:0,width:15,height:10},{name:"Italy",code:"it",x:75,y:0,width:15,height:10},{name:"France",code:"fr",x:90,y:0,width:15,height:10},{name:"Germany",code:"de",x:105,y:0,width:15,height:10},{name:"Spain",code:"es",x:0,y:10,width:15,height:10},{name:"United Kingdom",code:"gb",x:15,y:10,width:15,height:10}]},wt={trees:[{name:"tree_1",code:"t1",x:0,y:0,width:160,height:208},{name:"tree_2",code:"t2",x:176,y:32,width:160,height:176},{name:"tree_3",code:"t3",x:368,y:32,width:128,height:176}]};function be(o){G=o,console.log("🚀 Starting asset loading..."),k("grass",ct),k("path",dt),k("oak_tree_original",ft),k("player_sprite_sheet",ut),k("main_guy_sprite_sheet",ht),k("assets_tilesheet",pt),k("football_tilesheet",gt),k("library_tilesheet",mt),k("travel_flags_tilesheet",yt)}function k(o,e){const t=new Image;t.onload=()=>{f[o]=t,N++,console.log(`✅ Loaded: ${o} (${N}/${ce})`),N===ce&&(console.log("🎯 All images loaded, starting tile extraction..."),xt(),It(),G&&G())},t.onerror=()=>{console.error(`❌ Failed to load: ${o} from ${e}`),N++,N===ce&&G&&G()},t.src=e}function xt(){console.log("🔧 Extracting tiles..."),vt(),At(),kt(),St(),Tt(),Mt()}function vt(){const o=f.library_tilesheet;if(!o){console.error("❌ Library tilesheet not found");return}console.log("📚 Extracting library tiles..."),console.log("Library tilesheet size:",o.width,"x",o.height),Se.objects.forEach(t=>{console.log(`Extracting ${t.name} at (${t.x}, ${t.y}) size ${t.width}x${t.height}`);const i=H(o,t.x,t.y,t.width,t.height);t.name==="world_map"?(f.world_map=i,console.log("✅ World map extracted")):t.name==="chair"?(f.library_chair=i,console.log("✅ Chair extracted")):t.name.includes("Bookshelf")?(f[`library_${t.code}`]=i,console.log(`✅ Bookshelf ${t.code} extracted`)):t.name==="table"?(f.library_table=i,console.log("✅ Table extracted")):t.name==="rug"&&(f.library_rug=i,console.log("✅ Rug extracted"))});const e=Se.paths[0];f.library_floor=H(o,e.x,e.y,e.width,e.height),console.log("✅ Library floor extracted")}function At(){const o=f.football_tilesheet;if(!o)return;console.log("⚽ Extracting football tiles...");const{tileWidth:e,tileHeight:t,columns:i,rows:n}=bt.tilesheet;for(let a=0;a<n;a++)for(let s=0;s<i;s++){const c=a*i+s;f[`football_${c}`]=H(o,s*e,a*t,e,t)}console.log(`✅ Extracted ${n*i} football tiles`)}function kt(){const o=f.travel_flags_tilesheet;o&&(console.log("🏁 Extracting flags..."),Ie.flags.forEach(e=>{f[`flag_${e.code}`]=H(o,e.x,e.y,e.width,e.height)}),console.log(`✅ Extracted ${Ie.flags.length} flags`))}function St(){const o=f.assets_tilesheet;o&&(console.log("🌳 Extracting trees..."),wt.trees.forEach(e=>{f[`tree_${e.code}`]=H(o,e.x,e.y,e.width,e.height),console.log(`✅ Extracted tree ${e.code}`)}))}function H(o,e,t,i,n,a=64,s=64){const c=document.createElement("canvas");c.width=a,c.height=s;const l=c.getContext("2d");if(!l)return console.error("❌ Could not get canvas context"),new Image;l.clearRect(0,0,a,s),l.imageSmoothingEnabled=!1,l.drawImage(o,e,t,i,n,0,0,a,s);const r=new Image;return r.src=c.toDataURL(),r}function It(){console.log("🎨 Creating backgrounds for trees only...");const o=f.grass;if(!o){console.error("❌ Grass tile not available for backgrounds");return}Z("oak_tree_original","oak_tree",o),Z("tree_t1","tree_t1",o),Z("tree_t2","tree_t2",o),Z("tree_t3","tree_t3",o),console.log("✅ Tree backgrounds created, library items left as-is")}function Z(o,e,t){const i=f[o];if(!i){console.warn(`⚠️ Source tile ${o} not found, skipping background`);return}const n=document.createElement("canvas");n.width=64,n.height=64;const a=n.getContext("2d");if(!a){console.error(`❌ Could not get canvas context for ${e}`);return}a.drawImage(t,0,0,64,64),a.drawImage(i,0,0,64,64);const s=new Image;s.src=n.toDataURL(),f[e]=s,console.log(`✅ Created background for ${e}`)}function Tt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.strokeStyle="#444",e.lineWidth=3,e.strokeRect(4,4,56,56),e.strokeStyle="#666",e.lineWidth=1,e.strokeRect(8,8,24,24),e.strokeRect(32,8,24,24),e.strokeRect(8,32,24,24),e.strokeRect(32,32,24,24),e.fillStyle="#FFD700",e.beginPath(),e.arc(48,32,3,0,Math.PI*2),e.fill());const t=new Image;t.src=o.toDataURL(),f.door=t,console.log("✅ Door tile created")}function Mt(){console.log("📊 Creating diverse Data Science visualization tiles..."),Rt(),Ct(),Pt(),Et(),Dt(),Bt(),_t(),Lt(),Ut(),$t(),Ft(),Wt(),Ot(),Nt(),zt(),qt(),Gt(),console.log("✅ Diverse Data Science and R&D visualization tiles created")}function Rt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("NPS Analysis",5,12),e.strokeStyle="#00d084",e.lineWidth=2,e.beginPath();const i=[45,42,47,38,50,32,55];for(let n=0;n<i.length;n++){const a=8+n*8,s=i[n];n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke(),e.fillStyle="#00d084";for(let n=0;n<i.length;n++)e.beginPath(),e.arc(8+n*8,i[n],2,0,Math.PI*2),e.fill();e.fillStyle="#ffd700",e.font="bold 10px Arial",e.fillText("73",45,58)}const t=new Image;t.src=o.toDataURL(),f.nps_chart=t}function Ct(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Energy Cost",5,12),e.fillStyle="rgba(255, 165, 0, 0.3)",e.beginPath(),e.moveTo(8,55);const i=[45,38,42,35,40,30,35];for(let n=0;n<i.length;n++)e.lineTo(8+n*8,i[n]);e.lineTo(56,55),e.closePath(),e.fill(),e.strokeStyle="#ffa500",e.lineWidth=2,e.beginPath();for(let n=0;n<i.length;n++){const a=8+n*8,s=i[n];n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke(),e.fillStyle="#00ff88",e.font="bold 8px Arial",e.fillText("-23%",45,58)}const t=new Image;t.src=o.toDataURL(),f.energy_cost_chart=t}function Pt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Fashion Sales",5,12),e.strokeStyle="#e91e63",e.lineWidth=2,e.beginPath();const i=[35,45,40,25,20,18,22,38,42,50,55,48];for(let n=0;n<i.length;n++){const a=8+n*4.5,s=i[n];n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke(),e.fillStyle="#ffc107",e.beginPath(),e.arc(8+10*4.5,55,3,0,Math.PI*2),e.fill(),e.fillStyle="#ffc107",e.font="bold 7px Arial",e.fillText("Peak",38,58)}const t=new Image;t.src=o.toDataURL(),f.fashion_retail_timeseries=t}function Et(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Supply Chain",5,12);const i=[{x:15,y:25,color:"#00d084"},{x:35,y:20,color:"#ffc107"},{x:50,y:30,color:"#e91e63"},{x:25,y:45,color:"#9c27b0"},{x:45,y:50,color:"#2196f3"}];e.strokeStyle="#4a5568",e.lineWidth=1,e.beginPath(),e.moveTo(15,25),e.lineTo(35,20),e.moveTo(35,20),e.lineTo(50,30),e.moveTo(35,20),e.lineTo(25,45),e.moveTo(50,30),e.lineTo(45,50),e.moveTo(25,45),e.lineTo(45,50),e.stroke(),i.forEach(n=>{e.fillStyle=n.color,e.beginPath(),e.arc(n.x,n.y,4,0,Math.PI*2),e.fill()})}const t=new Image;t.src=o.toDataURL(),f.distribution_network_map=t}function Dt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Forecast Dist",5,12),e.fillStyle="#3b82f6";const i=[15,25,35,40,35,25,20,15];for(let n=0;n<i.length;n++){const a=8+n*6,s=i[n];e.fillRect(a,55-s,5,s)}e.strokeStyle="#ef4444",e.lineWidth=2,e.beginPath();for(let n=0;n<50;n++){const a=8+n,s=55-(20+15*Math.exp(-Math.pow((n-25)/8,2)));n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke()}const t=new Image;t.src=o.toDataURL(),f.forecast_histogram=t}function Bt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Box Plot",5,12),e.strokeStyle="#06b6d4",e.fillStyle="rgba(6, 182, 212, 0.3)",e.lineWidth=2,e.fillRect(20,25,24,15),e.strokeRect(20,25,24,15),e.beginPath(),e.moveTo(30,25),e.lineTo(30,40),e.stroke(),e.beginPath(),e.moveTo(15,32.5),e.lineTo(20,32.5),e.moveTo(44,32.5),e.lineTo(50,32.5),e.moveTo(15,30),e.lineTo(15,35),e.moveTo(50,30),e.lineTo(50,35),e.stroke(),e.fillStyle="#ef4444",e.beginPath(),e.arc(12,20,2,0,Math.PI*2),e.arc(55,45,2,0,Math.PI*2),e.fill());const t=new Image;t.src=o.toDataURL(),f.box_plot=t}function _t(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#f2c811",e.fillRect(0,0,64,64),e.fillStyle="#323130",e.font="bold 10px Arial",e.fillText("Dashboard",8,15);const i=32,n=35,a=15;[{angle:0,size:Math.PI*.6,color:"#0078d4"},{angle:Math.PI*.6,size:Math.PI*.8,color:"#00bcf2"},{angle:Math.PI*1.4,size:Math.PI*.6,color:"#40e0d0"}].forEach(c=>{e.fillStyle=c.color,e.beginPath(),e.moveTo(i,n),e.arc(i,n,a,c.angle,c.angle+c.size),e.closePath(),e.fill()}),e.fillStyle="#fff",e.fillRect(8,52,20,8),e.fillStyle="#323130",e.font="bold 8px Arial",e.fillText("87%",12,58)}const t=new Image;t.src=o.toDataURL(),f.powerbi_dashboard_left=t}function Lt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#f2c811",e.fillRect(0,0,64,64),e.strokeStyle="#323130",e.lineWidth=2,e.beginPath();const i=[40,35,38,32,28,25,22];for(let n=0;n<i.length;n++){const a=8+n*8,s=i[n];n===0?e.moveTo(a,s):e.lineTo(a,s)}e.stroke(),e.fillStyle="#0078d4";for(let n=0;n<i.length;n++)e.beginPath(),e.arc(8+n*8,i[n],2,0,Math.PI*2),e.fill();e.fillStyle="#323130",e.font="bold 8px Arial",e.fillText("↑23%",8,55),e.fillText("$2.1M",38,55)}const t=new Image;t.src=o.toDataURL(),f.powerbi_dashboard_right=t}function Ut(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#3776ab",e.fillRect(0,0,64,32),e.fillStyle="#ffd343",e.fillRect(0,32,64,32),e.fillStyle="#fff",e.font="bold 10px Arial",e.fillText("Python",12,20),e.fillStyle="#000",e.font="bold 8px Arial",e.fillText("scikit",8,45),e.fillText("learn",8,55),e.fillStyle="#666",e.beginPath(),e.arc(50,45,8,0,Math.PI*2),e.fill(),e.fillStyle="#fff",e.fillText("ML",46,49));const t=new Image;t.src=o.toDataURL(),f.python_sklearn=t}function $t(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#ee4c2c",e.fillRect(0,0,64,32),e.fillStyle="#1a1a1a",e.fillRect(0,32,64,32),e.fillStyle="#fff",e.font="bold 10px Arial",e.fillText("PyTorch",10,20),e.fillStyle="#00d084",e.font="bold 8px Arial",e.fillText("Lang",8,45),e.fillText("Chain",8,55),e.strokeStyle="#00d084",e.lineWidth=2,e.beginPath(),e.arc(45,45,4,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(52,45,4,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(49,45),e.lineTo(48,45),e.stroke());const t=new Image;t.src=o.toDataURL(),f.pytorch_langchain=t}function Ft(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Rec Tree",5,12),e.strokeStyle="#4a5568",e.lineWidth=1,e.fillStyle="#e53e3e",e.fillRect(28,18,8,6),e.fillStyle="#3182ce",e.fillRect(18,30,8,6),e.fillRect(38,30,8,6),e.fillStyle="#38a169",e.fillRect(10,42,6,5),e.fillRect(20,42,6,5),e.fillRect(38,42,6,5),e.fillRect(48,42,6,5),e.beginPath(),e.moveTo(32,24),e.lineTo(22,30),e.moveTo(32,24),e.lineTo(42,30),e.moveTo(22,36),e.lineTo(13,42),e.moveTo(22,36),e.lineTo(23,42),e.moveTo(42,36),e.lineTo(41,42),e.moveTo(42,36),e.lineTo(51,42),e.stroke(),e.fillStyle="#ffd700",e.font="6px Arial",e.fillText("0.89",10,58),e.fillText("0.76",20,58),e.fillText("0.91",38,58),e.fillText("0.82",48,58));const t=new Image;t.src=o.toDataURL(),f.recommendation_tree=t}function Wt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#0078d4",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Azure",18,15),e.font="bold 7px Arial",e.fillText("Machine",12,28),e.fillText("Learning",12,38),e.strokeStyle="#fff",e.lineWidth=2,e.beginPath(),e.moveTo(10,50),e.lineTo(25,50),e.lineTo(40,50),e.lineTo(55,50),e.stroke(),e.fillStyle="#fff",e.beginPath(),e.arc(10,50,3,0,Math.PI*2),e.arc(25,50,3,0,Math.PI*2),e.arc(40,50,3,0,Math.PI*2),e.arc(55,50,3,0,Math.PI*2),e.fill());const t=new Image;t.src=o.toDataURL(),f.azure_ml=t}function Ot(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#0078d4",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Azure",18,15),e.font="bold 7px Arial",e.fillText("Data",20,28),e.fillText("Factory",16,38),e.strokeStyle="#fff",e.lineWidth=2,e.fillStyle="#fff",e.fillRect(8,45,8,6),e.beginPath(),e.moveTo(20,48),e.lineTo(35,48),e.stroke(),e.fillStyle="#ffd700",e.beginPath(),e.arc(35,48,4,0,Math.PI*2),e.fill(),e.strokeStyle="#fff",e.beginPath(),e.moveTo(39,48),e.lineTo(50,48),e.stroke(),e.fillStyle="#fff",e.fillRect(50,45,8,6));const t=new Image;t.src=o.toDataURL(),f.azure_data_factory=t}function Nt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){const i=e.createLinearGradient(0,0,0,64);i.addColorStop(0,"#1a202c"),i.addColorStop(1,"#2d3748"),e.fillStyle=i,e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Chatbot AI",5,12),e.fillStyle="#3182ce",e.fillRect(35,20,24,8),e.fillStyle="#fff",e.font="6px Arial",e.fillText("Hello!",38,26),e.fillStyle="#00d084",e.fillRect(5,32,30,8),e.fillStyle="#fff",e.fillText("How can I help?",7,38),e.fillStyle="#3182ce",e.fillRect(28,44,31,8),e.fillStyle="#fff",e.fillText("Recommend...",30,50),e.fillStyle="#ffd700",e.beginPath(),e.arc(12,58,6,0,Math.PI*2),e.fill(),e.fillStyle="#1a202c",e.beginPath(),e.arc(10,56,1,0,Math.PI*2),e.arc(14,56,1,0,Math.PI*2),e.fill(),e.strokeStyle="#1a202c",e.lineWidth=1,e.beginPath(),e.arc(12,58,3,0,Math.PI),e.stroke(),e.fillStyle="#9ca3af",e.font="6px Arial",e.fillText("●●●",45,58)}const t=new Image;t.src=o.toDataURL(),f.chatbot_ai=t}function zt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#000000",e.fillRect(0,0,64,64),e.fillStyle="#86bc25",e.font="bold 9px Arial",e.fillText("Deloitte",12,20),e.font="bold 8px Arial",e.fillText("Consulting",8,32),e.fillStyle="#86bc25",e.beginPath(),e.arc(56,16,2,0,Math.PI*2),e.fill(),e.font="6px Arial",e.fillText("2022-2023",15,55));const t=new Image;t.src=o.toDataURL(),f.deloitte_consulting=t}function qt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a202c",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Gantt Chart",5,12),e.fillStyle="#4a5568",e.fillRect(0,16,64,8),e.fillStyle="#fff",e.font="6px Arial",e.fillText("Q1",8,22),e.fillText("Q2",24,22),e.fillText("Q3",40,22),e.fillText("Q4",56,22),e.fillStyle="#3182ce",e.fillRect(6,28,18,4),e.fillStyle="#10b981",e.fillRect(14,36,24,4),e.fillStyle="#f59e0b",e.fillRect(32,44,20,4),e.fillStyle="#ef4444",e.fillRect(48,52,12,4),e.fillStyle="#86bc25",e.fillRect(6,28,12,4),e.fillRect(14,36,16,4),e.fillRect(32,44,8,4),e.strokeStyle="#dc2626",e.lineWidth=1,e.setLineDash([2,2]),e.beginPath(),e.moveTo(28,25),e.lineTo(28,58),e.stroke(),e.setLineDash([]));const t=new Image;t.src=o.toDataURL(),f.gantt_chart=t}function Gt(){console.log("🔴 Creating R&D System Engineer visualization tiles..."),jt(),Qt(),Yt(),Ht(),Vt(),Jt(),Xt(),Zt(),Kt(),eo(),to(),oo(),no(),io(),ao(),so(),lo(),console.log("✅ R&D System Engineer visualization tiles created")}function jt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("IR Spectrum",5,12),e.fillStyle="#ff4444",e.font="6px Arial",e.fillText("Hot",5,22),e.fillStyle="#4444ff",e.fillText("Cold",45,22);const i=e.createLinearGradient(0,25,64,25);i.addColorStop(0,"#000080"),i.addColorStop(.3,"#0080ff"),i.addColorStop(.5,"#00ff00"),i.addColorStop(.7,"#ffff00"),i.addColorStop(.9,"#ff8000"),i.addColorStop(1,"#ff0000"),e.fillStyle=i,e.fillRect(5,25,54,20),e.fillStyle="#fff",e.font="5px Arial",e.fillText("3-5μm",8,52),e.fillText("8-12μm",35,52),e.strokeStyle="#fff",e.lineWidth=1,e.strokeRect(5,25,20,20),e.strokeRect(35,25,24,20)}const t=new Image;t.src=o.toDataURL(),f.ir_spectrum=t}function Qt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 7px Arial",e.fillText("Atmos Trans",5,12),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.moveTo(10,55),e.lineTo(58,55),e.moveTo(10,55),e.lineTo(10,20),e.stroke(),e.fillStyle="#aaa",e.font="5px Arial",e.fillText("λ(μm)",45,60),e.fillText("T%",2,25),e.strokeStyle="#00ff88",e.lineWidth=2,e.beginPath();const i=[{x:12,y:45},{x:16,y:35},{x:20,y:25},{x:24,y:25},{x:28,y:25},{x:32,y:45},{x:36,y:45},{x:40,y:25},{x:44,y:25},{x:48,y:25},{x:52,y:45},{x:56,y:50}];for(let n=0;n<i.length;n++)n===0?e.moveTo(i[n].x,i[n].y):e.lineTo(i[n].x,i[n].y);e.stroke(),e.fillStyle="rgba(0, 255, 136, 0.2)",e.fillRect(20,20,8,35),e.fillRect(40,20,8,35)}const t=new Image;t.src=o.toDataURL(),f.atmospheric_transmission=t}function Yt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Multi-Cam",12,12),e.fillStyle="#444",e.beginPath(),e.arc(32,32,12,0,Math.PI*2),e.fill(),[{angle:0,color:"#ff4444"},{angle:Math.PI/2,color:"#44ff44"},{angle:Math.PI,color:"#4444ff"},{angle:3*Math.PI/2,color:"#ffff44"},{angle:Math.PI/4,color:"#ff44ff"},{angle:3*Math.PI/4,color:"#44ffff"}].forEach(n=>{const a=32+Math.cos(n.angle)*18,s=32+Math.sin(n.angle)*18;e.fillStyle=n.color,e.fillRect(a-3,s-3,6,6),e.strokeStyle=n.color,e.lineWidth=1,e.globalAlpha=.3,e.beginPath(),e.moveTo(a,s),e.arc(a,s,12,n.angle-Math.PI/6,n.angle+Math.PI/6),e.closePath(),e.stroke(),e.globalAlpha=1}),e.fillStyle="#fff",e.font="6px Arial",e.fillText("360°",26,58));const t=new Image;t.src=o.toDataURL(),f.multi_camera_array=t}function Ht(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#C8102E",e.fillRect(0,0,64,64),e.fillStyle="#ffffff",e.font="bold 12px Arial",e.textAlign="center",e.fillText("Leonardo",32,26),e.font="bold 10px Arial",e.fillText("SpA",32,42),e.font="8px Arial",e.fillText("2024 - present",32,56));const t=new Image;t.src=o.toDataURL(),f.leonardo_spa=t}function Vt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Detection",8,12),e.fillStyle="#333",e.fillRect(5,18,54,40),[{x:15,y:25,w:12,h:8,conf:"0.92",color:"#00ff88"},{x:35,y:30,w:10,h:10,conf:"0.87",color:"#ffaa00"},{x:45,y:40,w:8,h:6,conf:"0.76",color:"#ff4444"}].forEach(n=>{e.fillStyle=n.color,e.globalAlpha=.6,e.fillRect(n.x+2,n.y+2,n.w-4,n.h-4),e.globalAlpha=1,e.strokeStyle=n.color,e.lineWidth=1,e.strokeRect(n.x,n.y,n.w,n.h),e.fillStyle=n.color,e.font="5px Arial",e.fillText(n.conf,n.x,n.y-1)}));const t=new Image;t.src=o.toDataURL(),f.object_detection=t}function Jt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Kalman",15,12),e.strokeStyle="#4444ff",e.lineWidth=2,e.setLineDash([3,3]),e.beginPath(),e.moveTo(10,50),e.quadraticCurveTo(25,30,50,25),e.stroke(),e.setLineDash([]),e.fillStyle="#ff4444";const i=[{x:12,y:48},{x:20,y:38},{x:30,y:32},{x:42,y:28},{x:48,y:26}];i.forEach(n=>{e.beginPath(),e.arc(n.x,n.y,2,0,Math.PI*2),e.fill()}),e.strokeStyle="#00ff88",e.lineWidth=1,i.forEach((n,a)=>{const s=4+a*1.5;e.beginPath(),e.ellipse(n.x,n.y,s,s*.6,0,0,Math.PI*2),e.stroke()}),e.font="5px Arial",e.fillStyle="#4444ff",e.fillText("Pred",5,20),e.fillStyle="#ff4444",e.fillText("Meas",5,28),e.fillStyle="#00ff88",e.fillText("Uncert",5,36)}const t=new Image;t.src=o.toDataURL(),f.kalman_filter=t}function Xt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Opt Flow",12,12),e.strokeStyle="#00ffaa",e.lineWidth=1;for(let i=15;i<55;i+=12)for(let n=20;n<55;n+=12){const a=(i-32)*.1+Math.sin(i*.1)*3,s=(n-35)*.1+Math.cos(n*.1)*2;e.beginPath(),e.moveTo(i,n),e.lineTo(i+a,n+s),e.stroke();const c=Math.atan2(s,a);e.beginPath(),e.moveTo(i+a,n+s),e.lineTo(i+a-3*Math.cos(c-Math.PI/6),n+s-3*Math.sin(c-Math.PI/6)),e.moveTo(i+a,n+s),e.lineTo(i+a-3*Math.cos(c+Math.PI/6),n+s-3*Math.sin(c+Math.PI/6)),e.stroke()}}const t=new Image;t.src=o.toDataURL(),f.optical_flow=t}function Zt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("360° Warn",8,12),e.fillStyle="#444",e.beginPath(),e.arc(32,32,8,0,Math.PI*2),e.fill(),[{start:0,end:Math.PI/2,color:"#00ff88"},{start:Math.PI/2,end:Math.PI,color:"#ffaa00"},{start:Math.PI,end:3*Math.PI/2,color:"#ff4444"},{start:3*Math.PI/2,end:2*Math.PI,color:"#4488ff"}].forEach(n=>{e.fillStyle=n.color,e.globalAlpha=.3,e.beginPath(),e.moveTo(32,32),e.arc(32,32,25,n.start,n.end),e.closePath(),e.fill(),e.globalAlpha=1,e.strokeStyle=n.color,e.lineWidth=2,e.beginPath(),e.moveTo(32,32),e.lineTo(32+Math.cos(n.start)*25,32+Math.sin(n.start)*25),e.stroke()}),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.arc(32,32,15,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(32,32,25,0,Math.PI*2),e.stroke(),e.fillStyle="#aaa",e.font="5px Arial",e.fillText("20km",5,58),e.fillText("40km",45,58));const t=new Image;t.src=o.toDataURL(),f.coverage_360=t}function Kt(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Threats",15,12),e.strokeStyle="#00ff88",e.lineWidth=1,e.strokeRect(5,16,54,42),[{x:15,y:25,level:"HIGH",color:"#ff4444"},{x:35,y:30,level:"MED",color:"#ffaa00"},{x:45,y:40,level:"LOW",color:"#44ff44"}].forEach((n,a)=>{e.fillStyle=n.color,e.beginPath(),e.moveTo(n.x,n.y-3),e.lineTo(n.x-3,n.y+3),e.lineTo(n.x+3,n.y+3),e.closePath(),e.fill(),e.font="5px Arial",e.fillText(n.level,n.x-6,n.y+8),e.fillStyle="#aaa",e.font="4px Arial",e.fillText(`${15+a*5}km`,n.x-8,n.y+12),e.fillText(`${45+a*30}°`,n.x-6,n.y+16)}),e.fillStyle="#00ff88",e.fillRect(8,52,6,4),e.fillStyle="#fff",e.font="5px Arial",e.fillText("ACTIVE",16,55));const t=new Image;t.src=o.toDataURL(),f.threat_interface=t}function eo(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("MTT",25,12),[{x:15,y:25,id:"T1",color:"#ff4444",history:[{x:10,y:30},{x:12,y:28},{x:15,y:25}]},{x:40,y:35,id:"T2",color:"#44ff44",history:[{x:35,y:30},{x:38,y:32},{x:40,y:35}]},{x:25,y:45,id:"T3",color:"#4444ff",history:[{x:20,y:50},{x:22,y:48},{x:25,y:45}]}].forEach(n=>{e.strokeStyle=n.color,e.lineWidth=1,e.globalAlpha=.5,e.beginPath(),n.history.forEach((a,s)=>{s===0?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)}),e.stroke(),e.globalAlpha=1,e.fillStyle=n.color,e.beginPath(),e.arc(n.x,n.y,3,0,Math.PI*2),e.fill(),e.font="6px Arial",e.fillText(n.id,n.x+5,n.y-2),e.strokeStyle=n.color,e.lineWidth=2,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x+8,n.y-3),e.stroke()}),e.fillStyle="#fff",e.font="5px Arial",e.fillText("3 TRACKS",5,58));const t=new Image;t.src=o.toDataURL(),f.multi_target_tracking=t}function to(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#e97627",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 10px Arial",e.fillText("MATLAB",8,18),e.font="bold 8px Arial",e.fillText("Simulink",10,30),e.strokeStyle="#fff",e.fillStyle="rgba(255, 255, 255, 0.2)",e.lineWidth=1,e.fillRect(8,38,12,8),e.strokeRect(8,38,12,8),e.fillStyle="#fff",e.font="5px Arial",e.fillText("In",12,44),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(25,36,14,12),e.strokeRect(25,36,14,12),e.fillStyle="#fff",e.fillText("Filter",27,43),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(44,38,12,8),e.strokeRect(44,38,12,8),e.fillStyle="#fff",e.fillText("Out",47,44),e.strokeStyle="#fff",e.beginPath(),e.moveTo(20,42),e.lineTo(25,42),e.moveTo(39,42),e.lineTo(44,42),e.stroke(),e.font="6px Arial",e.fillText("R2023b",18,58));const t=new Image;t.src=o.toDataURL(),f.matlab_simulink=t}function oo(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("IR System",8,12),[{x:8,y:18,w:16,h:8,label:"IR Sensor",color:"#ff4444"},{x:40,y:18,w:16,h:8,label:"ADC",color:"#44ff44"},{x:8,y:32,w:16,h:8,label:"DSP",color:"#4444ff"},{x:40,y:32,w:16,h:8,label:"CPU",color:"#ffaa00"},{x:24,y:46,w:16,h:8,label:"Display",color:"#aa44ff"}].forEach(n=>{e.fillStyle=n.color,e.globalAlpha=.3,e.fillRect(n.x,n.y,n.w,n.h),e.globalAlpha=1,e.strokeStyle=n.color,e.lineWidth=1,e.strokeRect(n.x,n.y,n.w,n.h),e.fillStyle="#fff",e.font="5px Arial",e.fillText(n.label,n.x+2,n.y+6)}),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.moveTo(24,22),e.lineTo(40,22),e.moveTo(16,26),e.lineTo(16,32),e.moveTo(48,26),e.lineTo(48,32),e.moveTo(24,36),e.lineTo(32,46),e.moveTo(40,36),e.lineTo(32,46),e.stroke());const t=new Image;t.src=o.toDataURL(),f.system_architecture=t}function no(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("Specs",18,12),e.strokeStyle="#666",e.lineWidth=1;const i=5,n=3,a=16,s=7,c=6,l=18;for(let d=0;d<=i;d++)e.beginPath(),e.moveTo(c,l+d*s),e.lineTo(c+n*a,l+d*s),e.stroke();for(let d=0;d<=n;d++)e.beginPath(),e.moveTo(c+d*a,l),e.lineTo(c+d*a,l+i*s),e.stroke();e.fillStyle="#4a5568",e.fillRect(c+1,l+1,n*a-2,s-2),[{r:1,c:0,color:"#00ff88"},{r:1,c:1,color:"#ffaa00"},{r:2,c:0,color:"#00ff88"},{r:2,c:2,color:"#ff4444"},{r:3,c:1,color:"#00ff88"}].forEach(d=>{e.fillStyle=d.color,e.globalAlpha=.6,e.fillRect(c+d.c*a+1,l+d.r*s+1,a-2,s-2),e.globalAlpha=1}),e.font="4px Arial",e.fillStyle="#00ff88",e.fillText("✓ PASS",6,58),e.fillStyle="#ff4444",e.fillText("✗ FAIL",30,58)}const t=new Image;t.src=o.toDataURL(),f.requirements_specs=t}function io(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#1a1a1a",e.fillRect(0,0,64,64),e.fillStyle="#fff",e.font="bold 8px Arial",e.fillText("IR Detector",8,12),e.fillStyle="#444",e.fillRect(18,20,28,20),e.strokeStyle="#666",e.lineWidth=1,e.strokeRect(18,20,28,20),e.fillStyle="#2a2a2a",e.beginPath(),e.arc(32,30,8,0,Math.PI*2),e.fill(),e.strokeStyle="#888",e.stroke(),e.strokeStyle="#666",e.lineWidth=.5,e.beginPath(),e.arc(32,30,6,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(32,30,4,0,Math.PI*2),e.stroke(),e.strokeStyle="#666",e.lineWidth=1;for(let i=0;i<5;i++){const n=20+i*5;e.beginPath(),e.moveTo(n,42),e.lineTo(n,48),e.stroke()}e.fillStyle="#aaa",e.font="5px Arial",e.fillText("MWIR/LWIR",15,52),e.fillText("InSb/MCT",18,58),e.fillStyle="#d4af37";for(let i=0;i<3;i++)e.fillRect(46+i*2,35,1,4)}const t=new Image;t.src=o.toDataURL(),f.ir_detector=t}function ao(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#6e6e6e",e.fillRect(0,0,64,64);const i=16,n=8,a=1;e.fillStyle="#5a5a5a";for(let s=0;s<64;s+=n+a)e.fillRect(0,s,64,a);for(let s=0;s<Math.ceil(64/(n+a));s++){const c=s*(n+a),l=s%2*(i/2);for(let r=l;r<64+i;r+=i+a)e.fillRect(r,c,a,n+a)}e.globalAlpha=.1;for(let s=0;s<Math.ceil(64/(n+a));s++)for(let c=0;c<Math.ceil(64/(i+a));c++){const l=c*(i+a)+s%2*(i/2),r=s*(n+a),d=Math.random()*.3-.15;e.fillStyle=d>0?"#ffffff":"#000000",e.fillRect(l+a,r+a,i-a,n-a)}e.globalAlpha=1,e.fillStyle="rgba(0, 0, 0, 0.1)",e.fillRect(62,0,2,64),e.fillRect(0,62,64,2)}const t=new Image;t.src=o.toDataURL(),f.brick_wall=t}function so(){[{name:"flag_au",code:"AU",colors:["#012169","#ffffff","#ff0000"]},{name:"flag_us",code:"US",colors:["#b22234","#ffffff","#3c3b6e"]},{name:"flag_jp",code:"JP",colors:["#ffffff","#bc002d"]},{name:"flag_vn",code:"VN",colors:["#da251d","#ffff00"]},{name:"flag_mv",code:"MV",colors:["#d21034","#007e3a","#ffffff"]},{name:"flag_it",code:"IT",colors:["#009246","#ffffff","#ce2b37"]},{name:"flag_fr",code:"FR",colors:["#0055a4","#ffffff","#ef4135"]},{name:"flag_de",code:"DE",colors:["#000000","#dd0000","#ffce00"]},{name:"flag_es",code:"ES",colors:["#aa151b","#f1bf00","#aa151b"]},{name:"flag_gb",code:"GB",colors:["#012169","#ffffff","#c8102e"]},{name:"flag_nl",code:"NL",colors:["#21468b","#ffffff","#ae1c28"]},{name:"flag_ch",code:"CH",colors:["#ff0000","#ffffff"]},{name:"flag_ma",code:"MA",colors:["#c1272d","#006233"]},{name:"flag_eg",code:"EG",colors:["#ce1126","#ffffff","#000000"]}].forEach(e=>{const t=document.createElement("canvas");t.width=64,t.height=64;const i=t.getContext("2d");if(i){if(i.fillStyle=e.colors[0],i.fillRect(0,0,64,64),e.colors.length>=2)if(e.code==="IT"||e.code==="FR"||e.code==="NL")i.fillStyle=e.colors[1],i.fillRect(21,0,22,64),e.colors[2]&&(i.fillStyle=e.colors[2],i.fillRect(43,0,21,64));else if(e.code==="DE"||e.code==="EG")i.fillStyle=e.colors[1],i.fillRect(0,21,64,22),e.colors[2]&&(i.fillStyle=e.colors[2],i.fillRect(0,43,64,21));else if(e.code==="US"){i.fillStyle=e.colors[1],i.fillRect(0,0,64,64),i.fillStyle=e.colors[0];for(let a=0;a<7;a++)i.fillRect(0,a*10+2,64,5);i.fillStyle=e.colors[2],i.fillRect(0,0,28,36),i.fillStyle=e.colors[1],i.font="4px Arial";for(let a=0;a<5;a++)for(let s=0;s<6;s++)(a+s)%2===0&&i.fillText("★",3+s*4,6+a*6)}else if(e.code==="AU"){i.fillStyle=e.colors[0],i.fillRect(0,0,64,64);const a=32,s=32;i.fillStyle=e.colors[1],i.fillRect(0,0,a,s),i.fillStyle=e.colors[0],i.fillRect(0,0,a,s),i.fillStyle=e.colors[1],i.lineWidth=4,i.beginPath(),i.moveTo(0,0),i.lineTo(a,s),i.moveTo(0,s),i.lineTo(a,0),i.stroke(),i.fillStyle=e.colors[1],i.fillRect(0,s/2-2,a,4),i.fillRect(a/2-2,0,4,s),i.fillStyle=e.colors[2],i.fillRect(0,s/2-1,a,2),i.fillRect(a/2-1,0,2,s),i.strokeStyle=e.colors[2],i.lineWidth=2,i.beginPath(),i.moveTo(2,0),i.lineTo(a,s-2),i.moveTo(0,2),i.lineTo(a-2,s),i.moveTo(a-2,0),i.lineTo(0,s-2),i.moveTo(a,2),i.lineTo(2,s),i.stroke(),i.fillStyle=e.colors[1],i.font="6px Arial",i.fillText("★",40,20),i.fillText("★",50,30),i.fillText("★",45,40),i.fillText("★",55,50),i.fillText("★",35,55)}else e.code==="GB"?(i.fillStyle=e.colors[0],i.fillRect(0,0,64,64),i.fillStyle=e.colors[1],i.fillRect(0,28,64,8),i.fillRect(28,0,8,64),i.fillStyle=e.colors[2],i.fillRect(0,30,64,4),i.fillRect(30,0,4,64)):e.code==="JP"?(i.fillStyle=e.colors[0],i.fillRect(0,0,64,64),i.fillStyle=e.colors[1],i.beginPath(),i.arc(32,32,16,0,Math.PI*2),i.fill()):e.code==="ES"?(i.fillStyle=e.colors[0],i.fillRect(0,0,64,16),i.fillStyle=e.colors[1],i.fillRect(0,16,64,32),i.fillStyle=e.colors[2],i.fillRect(0,48,64,16)):e.code==="CH"?(i.fillStyle=e.colors[0],i.fillRect(0,0,64,64),i.fillStyle=e.colors[1],i.fillRect(0,24,64,16),i.fillRect(24,0,16,64)):(i.fillStyle=e.colors[1],i.fillRect(0,32,64,32));i.fillStyle="#000000",i.font="bold 8px Arial",i.textAlign="center",i.strokeStyle="#ffffff",i.lineWidth=2,i.strokeText(e.code,32,58),i.fillText(e.code,32,58)}const n=new Image;n.src=t.toDataURL(),f[e.name]=n})}function lo(){console.log("🎯 Creating Boss Room tiles..."),ro(),co(),console.log("✅ Boss Room tiles created")}function ro(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");if(e){e.fillStyle="#228B22",e.fillRect(0,0,64,64);const i=f.main_guy_sprite_sheet;i?e.drawImage(i,0,0,36,36,5,5,54,54):(e.fillStyle="#fff",e.font="12px Arial",e.textAlign="center",e.fillText("BOSS",32,35))}const t=new Image;t.src=o.toDataURL(),f.main_guy=t}function co(){const o=document.createElement("canvas");o.width=64,o.height=64;const e=o.getContext("2d");e&&(e.fillStyle="#228B22",e.fillRect(0,0,64,64),[{x:15,y:20,color:"#ff69b4",size:4},{x:35,y:15,color:"#ffd700",size:3},{x:45,y:35,color:"#ff6347",size:4},{x:20,y:45,color:"#9370db",size:3},{x:50,y:50,color:"#00ced1",size:3}].forEach(n=>{e.fillStyle=n.color;for(let a=0;a<5;a++){const s=a*Math.PI*2/5,c=n.x+Math.cos(s)*n.size,l=n.y+Math.sin(s)*n.size;e.beginPath(),e.arc(c,l,n.size/2,0,Math.PI*2),e.fill()}e.fillStyle="#ffff00",e.beginPath(),e.arc(n.x,n.y,n.size/3,0,Math.PI*2),e.fill(),e.strokeStyle="#228b22",e.lineWidth=1,e.beginPath(),e.moveTo(n.x,n.y+n.size/3),e.lineTo(n.x,n.y+n.size+2),e.stroke()}));const t=new Image;t.src=o.toDataURL(),f.flower=t}function ze(){return f}be.getAssets=ze;const Te=32,Me=32,K=64;function fo(){const o=be.getAssets().player_sprite_sheet;function e(t,i){const n=document.createElement("canvas");n.width=K,n.height=K;const a=n.getContext("2d");if(!a)throw new Error("Failed to get 2D context");return a.drawImage(o,i*Te,t*Me,Te,Me,0,0,K,K),n}y.down_walk.push(e(0,0)),y.right_walk.push(e(1,1)),y.up_walk.push(e(2,1)),y.down_idle.push(y.down_walk[0]),y.right_idle.push(y.right_walk[0]),y.up_idle.push(y.up_walk[0])}let _=!1,z=null;const Re={x:5,y:1},uo=1;function ho(){po(),console.log("Boss interaction system initialized")}function po(){z=document.createElement("div"),z.id="boss-interaction-prompt",z.style.cssText=`
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 15px 25px;
    border-radius: 12px;
    font-family: Arial, sans-serif;
    font-size: 18px;
    font-weight: bold;
    display: none;
    z-index: 1500;
    border: 3px solid #FFD700;
    text-align: center;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.7);
    animation: pulse 2s infinite;
  `;const o=document.createElement("style");o.textContent=`
    @keyframes pulse {
      0% { border-color: #FFD700; }
      50% { border-color: #FFA500; }
      100% { border-color: #FFD700; }
    }
  `,document.head.appendChild(o),z.innerHTML=`
    <div>💬 Press SPACE to talk to Nicolo</div>
    <div style="font-size: 14px; margin-top: 5px; opacity: 0.8;">Ask questions about my CV and experience!</div>
  `,document.body.appendChild(z)}function go(){if(ae().id!=="room2")return _&&Ce(),!1;const t=Math.abs(u.x-Re.x)+Math.abs(u.y-Re.y)<=uo;return t&&!_?(mo(),_=!0,console.log("Player is near boss - showing interaction prompt")):!t&&_&&(Ce(),_=!1,console.log("Player left boss proximity - hiding prompt")),t}function mo(){ye("💬 Press SPACE to talk to Nicolo - Ask about my CV!",4e3)}function Ce(){const o=document.getElementById("status-text");o&&o.textContent?.includes("talk to Nicolo")&&(o.textContent="")}function yo(){return _}const bo="modulepreload",wo=function(o){return"/MyImmersiveExperience/"+o},Pe={},xo=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){let l=function(r){return Promise.all(r.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),c=s?.nonce||s?.getAttribute("nonce");n=l(t.map(r=>{if(r=wo(r),r in Pe)return;Pe[r]=!0;const d=r.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":bo,d||(p.as="script"),p.crossOrigin="",p.href=r,c&&p.setAttribute("nonce",c),document.head.appendChild(p),d)return new Promise((g,J)=>{p.addEventListener("load",g),p.addEventListener("error",()=>J(new Error(`Unable to preload CSS for ${r}`)))})}))}function a(s){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=s,window.dispatchEvent(c),!c.defaultPrevented)throw s}return n.then(s=>{for(const c of s||[])c.status==="rejected"&&a(c.reason);return e().catch(a)})},vo="https://huggingface.co/datasets/huggingface/sample-test-data/resolve/main/sample.jsonl";async function Ao(){console.log("🔍 Detecting network speed...");const o=ko();if(o.speed>0)return console.log(`📡 Network API detected: ${o.speed} Mbps`),{speed:o.speed,confidence:"medium",method:"connection_api",warning:o.speed<1.5?`Very slow connection detected (${o.speed} Mbps). 1.8GB download may take 3+ hours.`:void 0};try{const e=await So();return console.log(`⚡ Speed test result: ${e.speed} Mbps`),{speed:e.speed,confidence:e.confidence,method:"speed_test",warning:e.speed<1.5?`Slow connection detected (${e.speed.toFixed(1)} Mbps). Large model download not recommended.`:e.speed<5?`Moderate connection speed (${e.speed.toFixed(1)} Mbps). Download may take 10+ minutes.`:void 0}}catch(e){return console.warn("❌ Speed test failed:",e),{speed:2.5,confidence:"low",method:"estimate",warning:"Could not detect connection speed. Download time may vary significantly."}}}function ko(){const o=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return o&&o.downlink?{speed:o.downlink}:{speed:0}}async function So(){const o=Date.now();try{const e=await fetch(vo,{cache:"no-store",method:"GET"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.blob(),n=(Date.now()-o)/1e3,a=t.size/1024,c=a*8/n/1e3;let l="medium";return n<.5?l="low":n>2&&a>30&&(l="high"),console.log(`📊 Speed test details: ${a.toFixed(0)}KB in ${n.toFixed(2)}s = ${c.toFixed(1)} Mbps`),{speed:Math.max(c,.1),confidence:l}}catch(e){throw console.error("Speed test failed:",e),e}}function Io(o,e){const t=o*1024,i=e/8,n=t/i,a=n/60;let s;if(a<1)s=`${Math.round(n)}s`;else if(a<60)s=`${Math.round(a)}m`;else{const l=Math.floor(a/60),r=Math.round(a%60);s=`${l}h ${r}m`}let c;return a<=5?c="good":a<=15?c="acceptable":a<=60?c="slow":c="very_slow",{timeMinutes:a,timeFormatted:s,recommendation:c}}async function To(o=1.8){const e=await Ao(),t=Io(o,e.speed);return{shouldWarn:t.recommendation==="very_slow"||t.recommendation==="slow"||e.speed<2,networkInfo:e,estimate:t}}const Mo="phi3_model_consent",Ro="qwen_model_consent",Co="phi3_download_state",Po="qwen_download_state";function qe(o){switch(o){case"phi3":return Mo;case"qwen":return Ro;default:return`${o}_model_consent`}}function we(o){switch(o){case"phi3":return Co;case"qwen":return Po;default:return`${o}_download_state`}}function Ge(o){try{const e=qe(o);return localStorage.getItem(e)==="approved"}catch{return console.warn("Cannot access localStorage for consent check"),!1}}function Eo(o,e){try{const t=qe(o),i=we(o);localStorage.setItem(t,e?"approved":"denied"),e&&localStorage.setItem(i,"user_approved")}catch{console.warn("Cannot store user consent in localStorage")}}function oe(o){try{const e=we(o),t=localStorage.getItem(e),i=t==="user_approved";return console.log(`🔍 Download approval check for ${o}: ${i} (stored: ${t})`),i}catch{return console.warn("Cannot access localStorage for download state"),!1}}function Do(o){try{const e=we(o);localStorage.setItem(e,"user_approved"),console.log(`✅ Marked ${o} as user approved`)}catch{console.warn("Cannot store download approval state")}}async function Bo(o,e,t){if(console.log(`🤔 Checking consent for ${o}...`),Ge(o))return console.log(`✅ ${o} has permanent consent, skipping dialog`),{approved:!0};if(window.aiModels&&window.aiModels[o])return console.log(`✅ ${o} already loaded, skipping consent`),{approved:!0};console.log(`🔍 First time requesting ${o} - showing consent dialog with network analysis`);const i=parseFloat(e.size.replace("~","").replace("GB",""));console.log("🔍 Checking network capabilities...");const n=await To(i),a=n.estimate.timeFormatted,s={modelKey:o,modelName:e.name,size:e.size,description:e.description,requirements:[`${e.minMemoryGB||"4"}GB RAM`,o==="phi3"?"Desktop browser recommended":"Modern browser required",...e.recommendedWebGPU?["WebGPU support (Chrome/Edge)"]:[]],benefits:o==="qwen"?["Conversational AI capabilities","Natural dialogue interactions","Context-aware responses","Better than basic Q&A"]:["Advanced conversational AI","Professional-quality responses","Better understanding of context","More detailed explanations"],estimatedTime:a};return new Promise(c=>{_o(s,n,l=>{l.approved&&(Do(o),l.remember&&Eo(o,!0)),c(l)})})}function _o(o,e,t){const i=document.createElement("div");i.id="model-consent-overlay",i.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    backdrop-filter: blur(5px);
  `;const n=document.createElement("div");n.style.cssText=`
    background: white;
    border-radius: 12px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    font-family: 'Courier New', monospace;
  `;const a=o.modelKey==="qwen"?"💬 Qwen Chat AI":"🧠 Phi-3 Advanced AI",s=o.modelKey==="qwen"?"Conversational AI for interactive dialogue":"Enhanced conversational intelligence for your CV";n.innerHTML=`
    <div style="text-align: center; margin-bottom: 20px;">
      <h2 style="margin: 0; color: #333; font-size: 24px;">${a}</h2>
      <p style="margin: 10px 0; color: #666; font-size: 14px;">${s}</p>
    </div>

    <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
      <h3 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">📊 Download Information</h3>
      <ul style="margin: 0; padding-left: 20px; color: #555; line-height: 1.6;">
        <li><strong>Size:</strong> ${o.size}</li>
        <li><strong>Connection Speed:</strong> ${e.networkInfo.speed.toFixed(1)} Mbps</li>
        <li><strong>Estimated Time:</strong> ${o.estimatedTime}</li>
        <li><strong>One-time download</strong> (cached for future use)</li>
      </ul>
    </div>

    ${e.shouldWarn?`
    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
      <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 16px;">⚠️ Connection Warning</h3>
      <p style="margin: 0; color: #856404; line-height: 1.6; font-size: 14px;">
        ${e.networkInfo.warning||`Slow connection detected. Download may take ${o.estimatedTime}.`}
      </p>
      <p style="margin: 10px 0 0 0; color: #856404; line-height: 1.6; font-size: 13px;">
        💡 <strong>Recommendations:</strong> Switch to WiFi, use a faster connection, or try the ${o.modelKey==="qwen"?"lighter DistilBERT model":"lighter Qwen or DistilBERT models"} instead.
      </p>
    </div>
    `:""}

    <div style="background: #e7f3ff; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
      <h3 style="margin: 0 0 10px 0; color: #0066cc; font-size: 16px;">⚡ What You'll Get</h3>
      <ul style="margin: 0; padding-left: 20px; color: #0066cc; line-height: 1.6;">
        ${o.benefits.map(g=>`<li>${g}</li>`).join("")}
      </ul>
    </div>

    <div style="background: #fff3cd; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
      <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 16px;">🔧 Requirements</h3>
      <ul style="margin: 0; padding-left: 20px; color: #856404; line-height: 1.6;">
        ${o.requirements.map(g=>`<li>${g}</li>`).join("")}
      </ul>
    </div>

    <div style="background: #d1ecf1; border-radius: 8px; padding: 15px; margin-bottom: 25px;">
      <p style="margin: 0; color: #0c5460; font-size: 13px; text-align: center;">
        💡 <strong>Tip:</strong> You can always switch back to ${o.modelKey==="qwen"?"lighter DistilBERT model":"lighter models (DistilBERT/Qwen)"} anytime
      </p>
    </div>

    <div style="margin-bottom: 20px;">
      <label style="display: flex; align-items: center; cursor: pointer; color: #333;">
        <input type="checkbox" id="remember-choice" style="margin-right: 10px; transform: scale(1.2);">
        <span>Remember my choice (don't ask again)</span>
      </label>
    </div>

    <div style="display: flex; gap: 15px; justify-content: center;">
      <button id="consent-cancel" style="
        padding: 12px 24px;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        transition: background-color 0.2s;
      ">Maybe Later</button>
      
      <button id="consent-approve" style="
        padding: 12px 24px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        transition: background-color 0.2s;
      ">Download ${o.modelKey==="qwen"?"Qwen 💬":"Phi-3 🚀"}</button>
    </div>
  `,i.appendChild(n),document.body.appendChild(i);const c=document.createElement("style");c.textContent=`
    #consent-cancel:hover { background: #5a6268 !important; }
    #consent-approve:hover { background: #0056b3 !important; }
  `,document.head.appendChild(c);const l=g=>{g.key==="Escape"&&(r(),t({approved:!1}))};document.addEventListener("keydown",l);const r=()=>{document.removeEventListener("keydown",l),document.head.removeChild(c),document.body.removeChild(i)},d=n.querySelector("#remember-choice"),h=n.querySelector("#consent-cancel"),p=n.querySelector("#consent-approve");h.addEventListener("click",()=>{r(),t({approved:!1})}),p.addEventListener("click",()=>{Lo(n,t,{approved:!0,remember:d.checked})}),i.addEventListener("click",g=>{g.target===i&&(r(),t({approved:!1}))}),setTimeout(()=>p.focus(),100)}function Lo(o,e,t){const i=o.parentElement,n=document.head.querySelector("style:last-child"),a=o.innerHTML.includes("Qwen Chat AI"),s=a?"💬 Downloading Qwen":"🧠 Downloading Phi-3",c=a?"Conversational AI model is downloading...":"Advanced AI model is downloading...";o.innerHTML=`
    <div style="text-align: center; margin-bottom: 30px;">
      <h2 style="margin: 0; color: #333; font-size: 24px;">${s}</h2>
      <p style="margin: 10px 0; color: #666; font-size: 14px;">${c}</p>
    </div>

    <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
      <div style="margin-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span style="font-weight: bold;">Progress:</span>
          <span id="progress-percentage">0%</span>
        </div>
        <div style="background: #e0e0e0; border-radius: 10px; height: 20px; overflow: hidden;">
          <div id="progress-bar" style="background: linear-gradient(90deg, #007bff, #0056b3); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
        </div>
      </div>
      
      <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
        <span id="download-speed">Estimating speed...</span>
        <span id="time-remaining">Calculating time...</span>
      </div>
    </div>

    <div style="background: #e7f3ff; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
      <p style="margin: 0; color: #0066cc; font-size: 13px; text-align: center;">
        💡 <strong>Tip:</strong> You can continue using the app while the model downloads in the background
      </p>
    </div>

    <div style="text-align: center;">
      <button id="continue-background" style="
        padding: 12px 24px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Courier New', monospace;
        font-weight: bold;
      ">Continue in Background</button>
    </div>
  `;const l=()=>{n&&n.parentNode&&document.head.removeChild(n),i&&i.parentNode&&document.body.removeChild(i)},r=o.querySelector("#continue-background");r.addEventListener("click",()=>{l(),e(t)});const d=o.querySelector("#progress-bar"),h=o.querySelector("#progress-percentage"),p=o.querySelector("#download-speed"),g=o.querySelector("#time-remaining");let T=Date.now(),C=0,O=!1;window.updateModelProgress=A=>{if(O)return;const Ae=Date.now(),ke=Ae-T,tt=A.bytesDownloaded-C,se=ke>0?tt*1e3/ke:0,le=se/(1024*1024),ot=A.totalBytes-A.bytesDownloaded,X=se>0?ot/se:0,re=Math.round(A.progress*100);d.style.width=`${re}%`,h.textContent=`${re}%`,le>0?p.textContent=`${le.toFixed(1)} MB/s`:p.textContent="Calculating speed...",X>60?g.textContent=`${Math.round(X/60)}m remaining`:X>0?g.textContent=`${Math.round(X)}s remaining`:g.textContent="Calculating time...",(A.progress>=.99||re>=99)&&(O=!0,d.style.width="100%",h.textContent="100%",g.textContent="Complete!",p.textContent=`${le.toFixed(1)} MB/s (finished)`,setTimeout(()=>{e(t)},1500)),T=Ae,C=A.bytesDownloaded},p.textContent="Starting download...",g.textContent="Calculating...",r.cleanup=()=>{window.updateModelProgress=null,O=!0}}class Uo{userAgent;browserInfo=null;constructor(){this.userAgent=navigator.userAgent}detectBrowser(){if(this.browserInfo)return this.browserInfo;const e={name:this.getBrowserName(),version:this.getBrowserVersion(),engine:this.getBrowserEngine(),isDesktop:this.isDesktop(),isMobile:this.isMobile(),isTablet:this.isTablet(),os:this.getOperatingSystem(),osVersion:this.getOSVersion(),supportsWebGPU:this.checkWebGPUSupport(),supportsWebAssembly:this.checkWebAssemblySupport(),estimatedRAM:this.estimateRAM(),compatibilityLevel:"good"};return e.compatibilityLevel=this.calculateCompatibility(e),this.browserInfo=e,e}getBrowserName(){const e=this.userAgent;return e.includes("CriOS")||e.includes("Chrome")&&!e.includes("Edge")?"Chrome":e.includes("Safari")&&!e.includes("Chrome")&&!e.includes("CriOS")?"Safari":e.includes("Firefox")?"Firefox":e.includes("Edge")?"Edge":e.includes("Opera")||e.includes("OPR")?"Opera":e.includes("Samsung")?"Samsung Internet":"Unknown"}getBrowserVersion(){const e=this.userAgent;let t;return e.includes("CriOS")?(t=e.match(/CriOS\/(\d+\.\d+)/),t?t[1]:"Unknown"):e.includes("Chrome")&&!e.includes("Edge")?(t=e.match(/Chrome\/(\d+\.\d+)/),t?t[1]:"Unknown"):e.includes("Safari")&&!e.includes("Chrome")&&!e.includes("CriOS")?(t=e.match(/Safari\/(\d+\.\d+)/),t?t[1]:"Unknown"):e.includes("Firefox")?(t=e.match(/Firefox\/(\d+\.\d+)/),t?t[1]:"Unknown"):e.includes("Edge")?(t=e.match(/Edge\/(\d+\.\d+)/),t?t[1]:"Unknown"):"Unknown"}getBrowserEngine(){const e=this.userAgent;return e.includes("CriOS")||e.includes("WebKit")&&e.includes("Chrome")?"Blink":e.includes("WebKit")&&!e.includes("Chrome")&&!e.includes("CriOS")?"WebKit":e.includes("Gecko")&&e.includes("Firefox")?"Gecko":"Unknown"}isDesktop(){const e=this.userAgent;return!(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)||"ontouchstart"in window&&screen.width<1024)}isMobile(){const e=this.userAgent;return/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)||"ontouchstart"in window&&screen.width<768}isTablet(){const e=this.userAgent;return/iPad/.test(e)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1||"ontouchstart"in window&&screen.width>=768&&screen.width<1024}getOperatingSystem(){const e=this.userAgent;return/iPad|iPhone|iPod/.test(e)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?"iOS":/Android/.test(e)?"Android":/Windows/.test(e)?"Windows":/Macintosh|Mac OS X/.test(e)?"macOS":/Linux/.test(e)?"Linux":"Unknown"}getOSVersion(){const e=this.userAgent;let t;switch(this.getOperatingSystem()){case"iOS":return t=e.match(/OS (\d+_\d+)/),t?t[1].replace("_","."):"Unknown";case"Android":return t=e.match(/Android (\d+\.\d+)/),t?t[1]:"Unknown";case"Windows":return t=e.match(/Windows NT (\d+\.\d+)/),t?t[1]:"Unknown";case"macOS":return t=e.match(/Mac OS X (\d+_\d+)/),t?t[1].replace("_","."):"Unknown";default:return"Unknown"}}checkWebGPUSupport(){return"gpu"in navigator}checkWebAssemblySupport(){try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function")return!0}catch{return!1}return!1}estimateRAM(){if("deviceMemory"in navigator)return navigator.deviceMemory;const e=this.getOperatingSystem(),t=this.isMobile(),i=this.isTablet();return t?e==="iOS"?3:2:i?e==="iOS"?4:3:8}calculateCompatibility(e){let t=0;return e.name==="Chrome"||e.name==="Edge"?t+=40:e.name==="Firefox"?t+=30:e.name==="Safari"?t+=e.os==="iOS"?10:25:t+=15,e.isDesktop?t+=30:e.isTablet?t+=20:e.isMobile&&(t+=10),e.supportsWebGPU&&(t+=20),e.estimatedRAM>=8?t+=10:e.estimatedRAM>=4&&(t+=5),t>=80?"excellent":t>=60?"good":t>=40?"limited":"poor"}getCompatibilityInfo(){const e=this.detectBrowser();return{level:e.compatibilityLevel,aiSupport:{distilbert:this.canRunDistilBERT(e),qwen:this.canRunQwen(e),phi3:this.canRunPhi3(e)},recommendedModel:this.getRecommendedModel(e),warnings:this.getWarnings(e),suggestions:this.getSuggestions(e),message:this.getCompatibilityMessage(e)}}canRunDistilBERT(e){return e.os==="iOS"&&e.name==="Safari"?!1:e.supportsWebAssembly}canRunQwen(e){return e.os==="iOS"||e.isMobile&&e.estimatedRAM<3?!1:e.supportsWebAssembly&&(e.name==="Chrome"||e.name==="Edge"||e.name==="Firefox")}canRunPhi3(e){return e.os==="iOS"||e.isMobile?!1:e.isDesktop&&e.estimatedRAM>=4&&e.supportsWebAssembly&&(e.name==="Chrome"||e.name==="Edge")}getRecommendedModel(e){return this.canRunPhi3(e)?"phi3":this.canRunQwen(e)?"qwen":(this.canRunDistilBERT(e),"distilbert")}getWarnings(e){const t=[];return e.os==="iOS"&&e.name==="Safari"&&(t.push("iOS Safari has known compatibility issues with AI models"),t.push("Consider using Chrome or Firefox for better performance")),e.isMobile&&e.estimatedRAM<2&&t.push("Limited RAM detected - only basic models will be available"),!e.supportsWebGPU&&e.isDesktop&&t.push("WebGPU not available - AI processing will be slower"),e.name==="Unknown"&&t.push("Unsupported browser - functionality may be limited"),t}getSuggestions(e){const t=[];return e.name==="Safari"&&e.os!=="iOS"&&t.push("Switch to Chrome or Edge for better AI model support"),e.isMobile&&t.push("Try the desktop version for access to all AI models"),!e.supportsWebGPU&&e.isDesktop&&t.push("Update your browser to enable WebGPU acceleration"),t}getCompatibilityMessage(e){const t=this.canRunDistilBERT(e)||this.canRunQwen(e)||this.canRunPhi3(e);return e.os==="iOS"&&e.name==="Safari"?"iOS Safari has compatibility limitations with AI models. You'll receive pre-written responses instead of live AI processing. For the full experience, try Chrome on iOS or the desktop version.":e.os==="iOS"&&e.name==="Chrome"?`Chrome on iOS has good compatibility! You can use DistilBERT for quick responses${this.canRunQwen(e)?" and Qwen for conversations":""}. For premium AI features, try the desktop version.`:e.isMobile&&e.name==="Chrome"&&e.os==="Android"?`Chrome on Android has good compatibility! You can use DistilBERT for quick responses${this.canRunQwen(e)?" and Qwen for conversations":""}. For premium AI features, try the desktop version.`:e.isMobile&&e.name==="Firefox"?"Firefox mobile has decent compatibility. You can use DistilBERT for responses. Desktop Firefox offers better performance with more AI models.":e.isMobile&&!t?`${e.name} mobile has limited AI support. You'll receive pre-written responses. Desktop browsers offer much better AI performance and features.`:e.isMobile?`${e.name} mobile has basic AI support. Desktop browsers offer much better performance and more AI models.`:e.isDesktop&&(e.name==="Chrome"||e.name==="Edge")?`Excellent! ${e.name} desktop has full compatibility with all AI models including the premium Phi-3 experience.`:e.isDesktop&&e.name==="Firefox"?"Firefox desktop has good compatibility. All AI models work, though Phi-3 may run slower without WebGPU acceleration.":e.isDesktop&&e.name==="Safari"?"Safari desktop has moderate compatibility. DistilBERT and Qwen should work, but Chrome/Edge offers better performance.":"Your browser has basic compatibility. Some AI features may be limited."}}const je=new Uo;function M(){return je.detectBrowser()}function U(){return je.getCompatibilityInfo()}function xe(){return M().os==="iOS"}function $o(){return M().isMobile}let v=null,P=!1,w="",S="",x=null;function Fo(){return"deviceMemory"in navigator?navigator.deviceMemory:$o()?2:4}function Qe(){return"gpu"in navigator}function Ye(o){const e=W[o];if(!e)return{canRun:!1,reason:"Model not found"};if(xe())return{canRun:!1,reason:"iOS Safari compatibility",suggestion:"Using smart fallback responses instead"};const t=Fo();return t<e.minMemoryGB?{canRun:!1,reason:`Requires ${e.minMemoryGB}GB RAM, detected ${t}GB`,suggestion:`Try ${e.minMemoryGB<=2?"DistilBERT":"Qwen"} for better performance`}:e.recommendedWebGPU&&!Qe()&&o==="phi3"?{canRun:!0,reason:"Will use CPU processing (slower performance)",suggestion:"Use Chrome/Edge for faster WebGPU acceleration"}:{canRun:!0}}function Wo(){const o=["phi3","qwen","distilbert"];for(const e of o)if(Ye(e).canRun)return e;return"distilbert"}function He(o){const e=M();U();const t=o.toLowerCase();let i="";t.includes("hi")||t.includes("hello")||t.includes("ciao")?i="Hi there! I'm Nicolo Pedrani. Welcome to my interactive CV! I'm a Data Scientist at Deloitte Consulting and former R&D System Engineer. What would you like to know about my experience?":t.includes("experience")||t.includes("work")||t.includes("job")?i="I currently work as a Data Scientist at Deloitte Consulting, focusing on business analytics, machine learning, and client solutions. Previously, I was an R&D System Engineer at Leonardo SpA, working on defense systems and infrared technologies.":t.includes("skill")||t.includes("technology")||t.includes("programming")?i="My key skills include Python, R, machine learning, PyTorch, scikit-learn, Power BI, Azure ML, and statistical analysis. I also have experience with MATLAB, Simulink, and system engineering from my defense industry background.":t.includes("education")||t.includes("study")||t.includes("university")?i="I have a strong educational background in engineering and data science, which has equipped me with both theoretical knowledge and practical problem-solving skills across multiple domains.":t.includes("project")||t.includes("achievement")?i="I've worked on diverse projects including NPS analysis, energy cost optimization, fashion retail forecasting, recommendation systems, infrared detection systems, and missile warning technologies. Each project combined technical innovation with real business impact.":i="I'm Nicolo Pedrani - a Data Scientist at Deloitte with R&D experience at Leonardo SpA. I specialize in machine learning, business analytics, and defense systems. What specific aspect would you like to know more about?";let n="";return e.os==="iOS"&&e.name==="Safari"?n="I'm using pre-written responses because iOS Safari has known compatibility issues with AI models. ":e.isMobile&&e.name==="Chrome"?n="I'm using simplified responses on Chrome mobile for better performance. ":e.isMobile&&e.name==="Firefox"?n="I'm using basic responses optimized for Firefox mobile. ":e.isMobile?n=`I'm using simplified responses optimized for ${e.name} mobile. `:n="I'm using fallback responses due to AI system limitations. ",n+i}function Oo(o){return He(o)}let No=null,I={},E={distilbert:"pending",qwen:"pending",phi3:"pending"},F={},Ve=new Set,b=null;const W={distilbert:{name:"Xenova/distilbert-base-cased-distilled-squad",description:"DistilBERT model optimized for question-answering",size:"~65MB",type:"qa",minMemoryGB:1,recommendedWebGPU:!1},qwen:{name:"onnx-community/Qwen2.5-0.5B-Instruct",description:"Qwen 2.5 0.5B Instruct - Small conversational language model",size:"~500MB",type:"chat",minMemoryGB:2,recommendedWebGPU:!1},phi3:{name:"Xenova/Phi-3-mini-4k-instruct",description:"Phi-3 Mini - Advanced 3.8B parameter instruction model",size:"~1.8GB",type:"chat",minMemoryGB:4,recommendedWebGPU:!0,workingExamples:["https://huggingface.co/spaces/webml-community/phi-3.5-webgpu","https://github.com/huggingface/transformers.js-examples/tree/main/phi-3.5-webgpu"]}},fe={preferredModel:"distilbert",fallbackModels:["distilbert"],enableModelFallback:!0,useOnlyFallback:!1},m={personalInfo:`
    Nicolo Pedrani is a professional with experience in Data Science and R&D System Engineering.
    He has worked in consulting, analytics, and infrared defense systems.
    
    Personal interests and hobbies:
    - Football: Passionate about playing and watching football, enjoys both recreational games and following professional leagues
    - Extensive Travel: Has visited 14 countries across 4 continents including Italy, France, Germany, United States, Japan, Australia, Vietnam, Maldives, Spain, United Kingdom, Netherlands, Switzerland, Morocco, and Egypt
    - Reading: Enjoys reading technical literature, business books, and staying updated with industry trends
    - Cultural exploration: Through travel experiences has gained appreciation for different cultures, cuisines, and perspectives
    - Sports and fitness: Maintains active lifestyle through football and other physical activities
    - International perspective: Travel experiences have provided global mindset and cultural adaptability valuable in professional settings
  `,workExperience:`
    Deloitte Consulting - Data Science Experience:
    - NPS (Net Promoter Score) analysis and customer satisfaction analytics
    - Energy cost optimization projects
    - Fashion retail time series analysis and forecasting
    - Supply chain and distribution network mapping
    - Statistical analysis including forecast histograms and box plot analysis
    - Power BI dashboard development for business intelligence
    - Advanced analytics using Python and scikit-learn
    - Machine learning projects with PyTorch and LangChain
    - Recommendation system development
    - Azure Machine Learning and Azure Data Factory implementation
    - AI chatbot development
    - Project management with Gantt charts and timeline planning

    Leonardo SpA - R&D System Engineer Experience:
    - Infrared (IR) spectrum visualization and analysis
    - Atmospheric transmission modeling and analysis
    - Multi-camera array positioning systems
    - Object detection with bounding boxes using computer vision
    - Kalman filter implementation for state estimation
    - Optical flow motion vector analysis
    - 360-degree missile warning coverage systems
    - Threat detection interface development
    - Multiple target tracking systems
    - MATLAB and Simulink development
    - IR system architecture design
    - Requirements specification and documentation
    - IR detector hardware integration
  `,education:`
    Technical background in Data Science, Machine Learning, and System Engineering.
    Expertise in statistical analysis, computer vision, and defense systems.
  `,skills:`
    Programming: Python, MATLAB, TypeScript, JavaScript
    Data Science: scikit-learn, PyTorch, statistical analysis, time series forecasting
    Machine Learning: LangChain, recommendation systems, predictive modeling
    Cloud Platforms: Azure Machine Learning, Azure Data Factory
    Business Intelligence: Power BI, dashboard development
    Computer Vision: Object detection, optical flow, Kalman filtering
    Defense Systems: Infrared systems, missile warning systems, threat detection
    Project Management: Agile methodologies, Gantt charts
    Tools: MATLAB/Simulink, Git, various analytics platforms
  `,projects:`
    - Customer satisfaction analytics using NPS methodology
    - Energy cost optimization for large enterprises
    - Fashion retail demand forecasting using time series analysis
    - Supply chain optimization and network analysis
    - Interactive portfolio game (current project) using TypeScript and HTML5 Canvas
    - AI-powered chatbot development
    - Infrared detection and tracking systems
    - Multi-camera surveillance systems
    - Real-time threat detection and tracking
  `};async function B(o){const e=W[o];if(!e||!x)return console.error(`❌ Model key invalid or transformers not loaded: ${o}`),E[o]="error",!1;try{console.log(`🔄 Background loading ${o} model: ${e.name}`),E[o]="loading",b&&b(o,"loading",0);const t=e.type==="chat"?"text-generation":"question-answering",i={device:Qe()&&e.recommendedWebGPU?"webgpu":"wasm",...o==="phi3"&&{dtype:"q4",use_external_data_format:!0},progress_callback:a=>{if(a.status==="downloading"){const s=Math.min(a.loaded?Math.floor(a.loaded/1048576):0,90);if(console.log(`📥 Background downloading ${o}: ~${s}MB loaded...`),Je(o)&&Xe(o,a),window.updateModelProgress){const c=a.loaded||0,l=a.total||1.8*1024*1024*1024;window.updateModelProgress({progress:a.progress||c/l,bytesDownloaded:c,totalBytes:l})}b&&b(o,"downloading",s)}else a.status==="loading"&&(console.log(`🧠 Loading ${o} model into memory...`),b&&b(o,"finalizing",95))}};i.dtype="q4";const n=await x.pipeline(t,e.name,i);return I[o]={pipeline:n,modelInfo:e,loadTime:Date.now()},typeof window<"u"&&(window.aiModels=window.aiModels||{},window.aiModels[o]=!0),E[o]="completed",console.log(`✅ Background loading of ${o} completed!`),b&&b(o,"completed",100),!0}catch(t){return console.error(`❌ Failed to background load ${o} model:`,t),E[o]="error",b&&b(o,"error",0),!1}}async function zo(o){const e=W[o];if(!e||!x)return console.error(`❌ Model key invalid or transformers not loaded: ${o}`),!1;try{console.log(`🤖 Loading ${o} model: ${e.name}`),console.log(`📦 Model info: ${e.description} (${e.size})`),Jo(o,!0),Ho(o);const t=e.type==="chat"?"text-generation":"question-answering",i={device:"webgpu",progress_callback:a=>{if(a.status==="downloading"){const s=Math.round(a.progress||0),c=a.loaded||0,l=a.total||0,r=l-c;Je(o)&&Xe(o,a),window.updateModelProgress&&window.updateModelProgress({progress:a.progress||0,bytesDownloaded:c,totalBytes:l});let d="";if(a.rate&&a.rate>0){const T=(a.rate/1048576).toFixed(1),C=r>0?Math.round(r/a.rate):0;d=` | ${T} MB/s | ${C}s remaining`}const h=T=>{if(T===0)return"0 B";const C=1024,O=["B","KB","MB","GB"],A=Math.floor(Math.log(T)/Math.log(C));return parseFloat((T/Math.pow(C,A)).toFixed(1))+" "+O[A]},p=h(c),g=h(l),J=h(r);console.log(`📥 Downloading ${o} model: ${s}% (${p}/${g}, ${J} left)${d}`)}else a.status==="loading"&&console.log(`🧠 Loading ${o} model into memory...`)}};i.dtype="q4",v=await x.pipeline(t,e.name,i),console.log(`🧪 Testing ${o} model...`);let n;if(e.type==="chat"){let a;try{const s=[{role:"system",content:"You are a helpful assistant."},{role:"user",content:"What is your name?"}];a=v.tokenizer.apply_chat_template(s,{tokenize:!1,add_generation_prompt:!0})}catch{o==="qwen"?a=`<|im_start|>system
You are a helpful assistant.<|im_end|>
<|im_start|>user
What is your name?<|im_end|>
<|im_start|>assistant
`:a=`System: You are a helpful assistant.
User: What is your name?
Assistant:`}if(n=await v(a,{max_new_tokens:20,do_sample:!1,return_full_text:!1}),console.log(`🔍 ${o} chat test result:`,n),!n||!n[0]?.generated_text||n[0].generated_text.length<3)return console.warn(`⚠️ ${o} model test failed`),!1}else if(n=await v("What is the name?","The name is Nicolo Pedrani. He is a professional."),console.log(`🔍 ${o} Q&A test result:`,n),!n.answer||n.score<.01)return console.warn(`⚠️ ${o} model test failed`),!1;return console.log(`✅ ${o} model test successful!`),w=`${o} (${e.name})`,S=e.type,console.log(`🔄 Model switched to: ${w}`),console.log(`📝 Model type: ${S}`),!0}catch(t){return console.error(`❌ Failed to load ${o} model:`,t),!1}}async function qo(){try{if(console.log("🔧 Checking AI system initialization..."),xe())return console.log("🍎 iOS device detected - disabling AI models due to Safari ONNX Runtime issues"),P=!1,w="iOS Fallback System",S="fallback",console.log("✅ iOS fallback system initialized successfully!"),!0;fe.useOnlyFallback;const o=fe.preferredModel;return I[o]&&E[o]==="completed"?(console.log(`⚡ Using preloaded ${o} model for initialization!`),v=I[o].pipeline,w=`${o} (${I[o].modelInfo.name})`,S=I[o].modelInfo.type,P=!0,console.log(`✅ AI system ready with preloaded ${o}!`),console.log(`📋 Active model: ${w}`),!0):(console.log("🔄 No preloaded models available, using fallback responses for now"),P=!1,w="Loading in background...",S="fallback",!0)}catch(o){return console.error("💥 AI initialization error:",o),console.log("🔄 Falling back to scripted responses"),P=!1,w="Fallback System",S="fallback",!0}}function ne(){const o=w.match(/^(\w+)\s*\(/);return o?o[1]:fe.preferredModel}async function ee(o){if(!W[o])return console.error(`❌ Invalid model key: ${o}. Available: ${Object.keys(W).join(", ")}`),!1;const e=Ye(o);if(!e.canRun)return console.warn(`⚠️ Cannot run ${o}: ${e.reason}`),!1;if((o==="phi3"||o==="qwen")&&!Ge(o)){console.log(`🤔 Requesting user consent for ${o} model...`);try{if(!(await Bo(o,W[o])).approved)return console.log(`❌ User declined ${o} model download`),!1;console.log(`✅ User approved ${o} model download`)}catch(t){return console.error(`❌ Error requesting consent for ${o}:`,t),!1}}if(console.log(`🔄 Switching to ${o} model...`),I[o]&&E[o]==="completed")return console.log(`⚡ Using preloaded ${o} model - instant switch!`),v=I[o].pipeline,w=`${o} (${I[o].modelInfo.name})`,S=I[o].modelInfo.type,P=!0,console.log(`✅ Instantly switched to preloaded ${o} model!`),console.log(`🔄 Model switched to: ${w}`),console.log(`📝 Model type: ${S}`),!0;{console.log(`🔄 Model not preloaded, loading ${o} now...`);const t=await zo(o);return t?(P=!0,console.log(`✅ Successfully switched to ${o} model!`)):console.error(`❌ Failed to switch to ${o} model`),t}}async function Go(o){try{if(xe())return console.log("🍎 iOS device detected - using fallback responses due to known Safari compatibility issues"),Oo(o);if((!v||!P)&&(console.log("🔄 AI pipeline not ready, attempting to initialize..."),!await qo().catch(s=>(console.error("❌ Failed to initialize AI:",s),!1))))return He(o);const e=jo(o);if(console.log("🔍 Context Selection:",{question:o,contextPreview:e.substring(0,200)+"...",contextLength:e.length}),!e)return"I'd be happy to answer questions about my professional experience, skills, projects, or background. Could you please ask something more specific about my CV or career?";let t;if(S==="chat"){const a=[{role:"system",content:`You ARE Nicolo Pedrani. You are NOT an AI assistant. You are a real person with real experiences. Never say "As an AI" or mention being an AI language model.

You are Nicolo Pedrani, a professional Data Scientist and R&D System Engineer with actual work experience at Deloitte and Leonardo SpA. When asked about YOUR experiences, talk about them in first person as if they are YOUR real professional background.

Your background: ${e}

IMPORTANT: Always respond as Nicolo Pedrani in first person (I, my, me). Keep responses to 2-3 clear sentences. Be direct and professional. Never break character or mention being an AI.`},{role:"user",content:o}];let s;try{s=v.tokenizer.apply_chat_template(a,{tokenize:!1,add_generation_prompt:!0})}catch{console.log("Chat template not available, using Qwen-specific format"),ne()==="qwen"?s=`<|im_start|>system
You ARE Nicolo Pedrani. You are NOT an AI assistant. You are a real person with real experiences. Never say "As an AI" or mention being an AI language model.

You are Nicolo Pedrani, a professional Data Scientist and R&D System Engineer with actual work experience at Deloitte and Leonardo SpA. When asked about YOUR experiences, talk about them in first person as if they are YOUR real professional background.

Your background: ${e}

IMPORTANT: Always respond as Nicolo Pedrani in first person (I, my, me). Keep responses to 2-3 clear sentences. Be direct and professional. Never break character or mention being an AI.<|im_end|>
<|im_start|>user
${o}<|im_end|>
<|im_start|>assistant
`:s=`System: You ARE Nicolo Pedrani. You are NOT an AI assistant. You are a real person with real experiences. Never say "As an AI" or mention being an AI language model.

You are Nicolo Pedrani, a professional Data Scientist and R&D System Engineer with actual work experience at Deloitte and Leonardo SpA. When asked about YOUR experiences, talk about them in first person as if they are YOUR real professional background.

Your background: ${e}

IMPORTANT: Always respond as Nicolo Pedrani in first person (I, my, me). Keep responses to 2-3 clear sentences. Be direct and professional. Never break character or mention being an AI.

User: ${o}
Assistant: `}t={answer:(await v(s,{max_new_tokens:80,do_sample:!1,return_full_text:!1,temperature:.1}))[0]?.generated_text?.trim()||"",score:1}}else try{t=await v(o,e)}catch(a){return console.error("❌ Pipeline execution failed:",a),"I encountered an error processing your question. This might be due to device limitations. Please try a simpler question or use desktop."}console.log("🤖 AI Model Result:",{model:w,question:o,answer:t.answer,score:t.score,contextLength:e.length});const i=t.answer?.trim();let n="";if(i&&i.length>5&&t.score>.1)n=Ee(i,o);else{console.log("⚠️ AI model returned poor answer, using fallback");const a=Qo(o);n=Ee(a,o)}return n||"I don't have specific information about that topic in my experience. Could you ask about my work at Deloitte, Leonardo SpA, or my technical skills?"}catch(e){return console.error("Error processing question:",e),"I apologize, but I'm having trouble processing your question right now. Please try rephrasing it or ask about my work experience, skills, or projects."}}function jo(o){const e=o.toLowerCase();let t=[];const i=["work","job","experience","career","deloitte","leonardo","consulting","engineer","project","company","professional","employment"],n=["skill","technology","programming","python","matlab","machine learning","ai","data science","technical","expertise","tools","software"],a=["education","study","learn","degree","qualification","university","school","training"],s=["hobby","hobbies","travel","football","personal","interest","country","countries","visit","visited","fun","free time","leisure","sports","reading","books"],c=["project","projects","build","built","create","created","develop","developed","system","application","portfolio"],l=["travel","traveling","travelled","country","countries","visit","visited","culture","cultural","international","abroad","trip","vacation"],r=["football","soccer","sport","sports","play","playing","game","games","team","athletic"];i.some(d=>e.includes(d))&&t.push(m.workExperience),n.some(d=>e.includes(d))&&t.push(m.skills),a.some(d=>e.includes(d))&&t.push(m.education),(s.some(d=>e.includes(d))||l.some(d=>e.includes(d))||r.some(d=>e.includes(d)))&&t.push(m.personalInfo),c.some(d=>e.includes(d))&&t.push(m.projects),l.some(d=>e.includes(d))&&(t=[m.personalInfo,...t.filter(d=>d!==m.personalInfo)]),r.some(d=>e.includes(d))&&(t=[m.personalInfo,...t.filter(d=>d!==m.personalInfo)]),t.length===0&&(t=[m.workExperience,m.personalInfo,m.skills]);{const d=t.slice(0,2).join(" ").replace(/\n+/g," ").trim();return console.log("🔍 Using TARGETED context:",d.length,"characters"),d.length>800?d.substring(0,800)+"...":d}}function Ee(o,e){let t=o.trim();if(t.length>100)return t;const i=e.toLowerCase();if(i.includes("deloitte")&&!t.includes("Deloitte"))t+=t?" ":"",t+="At Deloitte, I focused on data science consulting, working with various analytics tools and helping clients optimize their business processes through data-driven insights.";else if(i.includes("leonardo")&&!t.includes("Leonardo"))t+=" At Leonardo SpA, I specialized in R&D for infrared and defense systems, working on cutting-edge technology for threat detection and tracking in mission-critical applications.";else if(i.includes("skill")||i.includes("technology"))t+=" I'm passionate about staying current with emerging technologies and applying them to solve complex problems across business and technical domains.";else if(i.includes("project"))t+=" I enjoy tackling diverse projects that challenge me to combine technical expertise with creative problem-solving approaches.";else if(i.includes("football")||i.includes("soccer")){const n=[" Football has been a lifelong passion - I love both playing recreationally and following professional leagues. It's taught me valuable lessons about teamwork and strategy."," Playing football keeps me active and helps me unwind from technical work. There's something special about the team dynamics and strategic thinking involved."," I've always been drawn to football for its combination of physical skill and tactical intelligence. It's a great way to stay fit and connect with people."];t+=n[Math.floor(Math.random()*n.length)]}else if(i.includes("travel")||i.includes("country")||i.includes("visit")){const n=[" Traveling has been incredibly enriching - each of the 14 countries I've visited has taught me something new about different cultures and perspectives."," My travel experiences across 4 continents have given me a global mindset that's valuable in today's interconnected world. From the technology hubs of Japan to the ancient cultures of Morocco."," I believe travel is one of the best forms of education. Each destination - whether it's the innovation in Australia or the efficiency in Germany - offers unique insights."," Exploring different countries has shaped my worldview and made me more adaptable. It's fascinating to see how different cultures approach similar challenges."];t+=n[Math.floor(Math.random()*n.length)]}else if(i.includes("reading")||i.includes("book")){const n=[" Reading helps me stay current with industry trends and broaden my perspective beyond just technical topics."," I enjoy reading both technical literature and books on business strategy - it helps me see the bigger picture in my work."," Books have always been a great way for me to learn new concepts and stay intellectually curious."];t+=n[Math.floor(Math.random()*n.length)]}else if(i.includes("hobby")||i.includes("personal")||i.includes("interest")){const n=[" My hobbies - football, travel, and reading - all contribute to who I am professionally. They've taught me teamwork, cultural awareness, and continuous learning."," I believe having diverse interests outside of work makes me a more well-rounded person and professional. Each hobby brings something unique to the table."," Balancing technical work with active hobbies like football and enriching experiences like travel helps me maintain creativity and fresh perspectives."];t+=n[Math.floor(Math.random()*n.length)]}return t}const q={deloitte:["At Deloitte Consulting, I worked on fascinating data science projects including NPS analysis, energy cost optimization, and fashion retail forecasting. I also developed AI chatbots and recommendation systems.","My time at Deloitte was focused on data science consulting, where I helped clients optimize their business processes through analytics. I worked with tools like Power BI and developed various ML solutions.","At Deloitte, I specialized in business analytics and data science. Some highlights include working on customer satisfaction analytics, supply chain optimization, and developing advanced forecasting models."],leonardo:["At Leonardo SpA, I was an R&D System Engineer working on cutting-edge infrared and defense systems. My work involved missile warning coverage, object detection, and multi-target tracking using advanced computer vision.","Leonardo SpA was where I dove deep into defense technology - specifically infrared systems for threat detection. I worked with MATLAB/Simulink on everything from atmospheric transmission modeling to Kalman filtering.","My R&D role at Leonardo involved developing sophisticated defense systems. I worked on 360-degree missile warning coverage, optical flow analysis, and multi-camera positioning systems for threat detection."],skills:["My technical skills span both data science and systems engineering: Python, MATLAB, machine learning, computer vision, and cloud platforms like Azure. I also have experience with Power BI and various analytics tools.","I work with a diverse tech stack including Python for data science, MATLAB for system modeling, and cloud platforms like Azure ML. My experience covers everything from statistical analysis to computer vision.","My expertise includes programming in Python and MATLAB, machine learning with PyTorch and scikit-learn, cloud computing with Azure, and business intelligence with Power BI. I enjoy working across the full technology stack."],football:["Football is one of my biggest passions! I love both playing recreationally with friends and following professional leagues. It's taught me valuable lessons about teamwork, strategy, and maintaining physical fitness.","I've been passionate about football since I was young. Whether I'm playing a casual game or watching the professionals, I love the combination of physical skill, tactical thinking, and team dynamics.","Football keeps me active and helps me unwind from technical work. There's something special about the sport's blend of individual skill and team strategy that I find really engaging."],travel:["I've been fortunate to travel to 14 countries across 4 continents - from the tech innovation in Japan and Australia to the rich cultures of Morocco and Vietnam. Each destination has broadened my perspective.","My travel experiences have taken me everywhere from the ancient cultures of Egypt to the modern efficiency of Germany. Visiting places like Japan, Maldives, and various European countries has given me a global mindset.","Traveling has been incredibly enriching - whether exploring the technological landscapes of Australia and Japan or the cultural heritage of Morocco and Egypt. Each country teaches you something new about approaching challenges."]};function Qo(o){const e=o.toLowerCase(),t=M();let i="";if(t.os==="iOS"&&t.name==="Safari"?i="[iOS Safari compatibility mode] ":t.isMobile&&t.name==="Chrome"?i="[Chrome mobile optimized] ":t.isMobile&&(i=`[${t.name} mobile mode] `),e.includes("deloitte")){const n=q.deloitte;return i+n[Math.floor(Math.random()*n.length)]}else if(e.includes("leonardo")){const n=q.leonardo;return i+n[Math.floor(Math.random()*n.length)]}else if(e.includes("skill")||e.includes("technology")){const n=q.skills;return i+n[Math.floor(Math.random()*n.length)]}else if(e.includes("football")||e.includes("soccer")){const n=q.football;return i+n[Math.floor(Math.random()*n.length)]}else if(e.includes("travel")||e.includes("country")||e.includes("visit")){const n=q.travel;return i+n[Math.floor(Math.random()*n.length)]}else return e.includes("experience")||e.includes("work")?i+"I have experience in both Data Science consulting at Deloitte and R&D System Engineering at Leonardo SpA. I've worked on projects ranging from business analytics and machine learning to infrared defense systems and computer vision.":e.includes("reading")||e.includes("book")?i+"I'm an avid reader who enjoys both technical literature and business books. Reading helps me stay current with industry trends and broaden my perspective beyond just technical topics.":e.includes("hobby")||e.includes("personal")||e.includes("interest")?i+"My main hobbies are football, traveling, and reading. These interests have shaped me both personally and professionally - football taught me teamwork, travel gave me cultural awareness, and reading keeps me intellectually curious.":e.includes("culture")||e.includes("international")?i+"My international travel experiences have given me a global perspective that's valuable in today's interconnected world. I've experienced everything from the tech innovation in Japan to the rich history of Morocco.":i+"I'm a professional with diverse experience in data science consulting and R&D engineering. Feel free to ask about my work at Deloitte, Leonardo SpA, my technical skills, my hobbies, or my travel experiences!"}function Yo(o){b=o}function De(o){return F[o]||{status:"not_started",progress:0,speed:0,bytesDownloaded:0,totalBytes:0,timeRemaining:0,userRequested:!1}}function Je(o){return Ve.has(o)}function Ho(o){console.log(`👤 User explicitly requested ${o}`),Ve.add(o)}function Vo(o){return F[o]?.userRequested===!0}function Xe(o,e){const t=e.loaded||0,i=e.total||1.8*1024*1024*1024,n=e.progress||t/i,a=Date.now(),s=F[o];let c=0,l=0;if(s&&s.bytesDownloaded>0){const h=a-s.lastUpdate,p=t-s.bytesDownloaded;if(h>0){c=p*1e3/h;const g=i-t;l=c>0?g/c:0}}const r=n>=.99,d=F[o]?.userRequested||!1;F[o]={status:r?"completed":"downloading",progress:n,speed:c/(1024*1024),bytesDownloaded:t,totalBytes:i,timeRemaining:l,userRequested:d,lastUpdate:a},r&&(console.log(`✅ ${o} download completed!`),typeof window<"u"&&(window.aiModels=window.aiModels||{},window.aiModels[o]=!0),E[o]="completed")}function Jo(o,e=!1){console.log(`🚀 Initializing download state for ${o} (user requested: ${e})`),F[o]={status:"downloading",progress:0,speed:0,bytesDownloaded:0,totalBytes:1.8*1024*1024*1024,timeRemaining:0,userRequested:e,lastUpdate:Date.now()}}async function Xo(){if(!x){console.log("🔧 Loading Transformers.js before starting background loading...");try{x=await xo(()=>import("https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.7.1"),[]),console.log("✅ Transformers.js loaded for background loading"),x.env&&(x.env.allowRemoteModels=!0,x.env.allowLocalModels=!1,x.env.useBrowserCache=!0)}catch(t){console.error("❌ Failed to load transformers for background loading:",t);return}}console.log("🚀 Starting intelligent background model preloading...");const o=Wo();console.log(`🎯 Device analysis: Best model is ${o}`);const e=[];o==="phi3"?(console.log("🧠 High-end device detected: Checking consent for large models"),oe("phi3")?(console.log("✅ Phi-3 previously approved, preloading..."),e.push(B("phi3").then(t=>(console.log(t?"✅ Phi-3 preloaded!":"❌ Phi-3 failed, will fallback"),t)))):console.log("⏳ Phi-3 requires user consent, skipping background load"),oe("qwen")?(console.log("✅ Qwen previously approved, preloading as backup..."),setTimeout(()=>{e.push(B("qwen").then(t=>(console.log(t?"✅ Qwen backup preloaded!":"⚠️ Qwen backup failed"),t)))},5e3)):console.log("⏳ Qwen requires user consent, skipping background load"),setTimeout(()=>{e.push(B("distilbert").then(t=>(console.log(t?"✅ DistilBERT backup preloaded!":"⚠️ DistilBERT backup failed"),t)))},2e3)):o==="qwen"?(console.log("💬 Mid-range device detected: Checking consent for Qwen"),oe("qwen")?(console.log("✅ Qwen previously approved, preloading..."),e.push(B("qwen").then(t=>(console.log(t?"✅ Qwen preloaded!":"❌ Qwen failed, will fallback"),t)))):console.log("⏳ Qwen requires user consent, skipping background load"),e.push(B("distilbert").then(t=>(console.log(t?"✅ DistilBERT preloaded!":"❌ DistilBERT failed"),t)))):(console.log("📱 Low-end/mobile device detected: Loading DistilBERT only"),e.push(B("distilbert").then(t=>(console.log(t?"✅ DistilBERT preloaded!":"❌ DistilBERT failed"),t)))),console.log(`💡 Background loading started. User can manually switch to ${o} when ready.`)}class Zo{warningShown=new Set;currentModal=null;shouldShowWarning(e={showOnce:!0,storageKey:"compatibility_warning_shown",autoShow:!0}){const t=U();return t.level==="excellent"||e.showOnce&&localStorage.getItem(e.storageKey)==="true"?!1:e.autoShow&&(t.level==="poor"||t.warnings.length>0)}createCompatibilityWarningDialog(){const e=M(),t=U(),i=document.createElement("div");return i.className="compatibility-warning-overlay",i.innerHTML=`
      <div class="compatibility-warning-modal">
        <div class="warning-header">
          <h2 class="warning-title">
            ${this.getWarningIcon(t.level)} Browser Compatibility Information
          </h2>
          <button class="warning-close" aria-label="Close">&times;</button>
        </div>
        
        <div class="warning-body">
          <div class="browser-info">
            <h3>🌐 Your Browser: ${e.name} ${e.version}</h3>
            <p>Platform: ${e.os} ${e.osVersion} (${e.isDesktop?"Desktop":e.isTablet?"Tablet":"Mobile"})</p>
          </div>
          
          <div class="compatibility-status ${t.level}">
            <h3>${this.getCompatibilityTitle(t.level)}</h3>
            <p>${t.message}</p>
          </div>
          
          <div class="ai-support-matrix">
            <h4>🤖 AI Model Support:</h4>
            <div class="model-support-grid">
              <div class="model-item ${t.aiSupport.distilbert?"supported":"unsupported"}">
                <span class="model-name">🚀 DistilBERT Q&A</span>
                <span class="model-status">${t.aiSupport.distilbert?"✅ Supported":"❌ Unsupported"}</span>
              </div>
              <div class="model-item ${t.aiSupport.qwen?"supported":"unsupported"}">
                <span class="model-name">💬 Qwen Chat</span>
                <span class="model-status">${t.aiSupport.qwen?"✅ Supported":"❌ Unsupported"}</span>
              </div>
              <div class="model-item ${t.aiSupport.phi3?"supported":"unsupported"}">
                <span class="model-name">🧠 Phi-3 Advanced</span>
                <span class="model-status">${t.aiSupport.phi3?"✅ Supported":"❌ Unsupported"}</span>
              </div>
            </div>
            
            <div class="recommended-model">
              <p><strong>💡 Recommended:</strong> ${this.getModelDisplayName(t.recommendedModel)}</p>
              ${t.aiSupport[t.recommendedModel]?"":'<p class="fallback-notice"><em>Note: This will use pre-written responses as live AI processing is not supported on your browser.</em></p>'}
            </div>
          </div>
          
          ${t.warnings.length>0?`
            <div class="warnings-section">
              <h4>⚠️ Important Notes:</h4>
              <ul>
                ${t.warnings.map(n=>`<li>${n}</li>`).join("")}
              </ul>
            </div>
          `:""}
          
          ${t.suggestions.length>0?`
            <div class="suggestions-section">
              <h4>💡 Suggestions:</h4>
              <ul>
                ${t.suggestions.map(n=>`<li>${n}</li>`).join("")}
              </ul>
            </div>
          `:""}
        </div>
        
        <div class="warning-footer">
          <div class="dont-show-again">
            <label>
              <input type="checkbox" id="dont-show-again-checkbox">
              Don't show this again
            </label>
          </div>
          <div class="warning-actions">
            <button class="btn-understand primary">I Understand</button>
          </div>
        </div>
      </div>
    `,i}showCompatibilityWarning(e={showOnce:!0,storageKey:"compatibility_warning_shown",autoShow:!0}){return new Promise(t=>{this.currentModal&&(document.body.removeChild(this.currentModal),this.currentModal=null);const i=this.createCompatibilityWarningDialog();this.currentModal=i,document.body.appendChild(i),i.querySelector("button")?.focus();const a=()=>{i.querySelector("#dont-show-again-checkbox")?.checked&&e.showOnce&&localStorage.setItem(e.storageKey,"true"),document.body.contains(i)&&document.body.removeChild(i),this.currentModal=null,t()};i.querySelector(".warning-close")?.addEventListener("click",a),i.querySelector(".btn-understand")?.addEventListener("click",a);const s=c=>{c.key==="Escape"&&(a(),document.removeEventListener("keydown",s))};document.addEventListener("keydown",s),i.addEventListener("click",c=>{c.target===i&&a()})})}getWarningIcon(e){switch(e){case"excellent":return"✅";case"good":return"👍";case"limited":return"⚠️";case"poor":return"⛔";default:return"ℹ️"}}getCompatibilityTitle(e){switch(e){case"excellent":return"✨ Excellent Compatibility";case"good":return"👍 Good Compatibility";case"limited":return"⚠️ Limited Compatibility";case"poor":return"⛔ Poor Compatibility";default:return"ℹ️ Compatibility Information"}}getModelDisplayName(e){switch(e){case"distilbert":return"🚀 DistilBERT Q&A (65MB) - Fast responses";case"qwen":return"💬 Qwen Chat (500MB) - Conversational AI";case"phi3":return"🧠 Phi-3 Advanced (1.8GB) - Premium experience";default:return e}}static checkModelCompatibility(e){const t=U(),i=M();switch(e){case"distilbert":return{compatible:t.aiSupport.distilbert};case"qwen":return{compatible:t.aiSupport.qwen,reason:t.aiSupport.qwen?void 0:i.os==="iOS"?"iOS compatibility limitations":"Insufficient resources"};case"phi3":return{compatible:t.aiSupport.phi3,reason:t.aiSupport.phi3?void 0:i.isMobile?"Mobile devices not supported":"Requires desktop browser"};default:return{compatible:!1,reason:"Unknown model"}}}createCompatibilityIndicator(){const e=U(),t=M(),i=document.createElement("div");return i.className=`compatibility-indicator ${e.level}`,i.innerHTML=`
      <span class="indicator-icon">${this.getWarningIcon(e.level)}</span>
      <span class="indicator-text">${t.name} ${e.level}</span>
    `,i.title=e.message,i.addEventListener("click",()=>{this.showCompatibilityWarning({showOnce:!1,storageKey:"temp",autoShow:!0})}),i}}const Be=new Zo;class Ko{state={isActive:!1,currentState:"input",currentResponse:""};messageArea=null;statusBar=null;modelSelector=null;inputArea=null;responseArea=null;textInput=null;closeButton=null;constructor(){this.initialize()}initialize(){if(this.statusBar=document.getElementById("status-bar"),!this.statusBar){console.error("Status bar not found");return}this.createMessageArea()}createMessageArea(){this.messageArea=document.createElement("div"),this.messageArea.id="gameboy-message-area",this.messageArea.style.cssText=`
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      color: #000;
      border: 2px solid #0a0a0a;
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 14px;
      height: 0;
      overflow: hidden;
      transition: height 0.3s ease-in-out;
      z-index: 100;
      display: none;
    `,this.modelSelector=document.createElement("select"),this.modelSelector.id="conversation-model-selector",this.modelSelector.style.cssText=`
      position: absolute;
      top: 8px;
      left: 8px;
      background: #f0f0f0;
      color: #000;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 2px 4px;
      font-size: 10px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s ease;
    `,this.updateModelSelector(),this.closeButton=document.createElement("button"),this.closeButton.id="conversation-close-button",this.closeButton.textContent="✕",this.closeButton.style.cssText=`
      position: absolute;
      top: 8px;
      right: 8px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 120;
    `,this.inputArea=document.createElement("div"),this.inputArea.id="conversation-input-area",this.inputArea.style.cssText=`
      position: absolute;
      bottom: 8px;
      left: 8px;
      right: 8px;
      height: 40px;
      display: flex;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    `,this.textInput=document.createElement("input"),this.textInput.type="text",this.textInput.placeholder="Ask about my CV and experience...",this.textInput.style.cssText=`
      flex: 1;
      padding: 8px 12px;
      border: 2px solid #333;
      border-radius: 4px;
      background: white;
      color: #000;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      font-weight: bold;
      outline: none;
    `;const e=document.createElement("button");e.textContent="📤",e.style.cssText=`
      margin-left: 8px;
      padding: 8px 12px;
      border: 2px solid #333;
      border-radius: 4px;
      background: #f0f0f0;
      color: #000;
      font-size: 14px;
      cursor: pointer;
      font-weight: bold;
    `,this.responseArea=document.createElement("div"),this.responseArea.id="conversation-response-area",this.responseArea.style.cssText=`
      position: absolute;
      top: 35px;
      left: 8px;
      right: 8px;
      bottom: 60px;
      padding: 8px;
      overflow-y: auto;
      line-height: 1.4;
      opacity: 0;
      transition: opacity 0.3s ease;
      border-bottom: 1px solid #ccc;
    `,this.inputArea.appendChild(this.textInput),this.inputArea.appendChild(e),this.messageArea.appendChild(this.modelSelector),this.messageArea.appendChild(this.closeButton),this.messageArea.appendChild(this.inputArea),this.messageArea.appendChild(this.responseArea),this.statusBar?.parentNode&&this.messageArea&&this.statusBar.parentNode.insertBefore(this.messageArea,this.statusBar),e.addEventListener("click",()=>this.handleSendMessage()),this.textInput.addEventListener("keydown",t=>{t.stopPropagation(),t.key==="Enter"&&(t.preventDefault(),this.handleSendMessage())}),this.modelSelector.addEventListener("change",()=>this.handleModelChange()),this.closeButton.addEventListener("click",()=>this.hideConversation()),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.state.isActive&&this.hideConversation()})}async showConversation(){if(!this.messageArea)return;if(Be.shouldShowWarning())try{await Be.showCompatibilityWarning()}catch(t){console.log("Compatibility warning skipped or closed:",t)}this.state.isActive=!0,this.state.currentState="input",this.messageArea.style.display="block",this.messageArea.style.height="150px",this.updateModelSelector(),this.modelSelector&&(this.modelSelector.style.opacity="1"),this.closeButton&&(this.closeButton.style.opacity="1"),this.inputArea&&(this.inputArea.style.opacity="1"),this.textInput&&this.textInput.focus();const e=document.getElementById("status-text");e&&(e.style.opacity="0")}hideConversation(){if(!this.messageArea)return;this.state.isActive=!1,this.modelSelector&&(this.modelSelector.style.opacity="0"),this.closeButton&&(this.closeButton.style.opacity="0"),this.inputArea&&(this.inputArea.style.opacity="0"),this.responseArea&&(this.responseArea.style.opacity="0"),this.textInput&&(this.textInput.value=""),this.responseArea&&(this.responseArea.textContent=""),this.messageArea.style.height="0",setTimeout(()=>{this.messageArea&&(this.messageArea.style.display="none")},300);const e=document.getElementById("status-text");e&&(e.style.opacity="1")}isConversationActive(){return this.state.isActive}async handleSendMessage(){if(!this.textInput||!this.textInput.value.trim())return;const e=this.textInput.value.trim();this.textInput.value="",this.state.currentState="loading",this.showLoadingState();try{const t=await Go(e);this.showResponse(t)}catch(t){console.error("Error getting AI response:",t),this.showResponse("Sorry, I had trouble processing your question. Please try again.")}}showLoadingState(){!this.inputArea||!this.responseArea||(this.textInput&&(this.textInput.disabled=!0,this.textInput.placeholder="Thinking..."),this.responseArea.style.opacity="1",this.responseArea.textContent="Thinking...",this.state.currentState="loading")}showResponse(e){this.responseArea&&(this.state.currentResponse=e,this.responseArea.textContent=e,this.state.currentState="response",this.textInput&&(this.textInput.disabled=!1,this.textInput.placeholder="Ask about my CV and experience...",this.textInput.focus()),this.responseArea&&(this.responseArea.style.opacity="1"),this.inputArea&&(this.inputArea.style.opacity="1"))}handleSpaceInConversation(){}updateModelSelector(){if(!this.modelSelector)return;const e=U(),t=M(),i=[{key:"distilbert",icon:"🚀",name:"DistilBERT Q&A",size:"65MB",description:"Fast responses"},{key:"qwen",icon:"💬",name:"Qwen Chat",size:"500MB",description:"Conversational AI"},{key:"phi3",icon:"🧠",name:"Phi-3 Advanced",size:"1.8GB",description:"Premium experience"}];this.modelSelector.value=ne(),this.modelSelector.innerHTML=i.map(s=>{const c=e.aiSupport[s.key],l=e.recommendedModel===s.key;let r="",d="";return c?(r=l?" - Recommended":"",d=`${s.icon} ${s.name} (${s.size}) - ${s.description}${r}`):(s.key==="phi3"?r=" - Desktop only":s.key==="qwen"&&t.os==="iOS"?r=" - Not available on iOS":s.key==="distilbert"&&t.os==="iOS"&&t.name==="Safari"?r=" - Safari not supported":r=" - Not available",d=`${s.icon} ${s.name} (${s.size})${r}`),`<option value="${s.key}" ${c?"":'disabled style="color: #666; background: #f0f0f0;"'}>
        ${d}
      </option>`}).join("");const n=ne();if(e.aiSupport[n]&&this.modelSelector.querySelector(`option[value="${n}"]:not([disabled])`))this.modelSelector.value=n;else if(this.modelSelector.querySelector(`option[value="${e.recommendedModel}"]:not([disabled])`))this.modelSelector.value=e.recommendedModel,ee(e.recommendedModel);else{const c=this.modelSelector.querySelector("option:not([disabled])");if(c){const l=c.value;this.modelSelector.value=l,ee(l)}}t.isMobile&&(this.modelSelector.style.fontSize="16px",this.modelSelector.style.userSelect="none",this.modelSelector.style.webkitUserSelect="none",this.modelSelector.style.minHeight="44px",this.modelSelector.style.padding="12px 8px",this.modelSelector.style.borderRadius="8px",this.modelSelector.style.border="2px solid #333",this.modelSelector.style.background="white",this.modelSelector.style.color="#000",this.modelSelector.style.zIndex="110",this.modelSelector.style.position="relative")}async handleModelChange(){if(!this.modelSelector)return;const e=this.modelSelector.value;console.log(`🔄 Switching to ${e} model...`);const t={distilbert:"DistilBERT Q&A",qwen:"Qwen Chat",phi3:"Phi-3 Advanced"};if(e==="phi3"){const i=De("phi3"),n=oe("phi3"),a=Vo("phi3");if(console.log("🔍 Phi-3 switch check:",{userApproved:n,userRequestedDownload:a,downloadStatus:i.status,progress:i.progress}),n&&a&&i.status==="downloading"){console.log("📊 User requested and approved - showing progress for active download"),this.showDownloadProgress(e,t[e]);return}console.log("🚀 First time or background only - will show consent dialog")}this.responseArea&&(this.responseArea.style.opacity="1",this.responseArea.textContent=`Switching to ${t[e]||e}...`);try{await ee(e)?(this.responseArea&&(this.responseArea.textContent=`✅ Switched to ${t[e]||e}!`),setTimeout(()=>{this.responseArea&&(this.responseArea.style.opacity="0"),this.inputArea&&(this.inputArea.style.opacity="1")},1e3)):(this.responseArea&&(this.responseArea.textContent=`❌ Failed to switch to ${e}. Try again later.`),this.modelSelector.value=ne())}catch(i){console.error("Error switching model:",i),this.responseArea&&(this.responseArea.textContent="❌ Error switching models. Try again later.")}}showDownloadProgress(e,t){if(!this.responseArea)return;console.log(`📊 Showing download progress UI for ${e}`),this.responseArea.style.opacity="1",this.responseArea.innerHTML=`
      <div style="text-align: center; padding: 15px;">
        <div style="margin-bottom: 10px;">
          <strong>🧠 ${t} is downloading...</strong>
        </div>
        
        <div style="background: #f0f0f0; border-radius: 10px; height: 8px; margin: 10px 0; overflow: hidden;">
          <div id="conv-progress-bar" style="background: linear-gradient(90deg, #007bff, #0056b3); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
        </div>
        
        <div style="display: flex; justify-content: space-between; font-size: 11px; color: #666; margin-bottom: 10px;">
          <span id="conv-progress-percent">0%</span>
          <span id="conv-download-speed">Calculating...</span>
          <span id="conv-time-remaining">Estimating...</span>
        </div>
        
        <div style="font-size: 10px; color: #888;">
          💡 You can continue chatting with other models while this downloads
        </div>
      </div>
    `;const i=setInterval(()=>{const n=De(e),a=this.responseArea?.querySelector("#conv-progress-bar"),s=this.responseArea?.querySelector("#conv-progress-percent"),c=this.responseArea?.querySelector("#conv-download-speed"),l=this.responseArea?.querySelector("#conv-time-remaining");if(!a||!this.responseArea){console.log(`❌ Progress elements not found, clearing interval for ${e}`),clearInterval(i);return}console.log("📊 Updating progress UI:",{modelKey:e,status:n.status,progress:n.progress,speed:n.speed});const r=Math.round(n.progress*100);a.style.width=`${r}%`,s.textContent=`${r}%`,n.speed>0?c.textContent=`${n.speed.toFixed(1)} MB/s`:c.textContent="Calculating...",n.timeRemaining>60?l.textContent=`${Math.round(n.timeRemaining/60)}m left`:n.timeRemaining>0?l.textContent=`${Math.round(n.timeRemaining)}s left`:l.textContent="Estimating...",n.status==="completed"&&(clearInterval(i),this.responseArea&&(this.responseArea.innerHTML=`
            <div style="text-align: center; padding: 15px; color: #28a745;">
              ✅ <strong>${t} ready!</strong><br>
              <span style="font-size: 11px;">Switching to advanced AI model...</span>
            </div>
          `),setTimeout(async()=>{try{await ee(e),this.responseArea&&(this.responseArea.style.opacity="0"),this.inputArea&&(this.inputArea.style.opacity="1")}catch(d){console.error("Failed to switch to completed model:",d)}},2e3))},1e3)}}const L=new Ko;let D={},ue=null,te=null,ie=null;const en=200;function tn(){document.addEventListener("keydown",an),document.addEventListener("keyup",sn),on()}function on(){te=document.createElement("div"),te.id="door-message",te.style.cssText=`
    position: fixed;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    font-family: Arial, sans-serif;
    font-size: 16px;
    display: none;
    z-index: 1000;
    border: 2px solid #fff;
    text-align: center;
    max-width: 300px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
  `,document.body.appendChild(te)}function nn(o){ye(o,5e3),ue=o}function Ze(){const o=document.getElementById("status-text");o&&o.textContent===ue&&(o.textContent=""),ue=null}function an(o){if(o.key==="Escape"&&L.isConversationActive()){L.hideConversation(),o.preventDefault();return}const e=document.activeElement;if(e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA"))return;let t=null;switch(o.key){case"ArrowUp":case"w":case"W":t="up";break;case"ArrowDown":case"s":case"S":t="down";break;case"ArrowLeft":case"a":case"A":t="left";break;case"ArrowRight":case"d":case"D":t="right";break;case" ":if(!D[" "]){if(console.log("Action button pressed!"),yo()&&!L.isConversationActive())console.log("Starting GameBoy-style boss conversation!"),L.showConversation();else if(!L.isConversationActive()){const i=Fe(u.x,u.y);i?(console.log(`Attempting to enter door to ${i.targetRoom}`),nt()&&(console.log("Successfully entered new room!"),Ze())):console.log("No door here to interact with.")}D[o.key]=!0}o.preventDefault();return}t&&!D[o.key]&&(D[o.key]=!0,ln(t)),o.preventDefault()}function sn(o){const e=document.activeElement;if(!(e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA"))&&(D[o.key]=!1,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d","W","A","S","D"].includes(o.key)&&!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d","W","A","S","D"].some(n=>D[n]))){he(),u.animationState="idle";const n=u.direction==="left"?"right":u.direction;u.currentAnimation=y[`${n}_idle`],u.frameIndex=0,u.animationTimer=0,Ke()}}function ln(o){he(),_e(o),ie=window.setInterval(()=>{({up:["ArrowUp","w","W"],down:["ArrowDown","s","S"],left:["ArrowLeft","a","A"],right:["ArrowRight","d","D"]})[o].some(n=>D[n])?_e(o):he()},en)}function he(){ie&&(clearInterval(ie),ie=null)}function _e(o){const e=ae(),t=e.map[0].length,i=e.map.length;if(o!==u.direction){u.direction=o,u.animationState="idle";const a=u.direction==="left"?"right":u.direction;u.currentAnimation=y[`${a}_idle`],u.frameIndex=0,u.animationTimer=0}else{let a=u.x,s=u.y;if(o==="up"?s--:o==="down"?s++:o==="left"?a--:o==="right"&&a++,a>=0&&a<t&&s>=0&&s<i){const c=e.map[s][a];it.includes(c)?(u.x=a,u.y=s,u.animationState="walk",setTimeout(()=>Ke(),100)):(u.animationState="idle",console.log(`Cannot walk on tile type ${c} at (${a}, ${s})`))}else u.animationState="idle",console.log("Cannot move outside map boundaries")}const n=u.direction==="left"?"right":u.direction;u.currentAnimation=y[`${n}_${u.animationState}`],u.frameIndex=0,u.animationTimer=0}function Ke(){const o=Fe(u.x,u.y);o&&o.description?nn(o.description):Ze()}function rn(){const o={"btn-up":"ArrowUp","btn-down":"ArrowDown","btn-left":"ArrowLeft","btn-right":"ArrowRight","btn-action":" "};for(const[e,t]of Object.entries(o)){const i=document.getElementById(e);i&&(i.addEventListener("touchstart",n=>{n.preventDefault(),Le(t)},{passive:!1}),i.addEventListener("touchend",n=>{n.preventDefault(),de(t)},{passive:!1}),i.addEventListener("mousedown",n=>{n.preventDefault(),Le(t)}),i.addEventListener("mouseup",n=>{n.preventDefault(),de(t)}),i.addEventListener("mouseleave",n=>{n.preventDefault(),de(t)}),i.addEventListener("contextmenu",n=>{n.preventDefault()}))}}function Le(o){const e=new KeyboardEvent("keydown",{key:o,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}function de(o){const e=new KeyboardEvent("keyup",{key:o,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}let $=!1,R=!1;function ve(){return window.innerWidth>768&&window.matchMedia("(pointer: fine)").matches}function cn(){if(!ve()){console.log("🖥️ Mobile device detected - skipping desktop controls initialization");return}console.log("🖥️ Desktop device detected - initializing enhanced controls"),dn(),fn(),setTimeout(()=>{un()},1500)}function dn(){const o=document.getElementById("controls-toggle"),e=document.getElementById("controls-area"),t=document.querySelector("#gameboy-container");if(!o||!e){console.warn("Controls toggle elements not found");return}Ue(o),o.addEventListener("click",()=>{$=!$,$?(e.classList.add("controls-visible"),t?.classList.add("controls-visible")):(e.classList.remove("controls-visible"),t?.classList.remove("controls-visible")),Ue(o),console.log(`🎮 Controls ${$?"shown":"hidden"}`)})}function Ue(o){$?(o.textContent="🎮 Hide Controls",o.setAttribute("title","Hide touch controls to maximize screen space")):(o.textContent="📱 Show Controls",o.setAttribute("title","Show touch controls for testing or convenience"))}function fn(){const o=document.getElementById("initial-instructions");if(!o){console.warn("Initial instructions element not found");return}o.addEventListener("click",e=>{e.stopPropagation(),j()}),document.addEventListener("click",()=>{R&&j()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&R&&j()}),document.addEventListener("keydown",e=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d","W","A","S","D"].includes(e.key)&&R&&setTimeout(()=>j(),500)})}function un(){if(!ve()||R)return;const o=document.getElementById("initial-instructions");o&&(R=!0,o.classList.add("show"),console.log("📖 Showing initial keyboard instructions"),setTimeout(()=>{R&&j()},8e3))}function j(){const o=document.getElementById("initial-instructions");!o||!R||(o.classList.remove("show"),R=!1,console.log("📖 Hidden initial instructions"))}window.addEventListener("resize",()=>{!ve()&&$&&document.getElementById("controls-area")?.classList.add("controls-visible")});const hn=[{x:5,y:1,direction:"north",targetRoom:"room2",roomName:"Boss Room",description:"Meet the person behind this experience!",icon:"👤"},{x:1,y:4,direction:"west",targetRoom:"room3",roomName:"Work Experience",description:"Explore professional journey and key accomplishments",icon:"💼"},{x:9,y:4,direction:"east",targetRoom:"room4",roomName:"My Hobbies",description:"Discover passions: Reading, Football, and Traveling!",icon:"🎯"}];class pn{signals=new Map;animationTime=0;playerProximityDistance=2;constructor(){this.initializeSignals()}initializeSignals(){hn.forEach(e=>{const t=`${e.x}_${e.y}`;this.signals.set(t,{signal:e,animationPhase:Math.random(),isVisible:!0,pulseIntensity:0})})}update(e,t,i,n){n==="room1"&&(this.animationTime+=e,this.signals.forEach((a,s)=>{a.animationPhase=(this.animationTime*.002+Math.random()*.1)%1;const c=Math.abs(a.signal.x-t),l=Math.abs(a.signal.y-i),r=Math.max(c,l);if(r<=this.playerProximityDistance){a.hoverStartTime||(a.hoverStartTime=this.animationTime);const d=Math.max(0,(this.playerProximityDistance-r)/this.playerProximityDistance);a.pulseIntensity=Math.min(1,d*1.5)}else a.hoverStartTime=void 0,a.pulseIntensity=Math.max(0,a.pulseIntensity-e*.003)}))}getNearestSignal(e,t,i){if(i!=="room1")return null;let n=null,a=this.playerProximityDistance+1;return this.signals.forEach(s=>{const c=Math.abs(s.signal.x-e),l=Math.abs(s.signal.y-t),r=Math.max(c,l);r<=this.playerProximityDistance&&r<a&&(a=r,n=s.signal)}),n}render(e,t,i){i==="room1"&&(e.save(),this.signals.forEach(n=>{if(!n.isVisible)return;const{signal:a}=n,s=a.x*t,c=a.y*t,l=s+t/2,r=c+t/2;this.renderSignalGlow(e,l,r,n),this.renderDirectionalArrow(e,l,r,a.direction,n),this.renderRoomIcon(e,l,r-8,a.icon,n),n.pulseIntensity>.3&&this.renderTooltip(e,l,r-32,a,n)}),e.restore())}renderSignalGlow(e,t,i,n){const c=16+Math.sin(n.animationPhase*Math.PI*2)*4+n.pulseIntensity*8,l=e.createRadialGradient(t,i,0,t,i,c);l.addColorStop(0,`rgba(139, 172, 15, ${.3+n.pulseIntensity*.4})`),l.addColorStop(.5,`rgba(139, 172, 15, ${.1+n.pulseIntensity*.2})`),l.addColorStop(1,"rgba(139, 172, 15, 0)"),e.fillStyle=l,e.beginPath(),e.arc(t,i,c,0,Math.PI*2),e.fill()}renderDirectionalArrow(e,t,i,n,a){const s=12+a.pulseIntensity*4,c=Math.sin(a.animationPhase*Math.PI*2)*3;switch(e.fillStyle="#0f380f",e.strokeStyle="#8bac0f",e.lineWidth=2,e.save(),e.translate(t,i),n){case"north":e.rotate(0);break;case"east":e.rotate(Math.PI/2);break;case"south":e.rotate(Math.PI);break;case"west":e.rotate(-Math.PI/2);break}e.translate(0,c),e.beginPath(),e.moveTo(0,-s),e.lineTo(-s*.6,s*.3),e.lineTo(0,0),e.lineTo(s*.6,s*.3),e.closePath(),e.fill(),e.stroke(),e.restore()}renderRoomIcon(e,t,i,n,a){const s=16+a.pulseIntensity*4,c=Math.sin(a.animationPhase*Math.PI*4)*2;e.save(),e.font=`${s}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillStyle="rgba(0, 0, 0, 0.3)",e.fillText(n,t+1,i+c+1),e.fillStyle="#0f380f",e.fillText(n,t,i+c),e.restore()}renderTooltip(e,t,i,n,a){const s=Math.min(1,a.pulseIntensity*2),c=n.roomName,d=e.measureText(c).width+8*2,h=24,p=t-d/2,g=i-h-4;e.fillStyle=`rgba(155, 188, 15, ${s*.9})`,e.strokeStyle=`rgba(15, 56, 15, ${s})`,e.lineWidth=2,e.fillRect(p,g,d,h),e.strokeRect(p,g,d,h),e.fillStyle=`rgba(15, 56, 15, ${s})`,e.font='bold 12px "Courier New", monospace',e.textAlign="center",e.textBaseline="middle",e.fillText(c,t,g+h/2)}getSignalAt(e,t){const i=`${e}_${t}`,n=this.signals.get(i);return n?n.signal:null}getSignalsForRoom(e){return e!=="room1"?[]:Array.from(this.signals.values()).map(t=>t.signal)}}const pe=new pn,gn=Array(We).fill(null).map(()=>Array(Oe).fill(0)),{canvas:V,ctx:ge,TILE_SIZE:mn,GAME_WIDTH:Q,GAME_HEIGHT:Y}=at(gn);if(!V)throw console.error("Canvas element not found! Make sure there's a canvas with id='gameCanvas'"),new Error("Canvas not found");if(!ge)throw console.error("Could not get 2D context from canvas"),new Error("Canvas context not available");V.width=Q;V.height=Y;console.log(`Canvas initialized: ${Q}x${Y} (${Oe}x${We} tiles)`);Ne(V);window.addEventListener("resize",()=>Ne(V));Yo((o,e,t)=>{console.log(`🔄 Background loading ${o}: ${e} ${t?`(${t}MB)`:""}`),e==="completed"&&console.log(`⚡ ${o} model ready for instant switching!`)});let $e=0,me=!1;function yn(){me||(me=!0,console.log("Game started!"),requestAnimationFrame(et))}function et(o){if(!me)return;const e=(o-$e)/1e3;$e=o,lt(e);const t=ae();pe.update(e,u.x,u.y,t.id);const i=pe.getNearestSignal(u.x,u.y,t.id);i&&ye(`${i.icon} ${i.roomName} - ${i.description}`,100),L.isConversationActive()||go(),ge&&bn(ge,mn),requestAnimationFrame(et)}function bn(o,e){o.clearRect(0,0,Q,Y);const t=ze(),i=ae(),n=i.map;if(!t.grass){o.fillStyle="#333",o.fillRect(0,0,Q,Y),o.fillStyle="#fff",o.font="20px Arial",o.textAlign="center",o.fillText("Loading assets...",Q/2,Y/2);return}for(let a=0;a<n.length;a++)for(let s=0;s<n[0].length;s++){const c=n[a][s];let l=null;switch(c){case 0:l=t.grass;break;case 1:l=t.oak_tree;break;case 2:case 3:case 4:case 5:l=t.path;break;case 6:l=t.door;break;case 7:l=t.library_floor;break;case 8:l=t.library_bsA||t.library_bsB||t.library_bsC;break;case 9:l=t.football_center||t.football_0;break;case 10:l=t.flag_it||t.flag_fr||t.flag_de||t.flag_us;break;case 11:l=t.library_table;break;case 12:l=t.library_chair;break;case 13:l=t.library_rug;break;case 14:l=t.tree_t1||t.tree_t2||t.tree_t3;break;case 15:break;case 16:l=t.football_0;break;case 17:l=t.football_1;break;case 18:l=t.football_2;break;case 19:l=t.football_3;break;case 20:l=t.football_4;break;case 21:l=t.football_5;break;case 22:l=t.football_6;break;case 23:l=t.football_7;break;case 24:l=t.football_8;break;case 25:l=t.football_9;break;case 26:l=t.football_10;break;case 27:l=t.football_11;break;case 28:l=t.world_map;break;case 29:l=t.nps_chart;break;case 30:l=t.energy_cost_chart;break;case 31:l=t.fashion_retail_timeseries;break;case 32:l=t.distribution_network_map;break;case 33:l=t.forecast_histogram;break;case 34:l=t.box_plot;break;case 35:l=t.deloitte_consulting;break;case 36:l=t.powerbi_dashboard_left;break;case 37:l=t.powerbi_dashboard_right;break;case 38:l=t.python_sklearn;break;case 39:l=t.pytorch_langchain;break;case 40:l=t.recommendation_tree;break;case 41:l=t.azure_ml;break;case 42:l=t.azure_data_factory;break;case 43:l=t.chatbot_ai;break;case 44:l=t.gantt_chart;break;case 45:l=t.ir_spectrum;break;case 46:l=t.atmospheric_transmission;break;case 47:l=t.multi_camera_array;break;case 48:l=t.leonardo_spa;break;case 49:l=t.object_detection;break;case 50:l=t.kalman_filter;break;case 51:l=t.optical_flow;break;case 52:l=t.coverage_360;break;case 53:l=t.threat_interface;break;case 54:l=t.multi_target_tracking;break;case 55:l=t.matlab_simulink;break;case 56:l=t.system_architecture;break;case 57:l=t.requirements_specs;break;case 58:l=t.ir_detector;break;case 59:l=t.brick_wall;break;case 60:l=t.flag_au;break;case 61:l=t.flag_us;break;case 62:l=t.flag_jp;break;case 63:l=t.flag_vn;break;case 64:l=t.flag_mv;break;case 65:l=t.flag_it;break;case 66:l=t.flag_fr;break;case 67:l=t.flag_de;break;case 68:l=t.flag_es;break;case 69:l=t.flag_gb;break;case 70:l=t.flag_nl;break;case 71:l=t.flag_ch;break;case 72:l=t.flag_ma;break;case 73:l=t.flag_eg;break;case 74:l=t.main_guy;break;case 75:l=t.flower;break}if(l)o.drawImage(l,s*e,a*e,e,e);else{let r="#90EE90";switch(c){case 0:r="#228B22";break;case 1:r="#8B4513";break;case 6:r="#2C2C2C";break;case 7:r="#D2B48C";break;case 8:r="#8B4513";break;case 9:r="#32CD32";break;case 10:r="#FF6347";break;case 11:r="#A0522D";break;case 12:r="#CD853F";break;case 13:r="#DC143C";break;case 14:r="#654321";break;case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:r="#32CD32";break;case 28:r="#87CEEB";break;case 29:r="#1a202c";break;case 30:r="#ffa500";break;case 31:r="#e91e63";break;case 32:r="#1a202c";break;case 33:r="#3b82f6";break;case 34:r="#06b6d4";break;case 35:r="#86bc25";break;case 36:case 37:r="#f2c811";break;case 38:r="#3776ab";break;case 39:r="#ee4c2c";break;case 40:r="#1a202c";break;case 41:case 42:r="#0078d4";break;case 43:r="#2d3748";break;case 44:r="#1a202c";break;case 45:r="#1a1a1a";break;case 46:r="#1a1a1a";break;case 47:r="#1a1a1a";break;case 48:r="#C8102E";break;case 49:r="#1a1a1a";break;case 50:r="#1a1a1a";break;case 51:r="#1a1a1a";break;case 52:r="#1a1a1a";break;case 53:r="#1a1a1a";break;case 54:r="#1a1a1a";break;case 55:r="#e97627";break;case 56:r="#1a1a1a";break;case 57:r="#1a1a1a";break;case 58:r="#1a1a1a";break;case 59:r="#6e6e6e";break;case 60:r="#012169";break;case 61:r="#b22234";break;case 62:r="#bc002d";break;case 63:r="#da251d";break;case 64:r="#d21034";break;case 65:r="#009246";break;case 66:r="#0055a4";break;case 67:r="#000000";break;case 68:r="#aa151b";break;case 69:r="#012169";break;case 70:r="#21468b";break;case 71:r="#ff0000";break;case 72:r="#c1272d";break;case 73:r="#ce1126";break;case 74:r="#4169e1";break;case 75:r="#ff69b4";break}o.fillStyle=r,o.fillRect(s*e,a*e,e,e)}if((c===1||c===14)&&l){const r=l.naturalHeight||l.height;r>e&&o.drawImage(l,s*e,a*e-(r-e),e,r)}if((c===8||c===28)&&l){const r=l.naturalHeight||l.height;r>e&&o.drawImage(l,s*e,a*e-(r-e),e,r)}if(c===6&&(o.save(),o.globalAlpha=.3,o.fillStyle="#FFD700",o.fillRect(s*e+2,a*e+2,e-4,e-4),o.restore()),c===10&&i.id==="room4"){const r=[t.flag_it,t.flag_fr,t.flag_de,t.flag_us,t.flag_jp,t.flag_au,t.flag_es,t.flag_gb].filter(Boolean);if(r.length>0){const d=(s+a)%r.length,h=r[d];h&&o.drawImage(h,s*e,a*e,e,e)}}}pe.render(o,e,i.id),rt(o,e)}console.log("Loading assets...");be(()=>{console.log("Assets loaded, initializing sprites..."),fo(),console.log("Initializing room system..."),st(),console.log("Initializing boss interaction system..."),ho(),console.log("Setting up input listeners..."),tn(),rn(),console.log("Initializing desktop controls..."),cn(),console.log("🚀 Starting background AI model preloading..."),console.log("🎮 Game will start immediately while models load in background!"),Xo(),console.log("Starting game..."),yn()});
