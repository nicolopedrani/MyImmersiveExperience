(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=o(a);fetch(a.href,n)}})();const P=12,L=9,z=[[0,14,0,1,1,6,1,1,0,14,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[0,1,0,14,0,2,0,14,0,1,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[6,2,2,2,2,2,2,2,2,2,2,6],[0,0,0,0,0,2,0,0,0,0,0,0],[0,1,0,14,0,2,0,14,0,1,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],$=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,1,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,0,2,0,0,1,0,0,2,0,0,0],[0,0,2,0,0,0,0,0,2,0,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,1,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,6,0,0,0,0,0,0]],ee=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,0,2,0,1,0,1,0,2,0,0,0],[0,0,2,0,0,0,0,0,2,0,0,0],[0,0,2,1,0,0,0,1,2,2,2,6],[0,0,2,0,0,0,0,0,2,0,0,0],[0,0,2,0,1,0,1,0,2,0,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],te=[[0,8,8,8,0,10,10,10,0,8,8,0],[0,7,7,7,0,7,7,7,0,7,7,0],[0,7,11,12,2,7,28,7,2,10,10,0],[0,13,7,7,2,2,2,2,2,7,7,0],[6,2,2,16,17,18,19,2,2,2,2,0],[0,2,2,20,21,22,23,2,10,10,10,0],[0,2,2,24,25,26,27,2,7,7,7,0],[0,2,2,2,2,2,2,2,7,8,7,0],[0,0,0,0,0,0,0,0,0,0,0,0]],F={room1:{id:"room1",name:"Central Hub",map:z,playerStartX:5,playerStartY:7,description:"Welcome! Choose your path to explore different aspects of my profile.",doors:[{x:5,y:0,targetRoom:"room2",targetX:5,targetY:7,description:"Press SPACE to enter the Boss Room"},{x:0,y:4,targetRoom:"room3",targetX:10,targetY:4,description:"Press SPACE to enter the Work Experience Room"},{x:11,y:4,targetRoom:"room4",targetX:1,targetY:4,description:"Press SPACE to enter the Hobbies Room"}]},room2:{id:"room2",name:"Boss Room",map:$,playerStartX:5,playerStartY:7,description:"Face the final challenge - meet the person behind this experience!",doors:[{x:5,y:8,targetRoom:"room1",targetX:5,targetY:1,description:"Press SPACE to return to Central Hub"}]},room3:{id:"room3",name:"Work Experience",map:ee,playerStartX:10,playerStartY:4,description:"Explore my professional journey and key accomplishments.",doors:[{x:11,y:4,targetRoom:"room1",targetX:1,targetY:4,description:"Press SPACE to return to Central Hub"}]},room4:{id:"room4",name:"My Hobbies",map:te,playerStartX:1,playerStartY:4,description:"Discover my passions: Reading, Football, and Traveling the world!",doors:[{x:0,y:4,targetRoom:"room1",targetX:10,targetY:4,description:"Press SPACE to return to Central Hub"}]}},oe=[2,3,4,5,6,7,13,16,17,18,19,20,21,22,23,24,25,26,27],f={down_idle:[],down_walk:[],up_idle:[],up_walk:[],left_idle:[],left_walk:[],right_idle:[],right_walk:[]},r={x:Math.floor(P/2),y:L-2,direction:"down",animationState:"idle",currentAnimation:[],frameIndex:0,animationTimer:0,animationSpeed:.15};r.currentAnimation=f.down_idle;function ae(e){r.animationTimer+=e,r.animationTimer>=r.animationSpeed&&(r.animationTimer=0,r.frameIndex=(r.frameIndex+1)%r.currentAnimation.length)}function ne(e,t){const o=r.currentAnimation[r.frameIndex];if(!o)return;const s=r.x*t,a=r.y*t;if(e.save(),r.direction==="left"){const n=o.width;e.translate(s,a),e.scale(-1,1),e.drawImage(o,-n,0)}else e.drawImage(o,s,a);e.restore()}const re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAB1JREFUOI1jtOv0+M9AAWCiRPOoAaMGjBowmAwAAJhEAi4/QQzBAAAAAElFTkSuQmCC",se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAB1JREFUOI1jfLKs6D8DBYCJEs2jBowaMGrAYDIAAFnyAxuTOlahAAAAAElFTkSuQmCC",ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABQCAYAAACpv3NFAAAAAXNSR0IArs4c6QAABZFJREFUeJztW09PG0cU/zk1ogZFvbBFCjgXDgYipAYJRzKHXCLlGkeIT9EvkAMnH/oJ+iUsFM6VcokESBipiYRi44MPjUGVte6BVmDRWNCDmeXteHa9M/Nm6WF/Esrszuzse7/3Z97MOkCGDBkyZMiQIUOGdFFY8G4LC97tQ8uRczEpVWxw7ufE9eDcz4n+1Z0yAKBZa4COdSFPHPKckwlFhXIA0Kw1qLJj/fS6WWvcqghzCbYXCKs2aw1U6xUAQPtkCGBkZVnp0lo+NKa0lkf7ZBga26w1nJPwiGMS6vKrO2XsbR8CuFeyWq8EbXpfvlYR5TpXWLNbWPBuq/VKyHqyggLtk2Fkn2rM3vZh4E1724dOvIGNANcQXgXw5garEEh7GVvdKWN1p8z6XmMCRNITMd8+GQYJzQXk0OLKDSxJUE5y3FDlDi5vsCJAFDF0KXMBOq9YZrneZUQAdX9ayQFwGgrtkyG4E65RNqWlrAouw4GCY2UwXk4oCbSqS0t5OexM6wSrEKACuFwBVOB6rzYBctaVY56biLj5qPVNoeUy8jaWrs3U/blCIek8dNOlGwbGyyBdimRBOfNAlAdweZp20lDFPxcEkSrl6LtU/aZbZy0PUMV/EiQdR5WXyRW5hs5Ft9Gmy6B2CFTrlaD40fGApAVSaS0fzKs6N4g6SzAtibUJ2K/nxg4t4hQzLZPjCJPnqtYrqNYrRiRoETA493P+7kHonhBSJaysvA4JqqQqv4MjERolQWD8YDPuFCiuPykm1QOmlaCWVIUF79bb2oS38m3i2ElhoZs/gGhPsDkuM6oD/NZUaBeoUiaqLogKlUkx76rkNsoB/u4BvK1N5ZgkCVFuJ80RUeu/DbQ9QLiaKgxoQpSVpW48yZqTiBJo1hrwtjbhbW0aL4MspZxOoSOPj2tP2ltEeaEOjFYBkQj91tRIkJik6LemEiXNpJDn81tT8HcPjJOgsQeolJfvcSlP5xHEeyvfgvi3+U5glAPkYkgIKQRU3ZfbUfBbU8pn5Gc5lAcszgRFW45Dan0ZsrdEeYrKk1S47Axx9enIigSjEBCfsGeevwgJM7uUT2xlCurWceMuO/zHbtYfRi47Q/i7B5hdyo/dlxHl3lH9l53h2DxXn46Cf22tD1h+HBWhMPP8RUCAcEv5nkxQFOSxKiI5FBew8gAqhLBWnPJUmaj27FI+0uouwMIiTYoiLyQlQu6nJFJQEjg/j7P/4ICGhUCUQnFjhMKUUBc/kGD5OkwhCxmlfPlxMZTQ6DWdiyvZRcHZD5CiwgIAyo+LAIDGP93QNb2X1k/mnH3IIwosA0ct4F7Rjfnpu65i6JnR/SI+nv6+MnoOAHDqSkbAQQjcYZn8YXDurwzO/RUAePusEBq4MT8dEFKcU4oTmosb3ARMFLS06AWKbsxPRyltPL8uOEMgsWClRQ+Aj27/JmgD0+j2b3TexRIaXB6gZZX2ma9U1sAbrMFBgJYgHz73gvarn+ZTfbcKrpJgLIT122d+6PohYEuAtgWEmx/3rgHce4Sm+1vJQJGaB7xcXm+9e/0UwL2ywvLHveug/e71U7xcXm+lJZcNAUbMj7L+CMW5R4EnHPeuQ31pyAIA35k+CGAu6UBh/faZj7/+vsL7LwNszE/jh5kc3qw/wX7nAgCw37nAj9//izfrT9C9mPn5j/6fv2rI09dVAEg5CXb7N3j/ZRBcU4vflb/o9m/QPvNTCwWbQugUCVxPWP/D5x6Oe9eBosB6q3jmj5Hw0ay8MS6KbHdcxrEnrPv2WQGlRQ+//PaVkKONByMAcLRJ0YBVSfwghdD/CVyHDg/lBdYbIs5Tl7RJYNkNch87pUUC2ymRq3M3V0SwH4+lcfBoS4bTM8HU/7MyJhPiVOEMGTJkyJAhQwaB/wCcF1ybPAOXlAAAAABJRU5ErkJggg==",le="/MyImmersiveExperience/assets/Player-LaRVoEvR.png",ce="/MyImmersiveExperience/assets/assets-k1rCfwam.png",de="data:image/png;base64,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",ge="/MyImmersiveExperience/assets/library-BPiDb9BV.png",fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAUCAYAAABGUvnzAAAC4ElEQVR4nO2av27bMBDGT4UeoIBSIJUrdGszeWqmCMgSDVliBMiUrRmSN/BDCOgDdMmYyUDgLB3UpYA6pROndiwSux3KoXtQZbBPpihS/CPaTm3/FkukSCn++N2d6Hj3ewdFJ88g6KVAaAbdIAFCM8A2WwjNGvs7eXN/E6M4sR7bhtMjv9b2pf+p1iZ6vm5Qb6PDvtbYdz9+6j5iDb8bJEDiBGiewSjOpOLSYV8oOLbzn20E3OAOH53GrpxRnACB6qqTuVkkLj+fCNkCYMfNc5GI3Cjj6uZhbs8xb/xukAAd9ssvtpNnMIoTYUgBqDvZpYP5RTGKE+N5wkEE45M743sDTMLtfnpoNXaefHv72nqsj+Ji7g16KdA8AzJt4wXlnYzn/Kepg2XX64ocDqLasYnQT1XctvhBLwWYuhVdy7aJ3Mqey2nqc8/45K4isq2LV41KIpIVUgjf16aa5V2JqUF1nQzWteEgMg7V++nhSrq4FBjdqBKZxXURxItsMj8rpq17n6q4bGQypRSYr4J5RH0uHaxqd83/XBmbUAnRJuEZYHFibLDHu987KGwHo8CiTRGsfvk+1Q7XqvLq62dvGffVf9sXgCGaSoRmQWFxUSxru3Hd8Nsk8K2LHQAAIJzQLLywuAiI9V3lsCljs4AmVByM1aeu6LP3YPk7L5+ndcaomJd4p0d+Y/HVVHMU17vgHd/KJ/eWEqFnAnvblwAw2zUqfp8pB6u+6KZ+lwWaaC6TVID70lc3D5VjHYrr3dpxo9AL5hl7Eg6itQxtKKapuMj4w3Pwjm8hPP/r/Nna4v379b4AmORTQjMIBxFsXezAn4/f1YO3L6V9Nj8U6CJbhLY5WNfBsr+HdbHMvZ63nBhdhuiJoBFzrAYLJsyr7C9SPNgn+5XKBNcFGitmk3tfvnijnuxc45oF4rfZlKf5xMG8eJS5plwEU9GJQ6F51jG9qHDyHqwjFi80tPh3oA36PAJWG3h2QapYCQAAAABJRU5ErkJggg==",g={};let y=0;const I=8;let w=null;const _={objects:[{name:"Bookshelf_A",code:"bsA",x:120,y:360,width:96,height:120},{name:"Bookshelf_B",code:"bsB",x:240,y:360,width:96,height:120},{name:"Bookshelf_C",code:"bsC",x:360,y:360,width:96,height:120},{name:"table",code:"t",x:336,y:192,width:168,height:96},{name:"world_map",code:"wm",x:120,y:192,width:96,height:120},{name:"chair",code:"c",x:648,y:72,width:48,height:72},{name:"rug",code:"r",x:432,y:0,width:168,height:72}],paths:[{name:"path_walk",code:"pw",x:72,y:192,width:24,height:24}]},me={tilesheet:{columns:4,rows:3,tileWidth:32,tileHeight:32}},U={flags:[{name:"Australia",code:"au",x:0,y:0,width:15,height:10},{name:"United States",code:"us",x:15,y:0,width:15,height:10},{name:"Japan",code:"jp",x:30,y:0,width:15,height:10},{name:"Vietnam",code:"vn",x:45,y:0,width:15,height:10},{name:"Italy",code:"it",x:75,y:0,width:15,height:10},{name:"France",code:"fr",x:90,y:0,width:15,height:10},{name:"Germany",code:"de",x:105,y:0,width:15,height:10},{name:"Spain",code:"es",x:0,y:10,width:15,height:10},{name:"United Kingdom",code:"gb",x:15,y:10,width:15,height:10}]},Ae={trees:[{name:"tree_1",code:"t1",x:0,y:0,width:160,height:208},{name:"tree_2",code:"t2",x:176,y:32,width:160,height:176},{name:"tree_3",code:"t3",x:368,y:32,width:128,height:176}]};function T(e){w=e,console.log("🚀 Starting asset loading..."),u("grass",re),u("path",se),u("oak_tree_original",ie),u("player_sprite_sheet",le),u("assets_tilesheet",ce),u("football_tilesheet",de),u("library_tilesheet",ge),u("travel_flags_tilesheet",fe)}function u(e,t){const o=new Image;o.onload=()=>{g[e]=o,y++,console.log(`✅ Loaded: ${e} (${y}/${I})`),y===I&&(console.log("🎯 All images loaded, starting tile extraction..."),ue(),be(),w&&w())},o.onerror=()=>{console.error(`❌ Failed to load: ${e} from ${t}`),y++,y===I&&w&&w()},o.src=t}function ue(){console.log("🔧 Extracting tiles..."),he(),pe(),ye(),we(),xe()}function he(){const e=g.library_tilesheet;if(!e){console.error("❌ Library tilesheet not found");return}console.log("📚 Extracting library tiles..."),console.log("Library tilesheet size:",e.width,"x",e.height),_.objects.forEach(o=>{console.log(`Extracting ${o.name} at (${o.x}, ${o.y}) size ${o.width}x${o.height}`);const s=x(e,o.x,o.y,o.width,o.height);o.name==="world_map"?(g.world_map=s,console.log("✅ World map extracted")):o.name==="chair"?(g.library_chair=s,console.log("✅ Chair extracted")):o.name.includes("Bookshelf")?(g[`library_${o.code}`]=s,console.log(`✅ Bookshelf ${o.code} extracted`)):o.name==="table"?(g.library_table=s,console.log("✅ Table extracted")):o.name==="rug"&&(g.library_rug=s,console.log("✅ Rug extracted"))});const t=_.paths[0];g.library_floor=x(e,t.x,t.y,t.width,t.height),console.log("✅ Library floor extracted")}function pe(){const e=g.football_tilesheet;if(!e)return;console.log("⚽ Extracting football tiles...");const{tileWidth:t,tileHeight:o,columns:s,rows:a}=me.tilesheet;for(let n=0;n<a;n++)for(let i=0;i<s;i++){const d=n*s+i;g[`football_${d}`]=x(e,i*t,n*o,t,o)}console.log(`✅ Extracted ${a*s} football tiles`)}function ye(){const e=g.travel_flags_tilesheet;e&&(console.log("🏁 Extracting flags..."),U.flags.forEach(t=>{g[`flag_${t.code}`]=x(e,t.x,t.y,t.width,t.height)}),console.log(`✅ Extracted ${U.flags.length} flags`))}function we(){const e=g.assets_tilesheet;e&&(console.log("🌳 Extracting trees..."),Ae.trees.forEach(t=>{g[`tree_${t.code}`]=x(e,t.x,t.y,t.width,t.height),console.log(`✅ Extracted tree ${t.code}`)}))}function x(e,t,o,s,a,n=64,i=64){const d=document.createElement("canvas");d.width=n,d.height=i;const l=d.getContext("2d");if(!l)return console.error("❌ Could not get canvas context"),new Image;l.clearRect(0,0,n,i),l.imageSmoothingEnabled=!1,l.drawImage(e,t,o,s,a,0,0,n,i);const c=new Image;return c.src=d.toDataURL(),c}function be(){console.log("🎨 Creating backgrounds for trees only...");const e=g.grass;if(!e){console.error("❌ Grass tile not available for backgrounds");return}E("oak_tree_original","oak_tree",e),E("tree_t1","tree_t1",e),E("tree_t2","tree_t2",e),E("tree_t3","tree_t3",e),console.log("✅ Tree backgrounds created, library items left as-is")}function E(e,t,o){const s=g[e];if(!s){console.warn(`⚠️ Source tile ${e} not found, skipping background`);return}const a=document.createElement("canvas");a.width=64,a.height=64;const n=a.getContext("2d");if(!n){console.error(`❌ Could not get canvas context for ${t}`);return}n.drawImage(o,0,0,64,64),n.drawImage(s,0,0,64,64);const i=new Image;i.src=a.toDataURL(),g[t]=i,console.log(`✅ Created background for ${t}`)}function xe(){const e=document.createElement("canvas");e.width=64,e.height=64;const t=e.getContext("2d");t&&(t.fillStyle="#1a1a1a",t.fillRect(0,0,64,64),t.strokeStyle="#444",t.lineWidth=3,t.strokeRect(4,4,56,56),t.strokeStyle="#666",t.lineWidth=1,t.strokeRect(8,8,24,24),t.strokeRect(32,8,24,24),t.strokeRect(8,32,24,24),t.strokeRect(32,32,24,24),t.fillStyle="#FFD700",t.beginPath(),t.arc(48,32,3,0,Math.PI*2),t.fill());const o=new Image;o.src=e.toDataURL(),g.door=o,console.log("✅ Door tile created")}function X(){return g}T.getAssets=X;const Y=32,H=32,C=64;function ke(){const e=T.getAssets().player_sprite_sheet;function t(o,s){const a=document.createElement("canvas");a.width=C,a.height=C;const n=a.getContext("2d");if(!n)throw new Error("Failed to get 2D context");return n.drawImage(e,s*Y,o*H,Y,H,0,0,C,C),a}f.down_walk.push(t(0,0)),f.right_walk.push(t(1,1)),f.up_walk.push(t(2,1)),f.down_idle.push(f.down_walk[0]),f.right_idle.push(f.right_walk[0]),f.up_idle.push(f.up_walk[0])}let m=F.room1;function O(){return m}function Ee(e){const t=F[e];return t?(console.log(`Changing from ${m.name} to ${t.name}`),m=t,r.x=t.playerStartX,r.y=t.playerStartY,console.log(`Player positioned at (${r.x}, ${r.y}) in ${t.name}`),r.animationState="idle",W(t),!0):(console.error(`Room ${e} not found!`),!1)}function W(e,t){const o=document.createElement("div");o.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 20px 30px;
    border-radius: 12px;
    font-family: Arial, sans-serif;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
    z-index: 2000;
    border: 3px solid #fff;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.7);
    animation: fadeInOut 3s ease-in-out forwards;
  `;const s=document.createElement("style");s.textContent=`
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    }
  `,document.head.appendChild(s),o.innerHTML=`
    <div style="font-size: 24px; margin-bottom: 10px;">${e.name}</div>
    <div style="font-size: 16px; opacity: 0.8;">${e.description||""}</div>
  `,document.body.appendChild(o),setTimeout(()=>{document.body.removeChild(o),document.head.removeChild(s)},3e3)}function Ce(){const e=r.x,t=r.y,o=m.doors.find(s=>s.x===e&&s.y===t);return o&&(console.log(`Found door at (${e}, ${t}) leading to ${o.targetRoom}`),Ee(o.targetRoom))?(r.x=o.targetX,r.y=o.targetY,console.log(`Player moved to target position (${o.targetX}, ${o.targetY})`),!0):!1}function j(e,t){return m.doors.find(o=>o.x===e&&o.y===t)||null}function ve(){m=F.room1,r.x=m.playerStartX,r.y=m.playerStartY,console.log(`Room system initialized. Starting in ${m.name}`),console.log(`Player starting position: (${r.x}, ${r.y})`),setTimeout(()=>{W(m)},1e3)}let h={},A=null,v=null;const Ie=200;function De(){document.addEventListener("keydown",Be),document.addEventListener("keyup",Pe),Re()}function Re(){A=document.createElement("div"),A.id="door-message",A.style.cssText=`
    position: fixed;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    font-family: Arial, sans-serif;
    font-size: 16px;
    display: none;
    z-index: 1000;
    border: 2px solid #fff;
    text-align: center;
    max-width: 300px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
  `,document.body.appendChild(A)}function Me(e){A&&(A.textContent=e,A.style.display="block")}function K(){A&&(A.style.display="none")}function Be(e){let t=null;switch(e.key){case"ArrowUp":case"w":case"W":t="up";break;case"ArrowDown":case"s":case"S":t="down";break;case"ArrowLeft":case"a":case"A":t="left";break;case"ArrowRight":case"d":case"D":t="right";break;case" ":if(!h[" "]){console.log("Action button pressed!");const o=j(r.x,r.y);o?(console.log(`Attempting to enter door to ${o.targetRoom}`),Ce()&&(console.log("Successfully entered new room!"),K())):console.log("No door here to interact with."),h[e.key]=!0}e.preventDefault();return}t&&!h[e.key]&&(h[e.key]=!0,Le(t)),e.preventDefault()}function Pe(e){if(h[e.key]=!1,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d","W","A","S","D"].includes(e.key)&&!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d","W","A","S","D"].some(s=>h[s])){R(),r.animationState="idle";const s=r.direction==="left"?"right":r.direction;r.currentAnimation=f[`${s}_idle`],r.frameIndex=0,r.animationTimer=0,N()}}function Le(e){R(),Q(e),v=window.setInterval(()=>{({up:["ArrowUp","w","W"],down:["ArrowDown","s","S"],left:["ArrowLeft","a","A"],right:["ArrowRight","d","D"]})[e].some(a=>h[a])?Q(e):R()},Ie)}function R(){v&&(clearInterval(v),v=null)}function Q(e){const t=O(),o=t.map[0].length,s=t.map.length;if(e!==r.direction){r.direction=e,r.animationState="idle";const n=r.direction==="left"?"right":r.direction;r.currentAnimation=f[`${n}_idle`],r.frameIndex=0,r.animationTimer=0}else{let n=r.x,i=r.y;if(e==="up"?i--:e==="down"?i++:e==="left"?n--:e==="right"&&n++,n>=0&&n<o&&i>=0&&i<s){const d=t.map[i][n];oe.includes(d)?(r.x=n,r.y=i,r.animationState="walk",setTimeout(()=>N(),100)):(r.animationState="idle",console.log(`Cannot walk on tile type ${d} at (${n}, ${i})`))}else r.animationState="idle",console.log("Cannot move outside map boundaries")}const a=r.direction==="left"?"right":r.direction;r.currentAnimation=f[`${a}_${r.animationState}`],r.frameIndex=0,r.animationTimer=0}function N(){const e=j(r.x,r.y);e&&e.description?Me(e.description):K()}function Fe(){const e={"btn-up":"ArrowUp","btn-down":"ArrowDown","btn-left":"ArrowLeft","btn-right":"ArrowRight","btn-action":" "};for(const[t,o]of Object.entries(e)){const s=document.getElementById(t);s&&(s.addEventListener("touchstart",a=>{a.preventDefault(),G(o)},{passive:!1}),s.addEventListener("touchend",a=>{a.preventDefault(),D(o)},{passive:!1}),s.addEventListener("mousedown",a=>{a.preventDefault(),G(o)}),s.addEventListener("mouseup",a=>{a.preventDefault(),D(o)}),s.addEventListener("mouseleave",a=>{a.preventDefault(),D(o)}),s.addEventListener("contextmenu",a=>{a.preventDefault()}))}}function G(e){const t=new KeyboardEvent("keydown",{key:e,bubbles:!0,cancelable:!0});document.dispatchEvent(t)}function D(e){const t=new KeyboardEvent("keyup",{key:e,bubbles:!0,cancelable:!0});document.dispatchEvent(t)}function Te(e){const t=document.getElementById("gameCanvas"),o=t?t.getContext("2d"):null,s=64,a=e[0].length,n=e.length,i=a*s,d=n*s;return{canvas:t,ctx:o,TILE_SIZE:s,GAME_WIDTH:i,GAME_HEIGHT:d}}function V(e){e.style.transform="",e.style.position="",e.style.left="",e.style.top="",e.width=e.width,e.height=e.height}const Se=Array(L).fill(null).map(()=>Array(P).fill(0)),{canvas:k,ctx:M,TILE_SIZE:_e,GAME_WIDTH:p,GAME_HEIGHT:b}=Te(Se);if(!k)throw console.error("Canvas element not found! Make sure there's a canvas with id='gameCanvas'"),new Error("Canvas not found");if(!M)throw console.error("Could not get 2D context from canvas"),new Error("Canvas context not available");k.width=p;k.height=b;console.log(`Canvas initialized: ${p}x${b} (${P}x${L} tiles)`);V(k);window.addEventListener("resize",()=>V(k));let J=0,B=!1;function Ue(){B||(B=!0,console.log("Game started!"),requestAnimationFrame(Z))}function Z(e){if(!B)return;const t=(e-J)/1e3;J=e,ae(t),M&&Ye(M,_e),requestAnimationFrame(Z)}function Ye(e,t){e.clearRect(0,0,p,b);const o=X(),s=O(),a=s.map;if(!o.grass){e.fillStyle="#333",e.fillRect(0,0,p,b),e.fillStyle="#fff",e.font="20px Arial",e.textAlign="center",e.fillText("Loading assets...",p/2,b/2);return}for(let n=0;n<a.length;n++)for(let i=0;i<a[0].length;i++){const d=a[n][i];let l=null;switch(d){case 0:l=o.grass;break;case 1:l=o.oak_tree;break;case 2:case 3:case 4:case 5:l=o.path;break;case 6:l=o.door;break;case 7:l=o.library_floor;break;case 8:l=o.library_bsA||o.library_bsB||o.library_bsC;break;case 9:l=o.football_center||o.football_0;break;case 10:l=o.flag_it||o.flag_fr||o.flag_de||o.flag_us;break;case 11:l=o.library_table;break;case 12:l=o.library_chair;break;case 13:l=o.library_rug;break;case 14:l=o.tree_t1||o.tree_t2||o.tree_t3;break;case 15:break;case 16:l=o.football_0;break;case 17:l=o.football_1;break;case 18:l=o.football_2;break;case 19:l=o.football_3;break;case 20:l=o.football_4;break;case 21:l=o.football_5;break;case 22:l=o.football_6;break;case 23:l=o.football_7;break;case 24:l=o.football_8;break;case 25:l=o.football_9;break;case 26:l=o.football_10;break;case 27:l=o.football_11;break;case 28:l=o.world_map;break}if(l)e.drawImage(l,i*t,n*t,t,t);else{let c="#90EE90";switch(d){case 0:c="#228B22";break;case 1:c="#8B4513";break;case 6:c="#2C2C2C";break;case 7:c="#D2B48C";break;case 8:c="#8B4513";break;case 9:c="#32CD32";break;case 10:c="#FF6347";break;case 11:c="#A0522D";break;case 12:c="#CD853F";break;case 13:c="#DC143C";break;case 14:c="#654321";break;case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:c="#32CD32";break;case 28:c="#87CEEB";break}e.fillStyle=c,e.fillRect(i*t,n*t,t,t)}if((d===1||d===14)&&l){const c=l.naturalHeight||l.height;c>t&&e.drawImage(l,i*t,n*t-(c-t),t,c)}if((d===8||d===28)&&l){const c=l.naturalHeight||l.height;c>t&&e.drawImage(l,i*t,n*t-(c-t),t,c)}if(d===6&&(e.save(),e.globalAlpha=.3,e.fillStyle="#FFD700",e.fillRect(i*t+2,n*t+2,t-4,t-4),e.restore()),d===10&&s.id==="room4"){const c=[o.flag_it,o.flag_fr,o.flag_de,o.flag_us,o.flag_jp,o.flag_au,o.flag_es,o.flag_gb].filter(Boolean);if(c.length>0){const q=(i+n)%c.length,S=c[q];S&&e.drawImage(S,i*t,n*t,t,t)}}}ne(e,t),He(e,s)}function He(e,t){if(e.fillStyle="#fff",e.font="bold 18px Arial",e.textAlign="left",e.strokeStyle="#000",e.lineWidth=3,e.strokeText(t.name,15,35),e.fillText(t.name,15,35),t.description&&t.id!=="room1"){e.font="12px Arial",e.fillStyle="#E0E0E0";const o=p-30,s=t.description.split(" ");let a="",n=55;for(let i=0;i<s.length;i++){const d=a+s[i]+" ";e.measureText(d).width>o&&i>0?(e.strokeText(a,15,n),e.fillText(a,15,n),a=s[i]+" ",n+=16):a=d}a&&(e.strokeText(a,15,n),e.fillText(a,15,n))}}console.log("Loading assets...");T(()=>{console.log("Assets loaded, initializing sprites..."),ke(),console.log("Initializing room system..."),ve(),console.log("Setting up input listeners..."),De(),Fe(),console.log("Starting game..."),Ue()});
