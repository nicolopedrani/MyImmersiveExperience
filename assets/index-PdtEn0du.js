(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const b=12,k=9,Q=[[0,0,0,0,0,6,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[6,2,2,2,2,2,2,2,2,2,2,6],[0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],X=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,1,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,0,2,0,0,1,0,0,2,0,0,0],[0,0,2,0,0,0,0,0,2,0,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,1,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,6,0,0,0,0,0,0]],G=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,0,2,0,1,0,1,0,2,0,0,0],[0,0,2,0,0,0,0,0,2,0,0,0],[0,0,2,1,0,0,0,1,2,2,2,6],[0,0,2,0,0,0,0,0,2,0,0,0],[0,0,2,0,1,0,1,0,2,0,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],H=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,0,2,1,0,0,0,1,2,0,0,0],[0,0,2,0,0,1,0,0,2,0,0,0],[6,2,2,0,1,0,1,0,2,0,0,0],[0,0,2,0,0,1,0,0,2,0,0,0],[0,0,2,1,0,0,0,1,2,0,0,0],[0,0,2,2,2,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],S={room1:{id:"room1",name:"Hub Centrale",map:Q,playerStartX:5,playerStartY:7,doors:[{x:5,y:0,targetRoom:"room2",targetX:5,targetY:7},{x:0,y:4,targetRoom:"room3",targetX:10,targetY:4},{x:11,y:4,targetRoom:"room4",targetX:1,targetY:4}]},room2:{id:"room2",name:"Boss Room",map:X,playerStartX:5,playerStartY:7,doors:[{x:5,y:8,targetRoom:"room1",targetX:5,targetY:1}]},room3:{id:"room3",name:"Work Room",map:G,playerStartX:10,playerStartY:4,doors:[{x:11,y:4,targetRoom:"room1",targetX:1,targetY:4}]},room4:{id:"room4",name:"Hobbies Room",map:H,playerStartX:1,playerStartY:4,doors:[{x:0,y:4,targetRoom:"room1",targetX:10,targetY:4}]}},l={down_idle:[],down_walk:[],up_idle:[],up_walk:[],left_idle:[],left_walk:[],right_idle:[],right_walk:[]},o={x:Math.floor(b/2),y:k-2,direction:"down",animationState:"idle",currentAnimation:[],frameIndex:0,animationTimer:0,animationSpeed:.15};o.currentAnimation=l.down_idle;function W(e){o.animationTimer+=e,o.animationTimer>=o.animationSpeed&&(o.animationTimer=0,o.frameIndex=(o.frameIndex+1)%o.currentAnimation.length)}function J(e,t){const n=o.currentAnimation[o.frameIndex];if(!n)return;const i=o.x*t,r=o.y*t;if(e.save(),o.direction==="left"){const a=n.width;e.translate(i,r),e.scale(-1,1),e.drawImage(n,-a,0)}else e.drawImage(n,i,r);e.restore()}const O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAB1JREFUOI1jtOv0+M9AAWCiRPOoAaMGjBowmAwAAJhEAi4/QQzBAAAAAElFTkSuQmCC",K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAB1JREFUOI1jfLKs6D8DBYCJEs2jBowaMGrAYDIAAFnyAxuTOlahAAAAAElFTkSuQmCC",B="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABQCAYAAACpv3NFAAAAAXNSR0IArs4c6QAABZFJREFUeJztW09PG0cU/zk1ogZFvbBFCjgXDgYipAYJRzKHXCLlGkeIT9EvkAMnH/oJ+iUsFM6VcokESBipiYRi44MPjUGVte6BVmDRWNCDmeXteHa9M/Nm6WF/Esrszuzse7/3Z97MOkCGDBkyZMiQIUOGdFFY8G4LC97tQ8uRczEpVWxw7ufE9eDcz4n+1Z0yAKBZa4COdSFPHPKckwlFhXIA0Kw1qLJj/fS6WWvcqghzCbYXCKs2aw1U6xUAQPtkCGBkZVnp0lo+NKa0lkf7ZBga26w1nJPwiGMS6vKrO2XsbR8CuFeyWq8EbXpfvlYR5TpXWLNbWPBuq/VKyHqyggLtk2Fkn2rM3vZh4E1724dOvIGNANcQXgXw5garEEh7GVvdKWN1p8z6XmMCRNITMd8+GQYJzQXk0OLKDSxJUE5y3FDlDi5vsCJAFDF0KXMBOq9YZrneZUQAdX9ayQFwGgrtkyG4E65RNqWlrAouw4GCY2UwXk4oCbSqS0t5OexM6wSrEKACuFwBVOB6rzYBctaVY56biLj5qPVNoeUy8jaWrs3U/blCIek8dNOlGwbGyyBdimRBOfNAlAdweZp20lDFPxcEkSrl6LtU/aZbZy0PUMV/EiQdR5WXyRW5hs5Ft9Gmy6B2CFTrlaD40fGApAVSaS0fzKs6N4g6SzAtibUJ2K/nxg4t4hQzLZPjCJPnqtYrqNYrRiRoETA493P+7kHonhBSJaysvA4JqqQqv4MjERolQWD8YDPuFCiuPykm1QOmlaCWVIUF79bb2oS38m3i2ElhoZs/gGhPsDkuM6oD/NZUaBeoUiaqLogKlUkx76rkNsoB/u4BvK1N5ZgkCVFuJ80RUeu/DbQ9QLiaKgxoQpSVpW48yZqTiBJo1hrwtjbhbW0aL4MspZxOoSOPj2tP2ltEeaEOjFYBkQj91tRIkJik6LemEiXNpJDn81tT8HcPjJOgsQeolJfvcSlP5xHEeyvfgvi3+U5glAPkYkgIKQRU3ZfbUfBbU8pn5Gc5lAcszgRFW45Dan0ZsrdEeYrKk1S47Axx9enIigSjEBCfsGeevwgJM7uUT2xlCurWceMuO/zHbtYfRi47Q/i7B5hdyo/dlxHl3lH9l53h2DxXn46Cf22tD1h+HBWhMPP8RUCAcEv5nkxQFOSxKiI5FBew8gAqhLBWnPJUmaj27FI+0uouwMIiTYoiLyQlQu6nJFJQEjg/j7P/4ICGhUCUQnFjhMKUUBc/kGD5OkwhCxmlfPlxMZTQ6DWdiyvZRcHZD5CiwgIAyo+LAIDGP93QNb2X1k/mnH3IIwosA0ct4F7Rjfnpu65i6JnR/SI+nv6+MnoOAHDqSkbAQQjcYZn8YXDurwzO/RUAePusEBq4MT8dEFKcU4oTmosb3ARMFLS06AWKbsxPRyltPL8uOEMgsWClRQ+Aj27/JmgD0+j2b3TexRIaXB6gZZX2ma9U1sAbrMFBgJYgHz73gvarn+ZTfbcKrpJgLIT122d+6PohYEuAtgWEmx/3rgHce4Sm+1vJQJGaB7xcXm+9e/0UwL2ywvLHveug/e71U7xcXm+lJZcNAUbMj7L+CMW5R4EnHPeuQ31pyAIA35k+CGAu6UBh/faZj7/+vsL7LwNszE/jh5kc3qw/wX7nAgCw37nAj9//izfrT9C9mPn5j/6fv2rI09dVAEg5CXb7N3j/ZRBcU4vflb/o9m/QPvNTCwWbQugUCVxPWP/D5x6Oe9eBosB6q3jmj5Hw0ay8MS6KbHdcxrEnrPv2WQGlRQ+//PaVkKONByMAcLRJ0YBVSfwghdD/CVyHDg/lBdYbIs5Tl7RJYNkNch87pUUC2ymRq3M3V0SwH4+lcfBoS4bTM8HU/7MyJhPiVOEMGTJkyJAhQwaB/wCcF1ybPAOXlAAAAABJRU5ErkJggg==",N="/MyImmersiveExperience/assets/Player-LaRVoEvR.png",v={};let g=0;const h=6;let A=null;function C(e){A=e,u("grass",O),u("path",K),u("oak_tree",B),u("player_sprite_sheet",N),u("temp_boss",B),j()}function u(e,t){const n=new Image;n.onload=()=>{v[e]=n,g++,g===h&&A&&A()},n.onerror=()=>{console.error(`Failed to load image: ${t}`),g++,g===h&&A&&A()},n.src=t}function j(){const e=document.createElement("canvas");e.width=64,e.height=64;const t=e.getContext("2d");t&&(t.fillStyle="#000000",t.fillRect(0,0,64,64),t.strokeStyle="#333333",t.lineWidth=2,t.strokeRect(1,1,62,62),t.fillStyle="#555555",t.fillRect(20,15,24,34),t.fillStyle="#888888",t.fillRect(38,28,3,8));const n=new Image;n.onload=()=>{v.door=n,g++,g===h&&A&&A()},n.src=e.toDataURL()}function _(){return v}C.getAssets=_;const M=32,D=32,y=64;function Z(){const e=C.getAssets().player_sprite_sheet;function t(n,i){const r=document.createElement("canvas");r.width=y,r.height=y;const a=r.getContext("2d");if(!a)throw new Error("Failed to get 2D context");return a.drawImage(e,i*M,n*D,M,D,0,0,y,y),r}l.down_walk.push(t(0,0)),l.right_walk.push(t(1,1)),l.up_walk.push(t(2,1)),l.down_idle.push(l.down_walk[0]),l.right_idle.push(l.right_walk[0]),l.up_idle.push(l.up_walk[0])}let c=S.room1;function x(){return c}function V(e){const t=S[e];return t?(console.log(`Changing from ${c.name} to ${t.name}`),c=t,o.x=t.playerStartX,o.y=t.playerStartY,!0):(console.error(`Room ${e} not found!`),!1)}function q(){const e=o.x,t=o.y,n=c.doors.find(i=>i.x===e&&i.y===t);return n&&(console.log(`Found door at (${e}, ${t}) leading to ${n.targetRoom}`),V(n.targetRoom))?(o.x=n.targetX,o.y=n.targetY,!0):!1}function $(){c=S.room1,o.x=c.playerStartX,o.y=c.playerStartY,console.log(`Room system initialized. Starting in ${c.name}`)}let E=!1;function z(){document.addEventListener("keydown",ee),document.addEventListener("keyup",te)}function ee(e){if(E)return;let t=null;switch(e.key){case"ArrowUp":case"w":case"W":t="up";break;case"ArrowDown":case"s":case"S":t="down";break;case"ArrowLeft":case"a":case"A":t="left";break;case"ArrowRight":case"d":case"D":t="right";break;case" ":console.log("Action button pressed!"),q()?console.log("Entered new room!"):console.log("No door here to interact with.");return}t&&(E=!0,oe(t),e.preventDefault())}function te(e){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d","W","A","S","D"].includes(e.key)){E=!1,o.animationState="idle";const t=o.direction==="left"?"right":o.direction;o.currentAnimation=l[`${t}_idle`],o.frameIndex=0,o.animationTimer=0}}function oe(e){const t=x(),n=t.map[0].length,i=t.map.length;if(e!==o.direction){o.direction=e,o.animationState="idle";const a=o.direction==="left"?"right":o.direction;o.currentAnimation=l[`${a}_idle`],o.frameIndex=0,o.animationTimer=0}else{let a=o.x,s=o.y;if(e==="up"?s--:e==="down"?s++:e==="left"?a--:e==="right"&&a++,a>=0&&a<n&&s>=0&&s<i){const m=t.map[s][a];[0,2,3,4,5,6].includes(m)?(o.x=a,o.y=s,o.animationState="walk"):o.animationState="idle"}else o.animationState="idle"}const r=o.direction==="left"?"right":o.direction;o.currentAnimation=l[`${r}_${o.animationState}`],o.frameIndex=0,o.animationTimer=0}function ne(){const e={"btn-up":"ArrowUp","btn-down":"ArrowDown","btn-left":"ArrowLeft","btn-right":"ArrowRight","btn-action":" "};for(const[t,n]of Object.entries(e)){const i=document.getElementById(t);i&&(i.addEventListener("touchstart",r=>{r.preventDefault(),L(n)},{passive:!1}),i.addEventListener("touchend",r=>{r.preventDefault(),U(n)},{passive:!1}),i.addEventListener("mousedown",r=>{r.preventDefault(),L(n)}),i.addEventListener("mouseup",r=>{r.preventDefault(),U(n)}))}}function L(e){const t=new KeyboardEvent("keydown",{key:e,bubbles:!0,cancelable:!0});document.dispatchEvent(t)}function U(e){const t=new KeyboardEvent("keyup",{key:e,bubbles:!0,cancelable:!0});document.dispatchEvent(t)}function re(e){const t=document.getElementById("gameCanvas"),n=t?t.getContext("2d"):null,i=64,r=e[0].length,a=e.length,s=r*i,m=a*i;return{canvas:t,ctx:n,TILE_SIZE:i,GAME_WIDTH:s,GAME_HEIGHT:m}}function F(e){e.style.transform="",e.style.position="",e.style.left="",e.style.top="",e.width=e.width,e.height=e.height}const ae=Array(k).fill(null).map(()=>Array(b).fill(0)),{canvas:w,ctx:R,TILE_SIZE:ie,GAME_WIDTH:f,GAME_HEIGHT:p}=re(ae);if(!w)throw console.error("Canvas element not found! Make sure there's a canvas with id='gameCanvas'"),new Error("Canvas not found");if(!R)throw console.error("Could not get 2D context from canvas"),new Error("Canvas context not available");w.width=f;w.height=p;console.log(`Canvas initialized: ${f}x${p} (${b}x${k} tiles)`);F(w);window.addEventListener("resize",()=>F(w));let T=0,I=!1;function se(){I||(I=!0,console.log("Game started!"),requestAnimationFrame(Y))}function Y(e){if(!I)return;const t=(e-T)/1e3;T=e,W(t),R&&le(R,ie),requestAnimationFrame(Y)}function le(e,t){e.clearRect(0,0,f,p);const n=_(),i=x(),r=i.map;if(!n.grass){e.fillStyle="#333",e.fillRect(0,0,f,p),e.fillStyle="#fff",e.font="20px Arial",e.textAlign="center",e.fillText("Loading assets...",f/2,p/2);return}for(let a=0;a<r.length;a++)for(let s=0;s<r[0].length;s++){const m=r[a][s];let d=null;switch(m){case 0:d=n.grass;break;case 1:d=n.oak_tree;break;case 2:case 3:case 4:case 5:d=n.path;break;case 6:d=n.door;break}if(d?e.drawImage(d,s*t,a*t,t,t):(e.fillStyle=m===1?"#8B4513":"#90EE90",e.fillRect(s*t,a*t,t,t)),m===1&&n.oak_tree){const P=n.oak_tree.height;e.drawImage(n.oak_tree,s*t,a*t-(P-t),t,P)}}J(e,t),e.fillStyle="#fff",e.font="16px Arial",e.textAlign="left",e.fillText(i.name,10,30)}console.log("Loading assets...");C(()=>{console.log("Assets loaded, initializing sprites..."),Z(),console.log("Initializing room system..."),$(),console.log("Setting up input listeners..."),z(),ne(),console.log("Starting game..."),se()});
